<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2åˆ†ã‚¹ãƒ”ãƒ¼ãƒ</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<header class="top">
  <h1>ğŸ¤ 2åˆ†ã‚¹ãƒ”ãƒ¼ãƒ</h1>
  <p class="sub">å°‚ç”¨ãŠé¡Œ Ã— 120ç§’ã‚¿ã‚¤ãƒãƒ¼ï¼ˆéŒ²éŸ³ï¼†AIè©•ä¾¡ã¤ãï¼‰</p>
  <p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a></p>
</header>

<main class="menu">

  <!-- ãŠé¡Œ -->
  <div class="card" style="display:block;">
    <div class="title">ãŠé¡Œ</div>
    <div class="desc">
      <p id="topic" style="font-size:20px; font-weight:bold;">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
      <p style="margin-top:8px; opacity:0.85; line-height:1.7;">
        ğŸ’¡ 2åˆ†ã¯ã€ŒèƒŒæ™¯ â†’ å‡ºæ¥äº‹ â†’ å­¦ã³ â†’ ä»Šå¾Œã€ã§è©±ã™ã¨ã¾ã¨ã¾ã‚Šã‚„ã™ã„ã§ã™
      </p>
    </div>
  </div>

  <!-- ã‚¿ã‚¤ãƒãƒ¼ -->
  <div class="card" style="display:block;">
    <div class="title">ã‚¿ã‚¤ãƒãƒ¼</div>
    <div class="desc">
      <p id="timer" style="font-size:32px;">120</p>
      <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <button onclick="start()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button onclick="stop()">â¹ ã‚¹ãƒˆãƒƒãƒ—</button>
        <button onclick="newTopic()">ğŸ² ãŠé¡Œã ã‘æ›´æ–°</button>
      </div>
    </div>
  </div>

  <!-- =========================
    ğŸ™ éŒ²éŸ³ï¼‹AIè©•ä¾¡ï¼ˆ1ç”»é¢å®Œçµï¼‰
  ========================= -->
  <section class="card" style="display:block;">
    <div class="title">ğŸ™ éŒ²éŸ³ & AIè©•ä¾¡ï¼ˆ1ç”»é¢å®Œçµï¼‰</div>
    <div class="desc">

      <div style="border:1px solid #eee; border-radius:14px; padding:12px;">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <button id="hxRecBtn" onclick="hxToggleRecording()"
            style="padding:12px 14px; border-radius:12px; border:none; background:#22c55e; color:#fff;">
            éŒ²éŸ³é–‹å§‹
          </button>

          <button onclick="hxResetRecording()"
            style="padding:12px 14px; border-radius:12px; border:none; background:#ef4444; color:#fff;">
            éŒ²éŸ³ãƒªã‚»ãƒƒãƒˆ
          </button>

          <span id="hxRecStatus" style="font-family: ui-monospace, SFMono-Regular, Menlo, monospace;">
            å¾…æ©Ÿä¸­
          </span>
        </div>

        <audio id="hxPlayer" controls style="display:none; width:100%; margin-top:10px;"></audio>

        <div style="margin-top:10px; font-size:14px; opacity:0.9; line-height:1.7;">
          âœ… éŒ²éŸ³â†’å†ç”Ÿã§ãã¾ã™ï¼ˆç«¯æœ«å†…ï¼‰<br>
          ğŸ’¡ éŒ²éŸ³ã‚’èããªãŒã‚‰ä¸‹ã®æ¬„ã«åŸç¨¿ãƒ¡ãƒ¢ â†’ ã€ŒAIè©•ä¾¡ã€ãŒãŠã™ã™ã‚
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="font-weight:700; margin-bottom:6px;">ğŸ“ ã‚¹ãƒ”ãƒ¼ãƒæœ¬æ–‡ï¼ˆè©•ä¾¡å¯¾è±¡ï¼‰</div>
        <textarea id="hxSpeechText"
          placeholder="ã“ã“ã«ã‚¹ãƒ”ãƒ¼ãƒã‚’æ›¸ã„ã¦ãã ã•ã„ï¼ˆéŒ²éŸ³ã‚’èããªãŒã‚‰ãƒ¡ãƒ¢ã§ã‚‚OKï¼‰"
          style="width:100%; min-height:180px; padding:12px; border-radius:12px; border:1px solid #ddd;"></textarea>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button onclick="hxRunEvaluation()"
            style="padding:12px 14px; border-radius:12px; border:none; background:#0ea5e9; color:#fff;">
            AIè©•ä¾¡ã™ã‚‹
          </button>

          <button onclick="hxClearText()"
            style="padding:12px 14px; border-radius:12px; border:1px solid #ddd; background:#fff;">
            ã‚¯ãƒªã‚¢
          </button>

          <button onclick="hxInsertTemplate()"
            style="padding:12px 14px; border-radius:12px; border:1px solid #ddd; background:#fff;">
            ãƒ†ãƒ³ãƒ—ãƒ¬æŒ¿å…¥
          </button>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div id="hxBadges"></div>
        <div id="hxResult" style="white-space:pre-wrap; line-height:1.9; margin-top:10px;">
          ã“ã“ã«è©•ä¾¡çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        </div>
      </div>

    </div>
  </section>

</main>

<script>
/* =========================
   2åˆ†ã‚¹ãƒ”ãƒ¼ãƒè¨­å®š
========================= */
const TARGET_SECONDS = 120;

const topics = [
  "äººç”Ÿã§ä¸€ç•ªã¤ã‚‰ã‹ã£ãŸçµŒé¨“ã¨ã€ãã“ã‹ã‚‰å­¦ã‚“ã ã“ã¨",
  "å¤§ããªå¤±æ•—ã‹ã‚‰ç«‹ã¡ç›´ã£ãŸæ–¹æ³•",
  "ä»Šã®ä»•äº‹ã‚’é¸ã‚“ã ç†ç”±",
  "å®¶æ—ã‹ã‚‰å­¦ã‚“ã ã“ã¨",
  "å­è‚²ã¦ã§å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ã“ã¨",
  "ã“ã‚Œã¾ã§ã§ä¸€ç•ªèª‡ã‚Œã‚‹ã“ã¨",
  "äººç”Ÿã®ä¾¡å€¤è¦³ãŒå¤‰ã‚ã£ãŸå‡ºæ¥äº‹",
  "å½±éŸ¿ã‚’å—ã‘ãŸæœ¬ã‚„è¨€è‘‰",
  "ä½•ã‹ã‚’ç¶™ç¶šã§ããŸç†ç”±",
  "æŒ«æŠ˜ã—ãŸæ™‚ã®è€ƒãˆæ–¹",

  "è‡ªåˆ†ãŒå¤‰ã‚ã‚ŒãŸãã£ã‹ã‘",
  "ã“ã‚Œã¾ã§ã§ä¸€ç•ªåŠªåŠ›ã—ãŸæœŸé–“",
  "äººé–“é–¢ä¿‚ã§å­¦ã‚“ã ã“ã¨",
  "å¤±æ•—ã‚’ã©ã†æ¬¡ã«æ´»ã‹ã—ã¦ã„ã‚‹ã‹",
  "ç†æƒ³ã®äººç”Ÿã¨ã¯ä½•ã‹",
  "ã“ã‚Œã‹ã‚‰èº«ã«ã¤ã‘ãŸã„åŠ›",
  "ä»Šã®è‡ªåˆ†ã«è¶³ã‚Šãªã„ã‚‚ã®",
  "äººç”Ÿã§å¤§åˆ‡ã«ã—ã¦ã„ã‚‹é¸æŠåŸºæº–",
  "å°Šæ•¬ã™ã‚‹äººã‹ã‚‰å­¦ã‚“ã ã“ã¨",
  "éå»ã®è‡ªåˆ†ã«ä¼ãˆãŸã„è¨€è‘‰",

  "ä»•äº‹ã§ä¸€ç•ªã‚„ã‚ŠãŒã„ã‚’æ„Ÿã˜ãŸç¬é–“",
  "å›°é›£ã‚’ä¹—ã‚Šè¶ŠãˆãŸä½“é¨“",
  "ãªãœæŒ‘æˆ¦ã—ç¶šã‘ãŸã„ã®ã‹",
  "äººç”Ÿã§å¾Œæ‚”ã—ã¦ã„ã‚‹ã“ã¨ã¨å¯¾å‡¦æ³•",
  "è‡ªåˆ†ã®åŸå‹•åŠ›ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®",
  "10å¹´å¾Œã®ç†æƒ³åƒ",
  "ã“ã‚Œã‹ã‚‰å¤‰ãˆãŸã„ç¿’æ…£",
  "äººã«æ„Ÿè¬ã—ã¦ã„ã‚‹ã“ã¨",
  "è‡ªåˆ†ã®äººç”Ÿã®ãƒ†ãƒ¼ãƒ",
  "ã“ã‚Œã‹ã‚‰ã®ç›®æ¨™ã¨è¦šæ‚Ÿ"
];

let time = TARGET_SECONDS;
let interval = null;

function newTopic(){
  const t = topics[Math.floor(Math.random() * topics.length)];
  document.getElementById("topic").textContent = t;
}

function start(){
  if(interval) return; // äºŒé‡é˜²æ­¢

  newTopic();

  time = TARGET_SECONDS;
  document.getElementById("timer").textContent = time;

  interval = setInterval(() => {
    time--;
    document.getElementById("timer").textContent = time;

    if(time <= 0){
      stop();
      alert("çµ‚äº†ï¼2åˆ†è©±ã—ãã‚Šã¾ã—ãŸã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸğŸ˜Š");
    }
  }, 1000);
}

function stop(){
  if(interval){
    clearInterval(interval);
    interval = null;
  }
}

/* =========================
   éŒ²éŸ³ï¼ˆMediaRecorderï¼‰
========================= */
let hxMediaRecorder = null;
let hxRecordedChunks = [];
let hxRecordedBlobUrl = null;

async function hxToggleRecording(){
  const btn = document.getElementById("hxRecBtn");
  const status = document.getElementById("hxRecStatus");
  const player = document.getElementById("hxPlayer");

  if(hxMediaRecorder && hxMediaRecorder.state === "recording"){
    hxMediaRecorder.stop();
    btn.textContent = "éŒ²éŸ³é–‹å§‹";
    status.textContent = "åœæ­¢ã—ã¾ã—ãŸï¼ˆéŸ³å£°ç”Ÿæˆä¸­â€¦ï¼‰";
    return;
  }

  try{
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    hxRecordedChunks = [];
    hxMediaRecorder = new MediaRecorder(stream);

    hxMediaRecorder.ondataavailable = (e) => {
      if(e.data && e.data.size > 0) hxRecordedChunks.push(e.data);
    };

    hxMediaRecorder.onstop = () => {
      stream.getTracks().forEach(t => t.stop());

      const blob = new Blob(hxRecordedChunks, { type: "audio/webm" });
      if(hxRecordedBlobUrl) URL.revokeObjectURL(hxRecordedBlobUrl);
      hxRecordedBlobUrl = URL.createObjectURL(blob);

      player.src = hxRecordedBlobUrl;
      player.style.display = "block";
      status.textContent = "éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿æº–å‚™OKï¼ˆå†ç”Ÿã§ãã¾ã™ï¼‰";
    };

    hxMediaRecorder.start();
    btn.textContent = "éŒ²éŸ³åœæ­¢";
    status.textContent = "éŒ²éŸ³ä¸­â€¦ï¼ˆ2åˆ†ã¯é•·ã„ã®ã§ã€æ·±å‘¼å¸ã—ãªãŒã‚‰ã§OKï¼‰";
  }catch(err){
    status.textContent = "éŒ²éŸ³ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªï¼‰";
    alert("éŒ²éŸ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚iPhoneã®è¨­å®š/ã‚µã‚¤ãƒˆè¨­å®šã§ãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
  }
}

function hxResetRecording(){
  const status = document.getElementById("hxRecStatus");
  const player = document.getElementById("hxPlayer");

  if(hxMediaRecorder && hxMediaRecorder.state === "recording"){
    hxMediaRecorder.stop();
  }
  hxRecordedChunks = [];
  if(hxRecordedBlobUrl) URL.revokeObjectURL(hxRecordedBlobUrl);
  hxRecordedBlobUrl = null;

  player.pause();
  player.removeAttribute("src");
  player.style.display = "none";
  status.textContent = "å¾…æ©Ÿä¸­";

  const btn = document.getElementById("hxRecBtn");
  btn.textContent = "éŒ²éŸ³é–‹å§‹";
}

/* =========================
   é•·ã•æ¨å®šï¼ˆ120ç§’ï¼‰
   - ç›®å®‰ï¼š1ç§’=6æ–‡å­—ï¼ˆå¿…è¦ãªã‚‰èª¿æ•´ï¼‰
========================= */
function hxEstimateSeconds(text){
  const t = (text || "")
    .replace(/\s/g, "")
    .replace(/[ã€ã€‚,.!?ï¼ï¼Ÿ]/g,"");

  const chars = t.length;
  const CHARS_PER_SEC = 6;

  const sec = chars / CHARS_PER_SEC;
  return { sec, chars, charsPerSec: CHARS_PER_SEC };
}

/* =========================
   2åˆ†ç”¨ï¼šã‚„ã•ã—ã„ç·åˆè©•ä¾¡ï¼ˆåŠ´ã„å¼·ã‚ï¼‹é•·ã•ãƒã‚§ãƒƒã‚¯ï¼‹æ”¹å–„2ã¤ã¾ã§ï¼‰
========================= */
function hxGentleEvaluate(text){
  const raw = (text || "").trim();
  const t = raw.replace(/\r\n/g, "\n").replace(/\n{3,}/g, "\n\n").trim();

  let score = 60;
  const goodPoints = [];
  const badges = [];
  const advice = [];

  if(t.length < 10){
    return {
      score: 60,
      badges: ["å…¥åŠ›ãŒçŸ­ã‚"],
      message:
`ğŸŒŸ ç·åˆè©•ä¾¡ï¼š60ç‚¹

ã¾ãšã€Œ2åˆ†ã«æŒ‘æˆ¦ã—ã‚ˆã†ã€ã¨ã—ãŸæ™‚ç‚¹ã§ç´ æ™´ã‚‰ã—ã„ã§ã™ğŸ‘
çŸ­ã„ãªãŒã‚‰ã‚‚ã€è©±ãã†ã¨ã™ã‚‹å§¿å‹¢ãŒä¼ã‚ã‚Šã¾ã—ãŸã€‚

ğŸ’¡ 2åˆ†ã«è¿‘ã¥ã‘ã‚‹ã‚³ãƒ„ï¼š
ãƒ»èƒŒæ™¯ï¼ˆã„ã¤/ã©ã‚“ãªçŠ¶æ³ï¼‰ã‚’1ã€œ2æ–‡
ãƒ»å‡ºæ¥äº‹ï¼ˆä½•ãŒèµ·ããŸã‹ï¼‰ã‚’2ã€œ3æ–‡
ãƒ»å­¦ã³ï¼ˆä½•ã‚’å¾—ãŸã‹ï¼‰ã‚’1æ–‡
ãƒ»ä»Šå¾Œï¼ˆã©ã†ã—ãŸã„ã‹ï¼‰ã‚’1æ–‡

ã“ã®å‹ã«æ²¿ã†ã ã‘ã§ã€è‡ªç„¶ã«2åˆ†ãŒåŸ‹ã¾ã‚Šã¾ã™ğŸ˜Š`
    };
  }

  // ãƒ†ãƒ¼ãƒåˆ¥ã®â€œé›°å›²æ°—â€ã‚’å°‘ã—å¤‰ãˆã‚‹ï¼ˆé‡ã„ãƒ†ãƒ¼ãƒãŒå¤šã„ã®ã§ï¼‰
  const heavyHints = ["ã¤ã‚‰ã‹ã£ãŸ","å¤±æ•—","æŒ«æŠ˜","å¾Œæ‚”","å›°é›£","ç«‹ã¡ç›´ã£ãŸ"];
  const isHeavy = heavyHints.some(w => t.includes(w));

  // æŸ”è»Ÿãƒ¯ãƒ¼ãƒ‰åˆ¤å®š
  const conclusion = ["çµè«–","è¦ã™ã‚‹ã«","ã¤ã¾ã‚Š","ä¸€è¨€ã§ã„ã†ã¨","ç§ã®è€ƒãˆã¯","åƒ•ã®è€ƒãˆã¯","ç§ã¯","åƒ•ã¯","å¤§äº‹ãªã®ã¯","é‡è¦ãªã®ã¯","ãƒã‚¤ãƒ³ãƒˆã¯","çµå±€","ä¸€ç•ªè¨€ã„ãŸã„ã®ã¯","ç§ãŒå­¦ã‚“ã ã®ã¯","ç§ãŒå¤§åˆ‡ã«ã—ãŸã„ã®ã¯"];
  const reason = ["ãªãœãªã‚‰","ç†ç”±","èƒŒæ™¯","ã¨ã„ã†ã®ã‚‚","ãªãœã‹ã¨ã„ã†ã¨","ã ã‹ã‚‰ã“ã","ãªã®ã§","ã‹ã‚‰","ãŸã‚","ãŒã‚ã£ã¦","èƒŒæ™¯ã¨ã—ã¦"];
  const example = ["ä¾‹ãˆã°","ãŸã¨ãˆã°","å®Ÿéš›ã«","ã“ã®å‰","ä»¥å‰","å…ˆæ—¥","å…·ä½“çš„ã«","ä½“é¨“ã¨ã—ã¦","ãŸã¨ãˆã‚‹ã¨","ã“ã‚“ãªã“ã¨ãŒã‚ã£ã¦","ã®ã¨ã","å½“æ™‚","ãã®æ™‚"];
  const summary = ["ã¾ã¨ã‚ã‚‹ã¨","çµè«–ã¨ã—ã¦","æœ€å¾Œã«","ã ã‹ã‚‰","ã¤ã¾ã‚Š","ãªã®ã§","ã¨ã„ã†ã‚ã‘ã§","è¦ã¯","ä»Šå¾Œã¯","æ¬¡ã¯","ã“ã‚Œã‹ã‚‰","ã“ã‚Œã‚’å¤§äº‹ã«ã—ãŸã„","ä»Šã¯"];

  const hasConclusion = conclusion.some(w => t.includes(w));
  const hasReason = reason.some(w => t.includes(w));
  const hasExample = example.some(w => t.includes(w));
  const hasSummary = summary.some(w => t.includes(w));

  if(hasConclusion){ score += 10; goodPoints.push("ãƒ†ãƒ¼ãƒï¼ˆä¸»å¼µï¼‰ãŒã¯ã£ãã‚Šã—ã¦ã„ã¾ã—ãŸ"); badges.push("ãƒ†ãƒ¼ãƒæ˜ç¢º"); }
  if(hasReason){ score += 10; goodPoints.push("ç†ç”±ã‚„èƒŒæ™¯ãŒä¼ã‚ã£ã¦ç´å¾—ã—ã‚„ã™ã‹ã£ãŸã§ã™"); badges.push("ç´å¾—æ„Ÿ"); }
  if(hasExample){ score += 10; goodPoints.push("å…·ä½“ä¾‹ãŒã‚ã‚Šã€æƒ…æ™¯ãŒæµ®ã‹ã³ã¾ã—ãŸ"); badges.push("å…·ä½“æ€§"); }
  if(hasSummary){ score += 10; goodPoints.push("æœ€å¾Œã®ç· ã‚ãŒã‚ã‚Šã€è©±ãŒã¾ã¨ã¾ã‚Šã¾ã—ãŸ"); badges.push("ç· ã‚ãŒè‰¯ã„"); }

  // 2åˆ†ã¯â€œåšã¿â€ã‚’è¦‹ã‚‹
  if(t.length > 320){
    score += 5;
    goodPoints.push("2åˆ†ã‚¹ãƒ”ãƒ¼ãƒã«å¿…è¦ãªæƒ…å ±é‡ãŒã—ã£ã‹ã‚Šã‚ã‚Šã¾ã—ãŸ");
    badges.push("å†…å®¹å……å®Ÿ");
  }

  // æ„Ÿæƒ…ãƒ»å†…çœï¼ˆ2åˆ†å‘ãï¼‰
  const reflectionWords = ["å­¦ã‚“ã ","æ°—ã¥ã„ãŸ","åçœ","ä¾¡å€¤è¦³","å¤§åˆ‡","æˆé•·","å¤‰ã‚ã£ãŸ","è¦šæ‚Ÿ","åŸå‹•åŠ›","é¸æŠ"];
  if(reflectionWords.some(w => t.includes(w))){
    score += 5;
    goodPoints.push("å†…çœãŒå…¥ã£ã¦ã„ã¦ã€2åˆ†ã‚‰ã—ã„æ·±ã¿ãŒã‚ã‚Šã¾ã—ãŸ");
    badges.push("æ·±ã¿");
  }

  // èãæ‰‹ç›®ç·š
  const listenerWords = ["ã¿ãªã•ã‚“","çš†ã•ã‚“","ç›¸æ‰‹","èãäºº","ä¼ãˆãŸã„","å…±æœ‰","ã‚‚ã—ã‚ˆã‘ã‚Œã°","ãŠã™ã™ã‚","å‚è€ƒ"];
  if(listenerWords.some(w => t.includes(w))){
    score += 5;
    goodPoints.push("èãæ‰‹ã‚’æ„è­˜ã—ãŸè¨€è‘‰é¸ã³ãŒã§ãã¦ã„ã¾ã—ãŸ");
    badges.push("èãæ‰‹ç›®ç·š");
  }

  // é•·ã•ãƒã‚§ãƒƒã‚¯ï¼ˆ120ç§’ï¼‰
  const est = hxEstimateSeconds(t);
  const target = TARGET_SECONDS;
  const low = target * 0.85;
  const high = target * 1.15;

  let lengthComment = "";
  if(est.sec < low){
    badges.push("çŸ­ã‚");
    lengthComment =
`â± é•·ã•ãƒã‚§ãƒƒã‚¯ï¼š
æ¨å®š ${est.sec.toFixed(0)}ç§’ï¼ˆç›®æ¨™ ${target}ç§’ï¼‰ â†’ å°‘ã—çŸ­ã‚

ğŸ’¡ ä¼¸ã°ã™ã‚³ãƒ„ï¼ˆ2åˆ†å‘ã‘ï¼‰ï¼š
ãƒ»ã€ŒèƒŒæ™¯ï¼ˆå½“æ™‚ã®çŠ¶æ³ï¼‰ã€ã‚’2æ–‡è¶³ã™
ãƒ»ã€Œå‡ºæ¥äº‹ã®æµã‚Œã€ã‚’1æ®µéšã ã‘å…·ä½“åŒ–
ãƒ»ã€Œå­¦ã³ã€ã‚’1æ–‡â†’2æ–‡ã«ã—ã¦æ·±ã‚ã‚‹`;
    advice.push("2åˆ†ã¯â€œèƒŒæ™¯â†’å‡ºæ¥äº‹â†’å­¦ã³â†’ä»Šå¾Œâ€ã‚’å…¥ã‚Œã‚‹ã¨è‡ªç„¶ã«ä¼¸ã³ã¾ã™");
  }else if(est.sec > high){
    badges.push("é•·ã‚");
    lengthComment =
`â± é•·ã•ãƒã‚§ãƒƒã‚¯ï¼š
æ¨å®š ${est.sec.toFixed(0)}ç§’ï¼ˆç›®æ¨™ ${target}ç§’ï¼‰ â†’ å°‘ã—é•·ã‚

ğŸ’¡ çŸ­ãã™ã‚‹ã‚³ãƒ„ï¼š
ãƒ»å…·ä½“ä¾‹ã‚’1ã¤ã«çµã‚‹
ãƒ»åŒã˜æ„å‘³ã®æ–‡ã‚’å‰Šã‚‹
ãƒ»ç· ã‚ã‚’1æ–‡ã«ã¾ã¨ã‚ã‚‹`;
    advice.push("2åˆ†ã«åã‚ã‚‹ãªã‚‰ã€å…·ä½“ä¾‹ã‚’1ã¤ã«çµã£ã¦ç· ã‚ã‚’çŸ­ãã™ã‚‹ã¨ç¶ºéº—ã§ã™");
  }else{
    badges.push("é•·ã•OK");
    score += 5;
    lengthComment =
`â± é•·ã•ãƒã‚§ãƒƒã‚¯ï¼š
æ¨å®š ${est.sec.toFixed(0)}ç§’ï¼ˆç›®æ¨™ ${target}ç§’ï¼‰ â†’ ã¡ã‚‡ã†ã©è‰¯ã„é•·ã•ã§ã™ âœ…`;
    goodPoints.push("2åˆ†ã«åˆã†é•·ã•ã§ã€èãæ‰‹ãŒé›†ä¸­ã—ã‚„ã™ã„ãƒ†ãƒ³ãƒã§ã—ãŸ");
  }

  // æ”¹å–„ï¼šæœ€å¤§2ã¤ï¼ˆ2åˆ†ã¯é ‘å¼µã‚ŠãŒå¤§ãã„ã®ã§ï¼‰
  const improveList = [];

  if(!hasExample) improveList.push("å…·ä½“ä¾‹ï¼ˆå½“æ™‚ã®å ´é¢ï¼‰ã‚’1ã¤å…¥ã‚Œã‚‹ã¨ã€èª¬å¾—åŠ›ã¨è‡¨å ´æ„ŸãŒå¢—ã—ã¾ã™");
  if(!hasSummary) improveList.push("æœ€å¾Œã«ã€Œä»Šã®è‡ªåˆ†ã¯ã“ã†ã—ãŸã„ã€ã‚’ä¸€è¨€ç½®ãã¨ç· ã¾ã‚Šã¾ã™");
  if(!hasReason) improveList.push("èƒŒæ™¯ãƒ»ç†ç”±ã‚’ä¸€è¨€è¶³ã™ã¨ã€èãæ‰‹ãŒè¿·å­ã«ãªã‚Šã¾ã›ã‚“");
  if(!hasConclusion) improveList.push("å†’é ­ã‹æœ€å¾Œã«ã€Œä¸€ç•ªä¼ãˆãŸã„çµè«–ã€ã‚’ä¸€è¨€ç½®ãã¨è»¸ãŒé€šã‚Šã¾ã™");

  // 2ã¤ã¾ã§
  const merged = [];
  (advice.concat(improveList)).forEach(a => {
    if(!a) return;
    if(merged.includes(a)) return;
    if(merged.length >= 2) return;
    merged.push(a);
  });

  const praise = goodPoints.length
    ? goodPoints[Math.floor(Math.random() * goodPoints.length)]
    : "2åˆ†ã¨ã„ã†é•·ã„æ™‚é–“ã«æŒ‘æˆ¦ã—ãŸã“ã¨è‡ªä½“ãŒç´ æ™´ã‚‰ã—ã„ã§ã™";

  score = Math.min(score, 100);

  const improveText = merged.length
    ? "ğŸ’¡ ã•ã‚‰ã«è‰¯ãã™ã‚‹ãªã‚‰ï¼š\nãƒ»" + merged.join("\nãƒ»")
    : "ğŸ’¡ ã“ã®èª¿å­ã§ç¶šã‘ã¦ã„ãã¾ã—ã‚‡ã†";

  // åŠ´ã„ï¼ˆ2åˆ†å°‚ç”¨ï¼‰
  const warm =
isHeavy
? "2åˆ†ã§â€œã—ã‚“ã©ã„ãƒ†ãƒ¼ãƒâ€ã‚’æ‰±ãˆã‚‹ã®ã¯æœ¬å½“ã«å¼·ã„ã§ã™ã€‚ä¸å¯§ã«è©±ã›ã¦ã„ã¾ã™ğŸ‘"
: "2åˆ†è©±ã—ãã‚‹ã®ã¯ä½“åŠ›ã‚’ä½¿ã„ã¾ã™ãŒã€æœ€å¾Œã¾ã§ã‚ˆãé ‘å¼µã‚Šã¾ã—ãŸğŸ‘";

  const finalBadges = badges.length ? badges : ["å‰å‘ã"];

  return {
    score,
    badges: finalBadges,
    message:
`ğŸŒŸ ç·åˆè©•ä¾¡ï¼š${score}ç‚¹

${warm}

ç‰¹ã«ã€Œ${praise}ã€ç‚¹ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚

${lengthComment}

${improveText}

2åˆ†ã‚¹ãƒ”ãƒ¼ãƒã¯é›£æ˜“åº¦ãŒé«˜ã„ã§ã™ã€‚ä»Šã®ç©ã¿ä¸Šã’ã¯ç¢ºå®Ÿã«åŠ›ã«ãªã£ã¦ã„ã¾ã™ğŸ˜Š`
  };
}

/* =========================
   UIæ“ä½œ
========================= */
function hxRunEvaluation(){
  const text = document.getElementById("hxSpeechText").value;
  const res = hxGentleEvaluate(text);

  const badgesEl = document.getElementById("hxBadges");
  badgesEl.innerHTML = "";
  (res.badges || []).forEach(b => {
    const span = document.createElement("span");
    span.textContent = b;
    span.style.display = "inline-block";
    span.style.padding = "6px 10px";
    span.style.borderRadius = "999px";
    span.style.border = "1px solid #ddd";
    span.style.fontSize = "14px";
    span.style.margin = "4px 6px 0 0";
    badgesEl.appendChild(span);
  });

  document.getElementById("hxResult").textContent = res.message;
}

function hxClearText(){
  document.getElementById("hxSpeechText").value = "";
  document.getElementById("hxBadges").innerHTML = "";
  document.getElementById("hxResult").textContent = "ã“ã“ã«è©•ä¾¡çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
}

function hxInsertTemplate(){
  document.getElementById("hxSpeechText").value =
`ï¼ˆä¾‹ï¼‰ç§ãŒä»Šæ—¥è©±ã—ãŸã„ã®ã¯ã€Œã€‡ã€‡ã€ã§ã™ã€‚
èƒŒæ™¯ã¨ã—ã¦ã€â–³â–³ã¨ã„ã†çŠ¶æ³ãŒã‚ã‚Šã¾ã—ãŸã€‚
å½“æ™‚ã¯â–¡â–¡ãŒèµ·ãã¦ã€ã¨ã¦ã‚‚å°è±¡ã«æ®‹ã£ã¦ã„ã¾ã™ã€‚
ãã“ã‹ã‚‰å­¦ã‚“ã ã®ã¯â—‡â—‡ã§ã™ã€‚
ä»Šå¾Œã¯ã€ã“ã®å­¦ã³ã‚’æ´»ã‹ã—ã¦Ã—Ã—ã—ã¦ã„ããŸã„ã§ã™ã€‚`;
  hxRunEvaluation();
}
</script>

</body>
</html>