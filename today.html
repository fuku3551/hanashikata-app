<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”° ä»Šæ—¥ã®ãŠã™ã™ã‚ç·´ç¿’</title>
<link rel="stylesheet" href="style.css">

<style>
  /* ===== è¡¨ç¤ºã‚µã‚¤ã‚ºï¼ˆå…¨ä½“çš„ã«å¤§ããçµ±ä¸€ï¼‰ ===== */
  .big{
    font-size:40px;
    font-weight:900;
    text-align:center;
    margin:10px 0;
    line-height:1.35;
    word-break:break-word;
    color:#111; /* âœ… åŸºæœ¬æ–‡å­—ã¯é»’ */
  }
  .mid{
    font-size:24px;
    font-weight:900;
    text-align:center;
    margin:6px 0;
  }
  .small{
    text-align:center;
    opacity:.88;
    font-size:18px;
    line-height:1.8;
    white-space:pre-wrap;
  }

  /* ===== ã‚¹ã‚¿ãƒ¼ãƒˆèª˜å°ï¼ˆç‚¹æ»…â¬‡ï¸ï¼‰ ===== */
  .blinkArrow{
    display:inline-block;
    font-size:26px;
    animation: blink 1s steps(2, start) infinite;
    margin-bottom:6px;
  }
  @keyframes blink { 50% { opacity:0; } }

  /* ===== æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆé–‹å§‹å‰ãƒ»å„é …ç›®åˆ‡æ›¿ã®æ¡ˆå†…ï¼‰ ===== */
  .marqueeBox{
    width:100%;
    overflow:hidden;
    border-radius:12px;
    border:1px solid rgba(0,0,0,.12);
    background:rgba(255,255,255,.8);
    padding:8px 10px;
    box-sizing:border-box;
  }
  .marquee{
    display:inline-block;
    white-space:nowrap;
    will-change: transform;
    animation: marqueeMove 9s linear infinite;
    font-weight:900;
    font-size:18px;
  }
  @keyframes marqueeMove{
    0%   { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
  .marquee.paused{ animation-play-state: paused; }
  .marquee.hidden{ display:none; }

  /* ãµã‚ŠãŒãª */
  ruby{ruby-position: over;}
  rt{font-size:11px; opacity:.9;}

  .center{text-align:center;}
  .btnRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px;}

  /* âœ… ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’å¤§ãã */
  .btn{
    padding:16px 20px;
    border-radius:14px;
    border:none;
    font-weight:900;
    font-size:18px;
  }
  .primary{background:#0ea5e9;color:#fff;}
  .danger{background:#ef4444;color:#fff;}
  .ghost{background:#fff;border:1px solid rgba(0,0,0,.2);}

  .pill{
    display:inline-block;
    padding:8px 14px;
    border-radius:999px;
    border:1px solid rgba(0,0,0,.12);
    background:rgba(255,255,255,.75);
    font-size:14px;
    font-weight:900;
  }

  /* âœ… ã‚¹ãƒ”ãƒ¼ãƒé–‹å§‹å‰ï¼šâ¡ï¸ç‚¹æ»… */
  .blinkRight{
    display:inline-block;
    margin-left:8px;
    font-size:20px;
    animation: blink 1s steps(2, start) infinite;
  }

  /* âœ… è¨€ã„ã«ãã„è¨€è‘‰ã ã‘å°‘ã—å°ã•ã */
  .hardText{
    font-size:32px; /* â†ã“ã“ã§å¾®èª¿æ•´OKï¼ˆ30ã€œ34ãã‚‰ã„ãŒæ°—æŒã¡è‰¯ã„ï¼‰ */
    font-weight:900;
    line-height:1.35;
  }
</style>
</head>

<body>

<header class="top">
  <h1>ğŸ”° ä»Šæ—¥ã®ãŠã™ã™ã‚ç·´ç¿’</h1>
  <p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸</a></p>
</header>

<main class="menu">

  <div class="card">
    <div class="title">ä¸€æœ¬é“ãƒ«ãƒ¼ãƒˆï¼ˆç´„4ã€œ6åˆ†ï¼‰</div>
    <div class="desc small">
å‘¼å¸ â†’ èˆŒãƒˆãƒ¬ â†’ æ»‘èˆŒï¼ˆã‚ã€œã‚è¡Œï¼‰â†’ è¨€ã„ã«ãã„15é¸ â†’ 40ç§’ã‚¹ãƒ”ãƒ¼ãƒ
    </div>

    <!-- âœ…â‘  é–‹å§‹å‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆæŠ¼ã™ã¾ã§æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ -->
    <div class="marqueeBox" style="margin-top:10px;">
      <span id="preMarquee" class="marquee">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ãŸã‚‰è…¹å¼å‘¼å¸ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€€ï¼ã€€ã‚¹ãƒãƒ›ã¯æ¨ªå‘ãæ¨å¥¨ã€€ï¼ã€€é€”ä¸­ã§æ­¢ã‚ãŸã„æ™‚ã¯ã€Œåœæ­¢ã€</span>
    </div>

    <div class="center" style="margin-top:12px;">
      <div id="startHint" class="blinkArrow">â¬‡ï¸â¬‡ï¸â¬‡ï¸</div>

      <div class="btnRow">
        <button id="startBtn" class="btn primary" onclick="startAll()" style="min-width:220px;">â–¶ é–‹å§‹</button>
        <button class="btn danger" onclick="stopAll()">â¹ åœæ­¢</button>
        <button class="btn ghost" onclick="changeTopic()">ğŸ² è©±é¡Œå¤‰æ›´</button>
      </div>
    </div>

    <div class="center" style="margin-top:10px;">
      <span class="pill" id="statePill">å¾…æ©Ÿä¸­</span>
    </div>
  </div>

  <div class="card">
    <div id="phase" class="mid">æº–å‚™OK</div>

    <div class="marqueeBox" style="margin:10px 0;">
      <span id="infoMarquee" class="marquee hidden">æ¡ˆå†…</span>
    </div>

    <div id="display" class="big">00</div>
    <div id="sub" class="small">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„</div>
  </div>

</main>

<script>
/* =========================
   å…¨ä½“åˆ¶å¾¡
========================= */
let runToken = 0;
let speechToken = 0;
let speechRunning = false;

function wait(ms){ return new Promise(res=>setTimeout(res,ms)); }

function setPhase(t){ document.getElementById("phase").textContent=t; }
function setDisplay(html){ document.getElementById("display").innerHTML=html; }
function setSub(t){ document.getElementById("sub").textContent=t; }
function setState(t){ document.getElementById("statePill").textContent=t; }
function isStopped(token){ return token !== runToken; }

/* ===== æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡ ===== */
function showInfoMarquee(text){
  const el = document.getElementById("infoMarquee");
  el.textContent = text;
  el.classList.remove("hidden");
  el.classList.remove("paused");
}
function hideInfoMarquee(){
  document.getElementById("infoMarquee").classList.add("hidden");
}
function pausePreMarquee(){
  document.getElementById("preMarquee").classList.add("paused");
}
function resumePreMarquee(){
  document.getElementById("preMarquee").classList.remove("paused");
}

/* ===== åœæ­¢ ===== */
function stopAll(){
  runToken++;
  speechToken++;
  speechRunning = false;

  hideInfoMarquee();
  resumePreMarquee();
  document.getElementById("startHint").style.display = "inline-block";

  setState("åœæ­¢");
  setPhase("â¹ åœæ­¢ã—ã¾ã—ãŸ");
  setDisplay("00");
  setSub("å†é–‹ã™ã‚‹å ´åˆã¯ã€Œé–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„");
}

/* =========================
   âœ…â‘  å‘¼å¸ 4-4-8 Ã—3
   - æ–‡å­—ã¯é»’
   - æ–‡è¨€ã¯åˆæœŸã®ã¾ã¾
   - ã‚«ã‚¦ãƒ³ãƒˆã¯ãã®ã¾ã¾
========================= */
async function breathing(token){
  setPhase("ğŸ’¨ è…¹å¼å‘¼å¸");
  showInfoMarquee("è…¹å¼å‘¼å¸ï¼šå¸ã£ã¦4ç§’ â†’ æ­¢ã‚ã¦4ç§’ â†’ åã„ã¦8ç§’ã€€ï¼ã€€ã‚†ã£ãã‚Šã§OK");
  await wait(900);
  if(isStopped(token)) return;
  hideInfoMarquee();

  for(let round=1; round<=3; round++){
    if(isStopped(token)) return;

    setSub(`ãƒ©ã‚¦ãƒ³ãƒ‰ ${round}/3`);

    // ã¯ã„å¸ã£ã¦ã‚¹ã‚¥ã€œï¼ˆ4ç§’ï¼‰
    setDisplay(`<div>ã¯ã„å¸ã£ã¦ã‚¹ã‚¥ã€œ</div><div style="font-size:18px;opacity:.9;">4ç§’</div>`);
    for(let i=1;i<=4;i++){
      if(isStopped(token)) return;
      await wait(1000);
    }

    // ã¯ã„æ­¢ã‚ã¦ï¼ˆ4ç§’ï¼‰
    setDisplay(`<div>ã¯ã„æ­¢ã‚ã¦</div><div style="font-size:18px;opacity:.9;">4ç§’</div>`);
    for(let i=1;i<=4;i++){
      if(isStopped(token)) return;
      await wait(1000);
    }

    // ã¯ã„åã„ã¦ãƒ•ã‚¥ã€œï¼ˆ8ç§’ï¼‰
    setDisplay(`<div>ã¯ã„åã„ã¦ãƒ•ã‚¥ã€œ</div><div style="font-size:18px;opacity:.9;">8ç§’</div>`);
    for(let i=1;i<=8;i++){
      if(isStopped(token)) return;
      await wait(1000);
    }
  }

  setDisplay(" ");
  setSub("å‘¼å¸OKï¼æ¬¡ã¸é€²ã¿ã¾ã™ã€‚");
}

/* =========================
   âœ…â‘¡ èˆŒãƒˆãƒ¬ï¼ˆå°å…¥ãƒ•ãƒ¬ãƒ¼ã‚ºï¼‹3ç§’å¾Œé–‹å§‹ï¼‰
========================= */
async function tongue(token){
  setPhase("ğŸ‘… èˆŒãƒˆãƒ¬");
  showInfoMarquee("æ¬¡ã¯èˆŒãƒˆãƒ¬ãŒå§‹ã¾ã‚Šã¾ã™ã€‚èˆŒå…ˆã§å£ã®ä¸­ã«å¤§ããªå††ã‚’æã„ã¦è¡Œãã¾ã—ã‚‡ã†ã€‚å³ã‹ã‚‰3ç§’å¾Œã«ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã™ã€‚");
  setSub("æº–å‚™ã—ã¦ãã ã•ã„");
  setDisplay("3");
  for(let c=3;c>=1;c--){
    if(isStopped(token)) return;
    setDisplay(String(c));
    await wait(1000);
  }
  hideInfoMarquee();

  setSub("å³å›ã‚Š 7å›ï¼ˆ1å›ï¼3ç§’ï¼‰");
  setDisplay(" ");
  await wait(900);

  for(let i=1;i<=7;i++){
    if(isStopped(token)) return;
    setDisplay(i);
    await wait(3000);
  }

  setSub("å·¦å›ã‚Š 7å›ï¼ˆ1å›ï¼3ç§’ï¼‰");
  setDisplay(" ");
  await wait(900);

  for(let i=1;i<=7;i++){
    if(isStopped(token)) return;
    setDisplay(i);
    await wait(3000);
  }

  setSub("OKï¼èˆŒãŒå‹•ãã‚„ã™ããªã‚Šã¾ã—ãŸã€‚");
  setDisplay(" ");
}

/* =========================
   ã‚«ãƒ©ã‚ªã‚±DOMç”Ÿæˆï¼ˆæ»‘èˆŒç”¨ï¼‰
========================= */
function buildCharTargetsFromText(text){
  const display = document.getElementById("display");
  display.className = "big";
  display.innerHTML = "";

  const wrapper = document.createElement("div");
  wrapper.style.display = "inline-block";
  wrapper.style.textAlign = "center";

  const targets = [];
  for(const ch of Array.from(text)){
    const sp = document.createElement("span");
    sp.textContent = ch;
    wrapper.appendChild(sp);
    targets.push(sp);
  }

  display.appendChild(wrapper);
  return targets;
}

async function simpleStepText(token, text, unitMs){
  const targets = buildCharTargetsFromText(text);
  for(let i=0;i<targets.length;i++){
    if(isStopped(token)) return;
    // è‰²ä»˜ã‘ç­‰ãªã—ï¼šå˜ç´”ã«æ™‚é–“ã§é€²ã‚ã‚‹ï¼ˆæ»‘èˆŒã¯ãƒ†ãƒ³ãƒé‡è¦–ï¼‰
    await wait(unitMs);
  }
  await wait(250);
}

/* =========================
   æ»‘èˆŒï¼ˆã‚è¡Œã€œã‚è¡Œï¼‰1ç§’/1èª
========================= */
async function gyou(token){
  await wait(1800);
  if(isStopped(token)) return;

  setPhase("ğŸ‘„ æ»‘èˆŒï¼ˆã‚ã€œã‚è¡Œï¼‰");
  showInfoMarquee("æ¬¡ã¯æ»‘èˆŒã§ã™ã€‚1èªãšã¤ä¸å¯§ã«ç™ºå£°ã—ã¾ã—ã‚‡ã†ï¼ˆ1ç§’/1èªï¼‰");
  await wait(900);
  if(isStopped(token)) return;
  hideInfoMarquee();

  const lines=[
    "ã‚ã„ã†ãˆãŠ",
    "ã‹ããã‘ã“",
    "ã•ã—ã™ã›ã",
    "ãŸã¡ã¤ã¦ã¨",
    "ãªã«ã¬ã­ã®",
    "ã¯ã²ãµã¸ã»",
    "ã¾ã¿ã‚€ã‚ã‚‚",
    "ã‚„ã‚†ã‚ˆ",
    "ã‚‰ã‚Šã‚‹ã‚Œã‚",
    "ã‚ã‚’ã‚“"
  ];

  for(const l of lines){
    if(isStopped(token)) return;
    setSub("1èªãšã¤ä¸å¯§ã«");
    setDisplay(l);
    await wait(1000);
  }
  setDisplay(" ");
}

/* =========================
   âœ…â‘¢ è¨€ã„ã«ãã„15é¸
   - ã‚«ãƒ©ã‚ªã‚±è‰²ä»˜ã‘ç„¡ã—
   - æ–‡å­—ã¯å°‘ã—å°ã•ã‚ï¼ˆhardTextï¼‰
   - åˆ‡ã‚Šæ›¿ãˆæ™‚ã¯æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ¡ˆå†… ç¶™ç¶š
========================= */
async function hard15(token){
  await wait(1800);
  if(isStopped(token)) return;

  setPhase("ğŸ“¢ è¨€ã„ã«ãã„ãƒ•ãƒ¬ãƒ¼ã‚º15é¸");
  showInfoMarquee("æ¬¡ã¯è¨€ã„ã«ãã„è¨€è‘‰ã§ã™ã€‚ç„¦ã‚‰ãšã€ãƒãƒƒã‚­ãƒªã€ã‚†ã£ãã‚Šã€‚æ¬¡ã®è¨€è‘‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã¾ã§3ç§’å¾…ã¡ã¾ã™ã€‚");
  await wait(1000);
  if(isStopped(token)) return;
  hideInfoMarquee();

  const list=[
    "æ±äº¬ç‰¹è¨±è¨±å¯å±€",
    "ç”Ÿéº¦ ç”Ÿç±³ ç”Ÿåµ",
    "èµ¤å·»ç´™ é’å·»ç´™ é»„å·»ç´™",
    "éš£ã®å®¢ã¯ã‚ˆãæŸ¿é£Ÿã†å®¢ã ",
    "æ‰“è€…èµ°è€…å‹è€…",
    "é­”è¡“å¸«æ‰‹è¡“ä¸­",
    "æ—…å®¢æ©Ÿ æ—…å®¢èˆ¹ æ—…é¤¨",
    "å–æ¨é¸æŠ è©¦å†™å®¤ æ”¯ç¤¾è¦–å¯Ÿ",
    "æœ€çµ‚æ‰‹æ®µ åé›† é›†ä¸­",
    "ç‰¹æ€¥åˆ—è»Š æ™®é€šåˆ—è»Š",
    "æ–°æ˜¥ã‚·ãƒ£ãƒ³ã‚½ãƒ³ã‚·ãƒ§ãƒ¼",
    "è²¨å®¢èˆ¹ã¨æ—…å®¢èˆ¹",
    "éš£ç”ºã®å®¢ãŒæŸ¿ã‚’è²·ã†",
    "æ—©å£è¨€è‘‰ã¯ç„¦ã‚‰ãšæ­£ç¢ºã«",
    "ç™ºå£°ã¨æ»‘èˆŒã¯æ¯æ—¥ã®ç©ã¿é‡ã­"
  ];

  for(const item of list){
    if(isStopped(token)) return;

    setSub("ã¯ã£ãã‚Šç™ºå£°ï¼ˆã‚†ã£ãã‚Šï¼‰");
    setDisplay(`<div class="hardText">${item}</div>`);

    // è¡¨ç¤ºã‚­ãƒ¼ãƒ—ï¼ˆèª­ã¿ã®æ™‚é–“ï¼‰
    await wait(4500);

    // æ¬¡ã®è¨€è‘‰ã¾ã§3ç§’å¾…ã¤
    for(let i=0;i<3;i++){
      if(isStopped(token)) return;
      await wait(1000);
    }
  }

  setDisplay(" ");
}

/* =========================
   40ç§’ã‚¹ãƒ”ãƒ¼ãƒï¼ˆæº–å‚™10ç§’ â†’ é–‹å§‹40ç§’ï¼‰
========================= */
const topics=[
  "ã‚ãªãŸã®å¥½ããªé£Ÿã¹ç‰©ï¼ˆç†ç”±ã‚‚æ·»ãˆã¦ï¼‰",
  "ã‚ãªãŸã®è‹¦æ‰‹ãªé£Ÿã¹ç‰©ï¼ˆã©ã†å·¥å¤«ã—ã¦ã‚‹ï¼Ÿï¼‰",
  "ã‚ãªãŸã®å‡ºèº«åœ°ï¼ˆãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆï¼‰",
  "å­ã©ã‚‚ã®é ƒã‚ˆãéŠã‚“ã ã“ã¨",
  "æ˜”ã‚„ã£ã¦ã„ãŸã‚¹ãƒãƒ¼ãƒ„ï¼ˆæ€ã„å‡ºï¼‰",
  "ä»Šä½ã‚“ã§ã„ã‚‹å ´æ‰€ï¼ˆå¥½ããªæ‰€ï¼‰",
  "ã‚ãªãŸã®ä»•äº‹ï¼ˆä¸€è¨€ã§è¨€ã†ã¨ï¼‰",
  "ã“ã‚Œã‹ã‚‰æŒ‘æˆ¦ã—ãŸã„ä»•äº‹ãƒ»æ´»å‹•",
  "æœ€è¿‘ã†ã‚Œã—ã‹ã£ãŸã“ã¨",
  "æœ€è¿‘å­¦ã‚“ã ã“ã¨",
  "æœ€è¿‘ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã“ã¨",
  "ã‚ãªãŸã®å¼·ã¿ï¼ˆã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ä»˜ãï¼‰",
  "ã‚ãªãŸã®å¼±ã¿ï¼ˆæ”¹å–„ã®å·¥å¤«ï¼‰",
  "å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³",
  "äººã«è¤’ã‚ã‚‰ã‚Œã¦å¬‰ã—ã‹ã£ãŸã“ã¨",
  "æœ€è¿‘ãƒãƒã£ã¦ã„ã‚‹ã“ã¨",
  "æœ€è¿‘è¦‹ãŸ/èª­ã‚“ã ã‚‚ã®ã§å°è±¡ã«æ®‹ã£ãŸã‚‚ã®",
  "å°Šæ•¬ã™ã‚‹äººï¼ˆç†ç”±ï¼‰",
  "æ„Ÿè¬ã—ã¦ã„ã‚‹äººï¼ˆç†ç”±ï¼‰",
  "ã„ã¾é ‘å¼µã£ã¦ã„ã‚‹ã“ã¨",
  "æœ€è¿‘ã®å°ã•ãªæˆåŠŸ",
  "æœ€è¿‘ã®å¤±æ•—ã¨å­¦ã³",
  "ã‚ãªãŸã®æœã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³",
  "ã‚ãªãŸã®å¤œã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³",
  "ä¼‘æ—¥ã®éã”ã—æ–¹",
  "ã‚ãªãŸã®ãƒªãƒ©ãƒƒã‚¯ã‚¹æ–¹æ³•",
  "ä»Šå¹´ã‚„ã‚ŠãŸã„ã“ã¨",
  "5å¹´å¾Œã“ã†ãªã£ã¦ã„ãŸã„ï¼ˆç†æƒ³ï¼‰",
  "è‡ªåˆ†ã‚’ä¸€è¨€ã§è¡¨ã™ã¨ï¼Ÿï¼ˆç†ç”±ã‚‚ï¼‰",
  "è‡ªå·±ç´¹ä»‹ï¼ˆåå‰/ä»•äº‹/æœ€è¿‘ã®ãƒ†ãƒ¼ãƒï¼‰"
];
let currentTopic = "";
function pickTopic(){ return topics[Math.floor(Math.random()*topics.length)]; }

function changeTopic(){
  currentTopic = pickTopic();
  if(!speechRunning){
    setSub(`ï¼ˆè©±é¡Œï¼‰${currentTopic}\nâ€»ã‚¹ãƒ”ãƒ¼ãƒé–‹å§‹æ™‚ã«ã“ã®è©±é¡Œã§è¡Œãã¾ã™`);
  }else{
    setSub(`ï¼ˆå¤‰æ›´ï¼‰${currentTopic}\nã“ã®è©±é¡Œã§ç¶šã‘ã¦OKï¼`);
  }
}

async function speech40(token){
  if(isStopped(token)) return;

  setPhase("ğŸ¤ 40ç§’ã‚¹ãƒ”ãƒ¼ãƒï¼ˆæº–å‚™ï¼‰");
  setState("ã‚¹ãƒ”ãƒ¼ãƒæº–å‚™");
  speechRunning = true;

  if(!currentTopic) currentTopic = pickTopic();

  setDisplay(`ãŠé¡Œï¼š${currentTopic}<span class="blinkRight">â¡ï¸</span>`);
  setSub("æ­¢ã‚ãŸã„æ™‚ã¯ã€Œåœæ­¢ã€ / è©±é¡Œã‚’å¤‰ãˆãŸã„æ™‚ã¯ã€Œè©±é¡Œå¤‰æ›´ã€");

  showInfoMarquee("10ç§’å¾Œã«ã‚¹ãƒ”ãƒ¼ãƒã‚’é–‹å§‹ã—ã¾ã™ã€€ï¼ã€€çµè«–â†’ç†ç”±â†’å…·ä½“ä¾‹â†’çµè«– ã‚’æ„è­˜ã—ã¦ã¿ã¾ã—ã‚‡ã†");

  const mySpeechToken = ++speechToken;
  for(let sec=10; sec>=1; sec--){
    if(isStopped(token)) return;
    if(mySpeechToken !== speechToken) return;
    setPhase(`ğŸ¤ 40ç§’ã‚¹ãƒ”ãƒ¼ãƒï¼ˆé–‹å§‹ã¾ã§ ${sec}ç§’ï¼‰`);
    await wait(1000);
  }

  if(isStopped(token)) return;
  if(mySpeechToken !== speechToken) return;

  hideInfoMarquee();
  setPhase("ğŸ¤ 40ç§’ã‚¹ãƒ”ãƒ¼ãƒï¼ˆé–‹å§‹ï¼‰");
  setState("ã‚¹ãƒ”ãƒ¼ãƒä¸­");

  setDisplay("40");
  for(let i=40;i>=0;i--){
    if(isStopped(token)) return;
    if(mySpeechToken !== speechToken) return;
    setDisplay(i);
    await wait(1000);
  }

  speechRunning = false;
  setState("é€²è¡Œä¸­");
}

/* =========================
   å…¨ä½“ã‚¹ã‚¿ãƒ¼ãƒˆ
========================= */
async function startAll(){
  runToken++;
  const token = runToken;

  pausePreMarquee();
  document.getElementById("startHint").style.display = "none";

  setState("é€²è¡Œä¸­");
  speechRunning = false;
  currentTopic = pickTopic();
  hideInfoMarquee();

  try{
    setPhase("æº–å‚™â€¦");
    setDisplay(" ");
    setSub("ã“ã‚Œã‹ã‚‰å§‹ã¾ã‚Šã¾ã™");
    await wait(700);

    await breathing(token);
    if(isStopped(token)) return;

    await wait(1200);
    await tongue(token);
    if(isStopped(token)) return;

    await gyou(token);
    if(isStopped(token)) return;

    await hard15(token);
    if(isStopped(token)) return;

    await speech40(token);
    if(isStopped(token)) return;

    setPhase("âœ¨ ãŠç–²ã‚Œæ§˜ã§ã—ãŸ");
    setDisplay("ğŸ˜Š");
    setSub("ã“ã®èª¿å­ã§ç„¦ã‚‰ãšç¶šã‘ã¦ã„ãã¾ã—ã‚‡ã†â™ª");
    setState("å®Œäº†");

    resumePreMarquee();
    document.getElementById("startHint").style.display = "inline-block";

  }catch(e){
    setPhase("âš ï¸ ã‚¨ãƒ©ãƒ¼");
    setDisplay("â€¦");
    setSub("ä¸€åº¦ã€Œåœæ­¢ã€â†’ã€Œé–‹å§‹ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„");
    setState("åœæ­¢");
    resumePreMarquee();
    document.getElementById("startHint").style.display = "inline-block";
  }
}

/* åˆæœŸè¡¨ç¤ºï¼šè©±é¡Œã‚’æº–å‚™ */
currentTopic = pickTopic();
</script>

</body>
</html>