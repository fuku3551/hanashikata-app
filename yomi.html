<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>外郎売（縦書き朗読モード）</title>
<link rel="stylesheet" href="style.css">

<style>
body{
  margin:0;
  overflow:hidden;
}

#reader{
  writing-mode: vertical-rl;
  text-orientation: mixed;
  font-size:18px;
  line-height:2.2;
  height:100vh;
  overflow:hidden;
  padding:20px 40px;
  position:relative;
  white-space:pre-wrap;
}

.column{
  display:inline-block;
  height:100%;
  vertical-align:top;
  padding:0 12px;
}

.guideLine{
  position:absolute;
  top:0;
  bottom:0;
  width:2px;
  background:rgba(255,0,0,0.25);
  right:0;
  transition:transform .4s ease;
}

.controls{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(255,255,255,.9);
  padding:10px 16px;
  border-radius:16px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  font-size:14px;
}

button{
  padding:6px 10px;
  border-radius:8px;
  border:1px solid #ccc;
  background:#fff;
}

.speed{
  font-size:12px;
}
</style>
</head>

<body>

<div id="reader"></div>
<div class="guideLine" id="guide"></div>

<div class="controls">
  <button onclick="toggleGuide()">ガイドON/OFF</button>
  <button onclick="toggleAuto()">自動送りON/OFF</button>
  <button onclick="slower()">−</button>
  <button onclick="faster()">＋</button>
  <span class="speed">速度:<span id="speedLabel">1500</span>ms</span>
</div>

<script>

let speed = 1500;
let auto = false;
let guideOn = true;
let timer = null;
let columnIndex = 0;

const text = `（ここに外郎売本文をそのまま貼ってください）`;

function buildColumns(){
  const reader = document.getElementById("reader");
  reader.innerHTML = "";

  const columnWidth = 40; 
  const charsPerColumn = Math.floor(window.innerHeight / 22);

  let current = "";
  let count = 0;

  for(let char of text){
    current += char;
    count++;

    if(count >= charsPerColumn){
      addColumn(current);
      current="";
      count=0;
    }
  }

  if(current) addColumn(current);
}

function addColumn(content){
  const col = document.createElement("div");
  col.className="column";
  col.textContent=content;
  document.getElementById("reader").appendChild(col);
}

function moveGuide(){
  const guide = document.getElementById("guide");
  guide.style.transform = `translateX(-${columnIndex*60}px)`;
}

function toggleGuide(){
  guideOn=!guideOn;
  document.getElementById("guide").style.display = guideOn?"block":"none";
}

function toggleAuto(){
  auto=!auto;
  if(auto) startAuto();
  else stopAuto();
}

function startAuto(){
  stopAuto();
  timer=setInterval(()=>{
    columnIndex++;
    moveGuide();
  },speed);
}

function stopAuto(){
  if(timer){
    clearInterval(timer);
    timer=null;
  }
}

function slower(){
  speed+=300;
  updateSpeed();
}

function faster(){
  speed=Math.max(300,speed-300);
  updateSpeed();
}

function updateSpeed(){
  document.getElementById("speedLabel").textContent=speed;
  if(auto){
    startAuto();
  }
}

window.addEventListener("resize",()=>{
  columnIndex=0;
  buildColumns();
  moveGuide();
});

buildColumns();
moveGuide();

</script>

</body>
</html>