<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIè©•ä¾¡ï¼ˆç°¡æ˜“ï¼‰</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .btn { padding:10px 14px; border-radius:10px; border:1px solid #ddd; background:#fff; }
    .btn.primary { border-color:#555; font-weight:700; }
    textarea { width:100%; min-height:180px; padding:12px; border-radius:12px; border:1px solid #ddd; }
    .out { white-space:pre-wrap; background:#fff; border:1px solid #ddd; border-radius:12px; padding:12px; }
    .muted { opacity:0.7; font-size:0.95em; }
    .tab { display:none; }
    .tab.active { display:block; }
  </style>
</head>

<body>
  <header class="top">
    <h1>ğŸ§  AIè©•ä¾¡ï¼ˆç°¡æ˜“ï¼‰</h1>
    <p class="sub">ãƒ†ã‚­ã‚¹ãƒˆè²¼ã‚Šä»˜ã‘ / éŒ²éŸ³â†’æ–‡å­—èµ·ã“ã—â†’è©•ä¾¡ï¼ˆâ€»ç°¡æ˜“ï¼‰</p>
    <p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a></p>
  </header>

  <main class="menu">

    <div class="card" style="display:block;">
      <div class="title">ãƒ¢ãƒ¼ãƒ‰é¸æŠ</div>
      <div class="desc">
        <div class="row">
          <button class="btn primary" id="btnTabText">â‘  ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡</button>
          <button class="btn" id="btnTabVoice">â‘¡ éŒ²éŸ³â†’æ–‡å­—èµ·ã“ã—</button>
        </div>
        <p class="muted">â€»â€œChatGPTæ¡ç‚¹â€ã‚’å…¥ã‚Œã‚‹ã«ã¯åˆ¥é€”ã‚µãƒ¼ãƒãƒ¼ï¼ˆAPIã‚­ãƒ¼ä¿è­·ï¼‰ãŒå¿…è¦ã§ã™ã€‚ã¾ãšã¯ç°¡æ˜“è©•ä¾¡ã§OKã€‚</p>
      </div>
    </div>

    <!-- â‘  ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡ -->
    <div class="card tab active" id="tabText" style="display:block;">
      <div class="title">â‘  ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡ï¼ˆè²¼ã‚Šä»˜ã‘ï¼‰</div>
      <div class="desc">
        <textarea id="textInput" placeholder="ã“ã“ã«ã‚¹ãƒ”ãƒ¼ãƒå†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆã¾ãŸã¯å…¥åŠ›ï¼‰"></textarea>
        <div class="row" style="margin-top:10px;">
          <button class="btn primary" id="btnEvalText">è©•ä¾¡ã™ã‚‹</button>
          <button class="btn" id="btnClearText">æ¶ˆå»</button>
        </div>
        <div class="out" id="resultText" style="margin-top:10px;">ã“ã“ã«è©•ä¾¡çµæœãŒå‡ºã¾ã™ã€‚</div>
      </div>
    </div>

    <!-- â‘¡ éŸ³å£°â†’æ–‡å­—èµ·ã“ã— -->
    <div class="card tab" id="tabVoice" style="display:block;">
      <div class="title">â‘¡ éŒ²éŸ³â†’æ–‡å­—èµ·ã“ã—ï¼ˆç«¯æœ«å¯¾å¿œæ™‚ã®ã¿ï¼‰</div>
      <div class="desc">
        <p class="muted">
          iPhone/Safariã¯ç’°å¢ƒã«ã‚ˆã£ã¦ã€Œè‡ªå‹•æ–‡å­—èµ·ã“ã—ã€ãŒå‹•ã‹ãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚<br>
          ãã®å ´åˆã¯ã€iPhoneã®éŸ³å£°å…¥åŠ›ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ğŸ¤ï¼‰ã§æ–‡ç« åŒ–ã—ã¦ã€ä¸Šã®â‘ ã«è²¼ã‚Šä»˜ã‘ã¦OKã§ã™ã€‚
        </p>

        <div class="row" style="margin:10px 0;">
          <button class="btn primary" id="btnStart">â–¶ æ–‡å­—èµ·ã“ã—é–‹å§‹</button>
          <button class="btn" id="btnStop">â–  åœæ­¢</button>
          <button class="btn" id="btnUseTranscript">â†’ ã“ã®æ–‡ç« ã§è©•ä¾¡</button>
        </div>

        <textarea id="transcript" placeholder="ã“ã“ã«æ–‡å­—èµ·ã“ã—çµæœãŒå…¥ã‚Šã¾ã™ï¼ˆæ‰‹å…¥åŠ›/è²¼ã‚Šä»˜ã‘ã‚‚OKï¼‰"></textarea>

        <div class="out" id="resultVoice" style="margin-top:10px;">ã“ã“ã«è©•ä¾¡çµæœãŒå‡ºã¾ã™ã€‚</div>
      </div>
    </div>

  </main>

<script>
  // --- Tabs ---
  const btnTabText = document.getElementById("btnTabText");
  const btnTabVoice = document.getElementById("btnTabVoice");
  const tabText = document.getElementById("tabText");
  const tabVoice = document.getElementById("tabVoice");

  function setTab(which){
    if(which === "text"){
      tabText.classList.add("active");
      tabVoice.classList.remove("active");
      btnTabText.classList.add("primary");
      btnTabVoice.classList.remove("primary");
    }else{
      tabVoice.classList.add("active");
      tabText.classList.remove("active");
      btnTabVoice.classList.add("primary");
      btnTabText.classList.remove("primary");
    }
  }
  btnTabText.onclick = () => setTab("text");
  btnTabVoice.onclick = () => setTab("voice");

  // --- Simple evaluator (offline) ---
  function evaluate(text){
    const t = (text || "").trim();
    if(!t) return "æ–‡ç« ãŒç©ºã§ã™ã€‚ã¾ãšã¯å†…å®¹ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚";

    const chars = t.replace(/\s/g, "").length;
    const sentences = t.split(/ã€‚|ï¼|!|ï¼Ÿ|\?/).filter(s => s.trim().length>0).length;

    // ãƒ•ã‚£ãƒ©ãƒ¼æ¤œå‡ºï¼ˆç°¡æ˜“ï¼‰
    const fillers = ["ãˆãƒ¼","ãˆã£ã¨","ã‚ã®","ãã®ãƒ¼","ã¾ã‚","ãªã‚“ã‹","ãˆã¨"];
    let fillerCount = 0;
    fillers.forEach(f => {
      const m = t.match(new RegExp(f, "g"));
      if(m) fillerCount += m.length;
    });

    // æ§‹æˆãƒ’ãƒ³ãƒˆï¼ˆç°¡æ˜“ï¼‰
    const hasConclusion = /(çµè«–|ã¤ã¾ã‚Š|è¦ã™ã‚‹ã«|ä¸€è¨€ã§è¨€ã†ã¨)/.test(t);
    const hasReason = /(ç†ç”±|ãªãœãªã‚‰|ã¨ã„ã†ã®ã¯)/.test(t);
    const hasExample = /(ä¾‹ãˆã°|ãŸã¨ãˆã°|å…·ä½“çš„ã«|ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰)/.test(t);

    let score = 70;
    if(chars < 120) score -= 10;
    if(chars > 900) score -= 5;
    if(sentences < 3) score -= 10;
    if(fillerCount >= 5) score -= 8;
    if(hasConclusion) score += 5;
    if(hasReason) score += 5;
    if(hasExample) score += 5;
    score = Math.max(0, Math.min(100, score));

    const tips = [];
    tips.push(`æ–‡å­—æ•°: ${chars} / æ–‡ã®æ•°(ç›®å®‰): ${sentences}`);
    tips.push(`ãƒ•ã‚£ãƒ©ãƒ¼ï¼ˆãˆãƒ¼/ã‚ã®ç­‰ï¼‰: ${fillerCount} å›ï¼ˆâ€»ç°¡æ˜“ã‚«ã‚¦ãƒ³ãƒˆï¼‰`);

    const structure = [];
    structure.push(`çµè«–ãƒ¯ãƒ¼ãƒ‰: ${hasConclusion ? "â—¯" : "â–³ï¼ˆå†’é ­ã«â€œçµè«–â€ã‚’ä¸€è¨€å…¥ã‚Œã‚‹ã¨å¼·ã„ï¼‰"}`);
    structure.push(`ç†ç”±ãƒ¯ãƒ¼ãƒ‰: ${hasReason ? "â—¯" : "â–³ï¼ˆâ€œãªãœãªã‚‰â€ã§ç†ç”±ã‚’1ã¤å…¥ã‚Œã‚‹ï¼‰"}`);
    structure.push(`å…·ä½“ä¾‹ãƒ¯ãƒ¼ãƒ‰: ${hasExample ? "â—¯" : "â–³ï¼ˆâ€œä¾‹ãˆã°â€ã§1ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰å…¥ã‚Œã‚‹ï¼‰"}`);

    const improve = [];
    if(!hasConclusion) improve.push("æœ€åˆã®1æ–‡ã‚’ã€çµè«–ï¼šã€œã§ã™ã€‚ã€ã«ã—ã¦ã¿ã‚‹");
    if(!hasReason) improve.push("ä¸­ç›¤ã§ã€ãªãœãªã‚‰ã€œã€ã‚’1å›å…¥ã‚Œã‚‹");
    if(!hasExample) improve.push("æœ€å¾Œã®å‰ã«çŸ­ã„å…·ä½“ä¾‹ï¼ˆ1ã€œ2æ–‡ï¼‰ã‚’å…¥ã‚Œã‚‹");
    if(fillerCount >= 5) improve.push("ã€ãˆãƒ¼/ã‚ã®ã€ãŒå‡ºãã†ã«ãªã£ãŸã‚‰ä¸€å‘¼å¸ã—ã¦â€œé–“â€ã‚’ä½œã‚‹");
    if(chars < 120) improve.push("çŸ­ã„ã®ã§ã€ç†ç”±ã‹å…·ä½“ä¾‹ã‚’è¿½åŠ ã—ã¦40ç§’åˆ†ã«è¿‘ã¥ã‘ã‚‹");

    return [
      `ã€ç°¡æ˜“ã‚¹ã‚³ã‚¢ã€‘${score}/100`,
      "",
      "ã€ãƒã‚§ãƒƒã‚¯ã€‘",
      ...tips,
      "",
      "ã€æ§‹æˆã€‘ï¼ˆçµè«–â†’ç†ç”±â†’å…·ä½“ä¾‹ ãŒåŸºæœ¬ï¼‰",
      ...structure,
      "",
      "ã€æ”¹å–„æ¡ˆã€‘",
      ...(improve.length ? improve.map(x => "ãƒ»" + x) : ["ãƒ»ã“ã®ã¾ã¾ã§OKã€‚æ¬¡ã¯â€œé–“â€ã¨â€œå¼·èª¿â€ã‚’æ„è­˜ã™ã‚‹ã¨ã•ã‚‰ã«è‰¯ã„ã§ã™ã€‚"])
    ].join("\n");
  }

  // --- Text tab handlers ---
  const textInput = document.getElementById("textInput");
  const resultText = document.getElementById("resultText");
  document.getElementById("btnEvalText").onclick = () => {
    resultText.textContent = evaluate(textInput.value);
  };
  document.getElementById("btnClearText").onclick = () => {
    textInput.value = "";
    resultText.textContent = "ã“ã“ã«è©•ä¾¡çµæœãŒå‡ºã¾ã™ã€‚";
  };

  // --- Voice (SpeechRecognition) ---
  const transcript = document.getElementById("transcript");
  const resultVoice = document.getElementById("resultVoice");
  let rec = null;

  function setupRecognition(){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR) return null;
    const r = new SR();
    r.lang = "ja-JP";
    r.interimResults = true;
    r.continuous = true;

    r.onresult = (event) => {
      let finalText = "";
      for(let i=0; i<event.results.length; i++){
        const res = event.results[i];
        if(res.isFinal) finalText += res[0].transcript;
      }
      // interimã‚‚å«ã‚ã¦è¡¨ç¤ºï¼ˆé›‘ã«ä¸Šæ›¸ãï¼‰
      const latest = event.results[event.results.length - 1][0].transcript;
      transcript.value = (finalText + latest).trim();
    };

    r.onerror = (e) => {
      resultVoice.textContent = "æ–‡å­—èµ·ã“ã—ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã—ãŸã€‚iPhoneã®éŸ³å£°å…¥åŠ›ã§æ–‡ç« åŒ–ã—ã¦â‘ ã«è²¼ã‚Šä»˜ã‘ã‚‹æ–¹æ³•ãŒç¢ºå®Ÿã§ã™ã€‚\n\nError: " + e.error;
    };
    return r;
  }

  document.getElementById("btnStart").onclick = () => {
    if(!rec) rec = setupRecognition();
    if(!rec){
      resultVoice.textContent = "ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯è‡ªå‹•æ–‡å­—èµ·ã“ã—ï¼ˆSpeechRecognitionï¼‰ã«æœªå¯¾å¿œã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n\nä»£æ›¿ï¼šiPhoneã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ğŸ¤ã§æœ¬æ–‡ã‚’å…¥åŠ› â†’ â‘ ãƒ†ã‚­ã‚¹ãƒˆè©•ä¾¡ã¸è²¼ã‚Šä»˜ã‘ã€ã§OKã§ã™ã€‚";
      return;
    }
    try{
      rec.start();
      resultVoice.textContent = "æ–‡å­—èµ·ã“ã—ä¸­â€¦ è©±ã—ã¦ãã ã•ã„ï¼ˆã†ã¾ãå‹•ã‹ãªã„æ™‚ã¯éŸ³å£°å…¥åŠ›ã§OKï¼‰";
    }catch(err){
      // starté€£æ‰“ã§ä¾‹å¤–ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹
      resultVoice.textContent = "é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦æŠ¼ã—ã¦ãã ã•ã„ã€‚";
    }
  };

  document.getElementById("btnStop").onclick = () => {
    if(rec){
      rec.stop();
      resultVoice.textContent = "åœæ­¢ã—ã¾ã—ãŸã€‚å¿…è¦ãªã‚‰ã€â†’ã“ã®æ–‡ç« ã§è©•ä¾¡ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚";
    }
  };

  document.getElementById("btnUseTranscript").onclick = () => {
    const t = transcript.value;
    resultVoice.textContent = evaluate(t);
  };
</script>
</body>
</html>
