<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>æ»‘èˆŒç·´ç¿’ï¼ˆãƒ•ãƒ¬ãƒ¼ã‚ºå¼ï¼‰</title>
<link rel="stylesheet" href="style.css">

<style>
#phraseBody{
  font-size:32px;
  font-weight:800;
  text-align:center;
  line-height:1.9;
  white-space:pre-wrap;
}

/* æ—§ï¼škaraCharï¼ˆæ®‹ã—ã¦ã‚‚OKã ã‘ã©ä½¿ã‚ãªã„ï¼‰ */
.karaChar{
  display:inline-block;
  padding:2px 3px;
  border-radius:6px;
}
.karaChar.active{
  background:#ffdddd;
  color:#d60000;
}
.karaChar.done{
  opacity:0.5;
}

/* âœ… æ–°ï¼šrubyå¯¾å¿œãƒ¦ãƒ‹ãƒƒãƒˆ */
.karaUnit{
  display:inline-block;
  padding:2px 4px;
  border-radius:6px;
  transition: .15s;
}
.karaUnit.active{
  background:#ffdddd;
  color:#d60000;
}
.karaUnit.done{
  opacity:.45;
}
.karaUnit.skip{
  background:transparent !important;
  color:inherit !important;
  opacity:1;
}

/* rubyã®è¦‹ãŸç›®ï¼ˆãµã‚ŠãŒãªã‚’å°ã•ãï¼‰ */
ruby rt{
  font-size: 0.55em;
  opacity: 0.85;
}

.row{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
  align-items:center;
}

input[type=range]{
  width:220px;
}

.modeOn{
  border:2px solid #333;
}

.mini{
  font-size:14px;
  opacity:0.8;
  line-height:1.7;
  white-space:pre-wrap;
}
</style>
</head>

<body>

<header class="top">
<h1>ğŸ‘„ æ»‘èˆŒç·´ç¿’</h1>
<p class="sub">ã‚«ãƒ©ã‚ªã‚±å¼ã§ç·´ç¿’ã§ãã¾ã™ï¼ˆæ‹—éŸ³ãƒ»ãµã‚ŠãŒãªå¯¾å¿œï¼‰</p>
<p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸</a></p>
</header>

<main class="menu">

<!-- ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ -->
<div class="card">
  <div class="title">ğŸ”° ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼ˆç´„2ã€œ3åˆ†ï¼‰</div>
  <div class="desc">
    <div id="dailyText" class="mini">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

    <div class="row" style="margin-top:10px;">
      <button onclick="startDaily()">â–¶ é–‹å§‹</button>
      <button onclick="shuffleDaily()">ğŸ² å¤‰æ›´</button>
    </div>

    <div class="mini" style="margin-top:8px;">
      ğŸ’¡ è¿·ã£ãŸã‚‰ã“ã‚Œã ã‘ã§OKï¼ˆçŸ­æ™‚é–“ã§ç¶šãè¨­è¨ˆï¼‰
    </div>
  </div>
</div>

<!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="card">
  <div class="title">ã‚»ã‚¯ã‚·ãƒ§ãƒ³</div>
  <div class="desc row">
    <button onclick="setSection(0)">â‘ æ¯éŸ³</button>
    <button onclick="setSection(1)">â‘¡åŸºæœ¬</button>
    <button onclick="setSection(2)">â‘¢æ¿éŸ³</button>
    <button onclick="setSection(3)">â‘£æ‹—éŸ³</button>
    <button onclick="setSection(4)">â‘¤ãƒªã‚ºãƒ </button>
    <button onclick="setSection(5)">â‘¥é›£èª</button>
  </div>
</div>

<!-- æ“ä½œ -->
<div class="card">
  <div class="title">æ“ä½œ</div>
  <div class="desc">

    <!-- âœ… è¿½åŠ ï¼šåœæ­¢ï¼‹é€Ÿåº¦Â± -->
    <div class="row">
      <button onclick="togglePlay()">ğŸ”Šå†ç”Ÿ</button>
      <button onclick="stop()">â¹åœæ­¢</button>

      <button onclick="slow()">â–é…ã</button>
      <button onclick="fast()">â•é€Ÿã</button>

      <button id="autoBtn" onclick="toggleAuto()">è‡ªå‹•OFF</button>
      <button id="karaBtn" onclick="toggleKara()">ğŸŒˆON</button>
    </div>

    <div class="row" style="margin-top:8px;">
      é€Ÿåº¦
      <input id="speedRange" type="range" min="200" max="900" value="450" oninput="setSpeed(this.value)">
      <span id="speedLabel">450ms</span>
    </div>

    <div class="row" style="margin-top:8px;">
      <button id="bBtn" class="modeOn" onclick="setLevel('b')">åˆå¿ƒè€…</button>
      <button id="aBtn" onclick="setLevel('a')">ä¸Šç´š</button>
    </div>

    <div class="mini" style="margin-top:8px;">
      ãƒ»åˆå¿ƒè€…ï¼šã‚†ã£ãã‚Šï¼†æ­£ç¢ºï¼ˆãŠã™ã™ã‚ï¼‰<br>
      ãƒ»ä¸Šç´šï¼šãƒ†ãƒ³ãƒUPï¼ˆè‡ªå‹•ONæ¨å¥¨ï¼‰
    </div>

  </div>
</div>

<!-- è¡¨ç¤º -->
<div class="card">
  <div class="title" id="sectionTitle"></div>
  <div class="desc">

    <div style="text-align:center;">
      <span id="counter"></span>
    </div>

    <div style="border:1px solid #ccc;border-radius:12px;padding:12px;">
      <div id="phraseBody"></div>
    </div>

    <div class="row" style="margin-top:10px;">
      <button onclick="prev()">â—€</button>
      <button onclick="next()">â–¶</button>
      <button onclick="rand()">ğŸ²</button>
      <button onclick="reset()">âŸ²</button>
    </div>

    <div class="mini" style="text-align:center; margin-top:10px;">
      â€» ã¾ãšã€Œã‚†ã£ãã‚Šæ­£ç¢ºã«ã€â†’ æ…£ã‚ŒãŸã‚‰å°‘ã—ãƒ†ãƒ³ãƒã‚¢ãƒƒãƒ—
    </div>

  </div>
</div>

</main>

<script>
/* =========================
   ãƒ‡ãƒ¼ã‚¿ï¼ˆå¢—é‡ãƒ•ãƒ«ç‰ˆï¼‰
========================= */

// â‘  æ¯éŸ³ï¼ˆå¢—é‡ï¼‰
const p1 = [
  "ã‚ã„ã†ãˆãŠ",
  "ã‚ãˆã„ã†ãˆãŠã€€ã‚ãŠ",
  "ã‚ã„ã†ãˆãŠã€€ã‚ãŠ",
  "ã‚ãŠã€€ã‚ãˆã„ã€€ã†ãˆãŠ",
  "ã‚ã„ã†ãˆãŠã€€ã‚ã„ã†ãˆãŠ",
  "ã‚ãƒ¼ã„ãƒ¼ã†ãƒ¼ãˆãƒ¼ãŠãƒ¼ï¼ˆã‚†ã£ãã‚Šï¼‰",
  "ã‚ã€€ã„ã€€ã†ã€€ãˆã€€ãŠï¼ˆ1éŸ³ãšã¤ï¼‰",
  "ã‚ã„ã€€ã†ãˆã€€ãŠã‚ã€€ãˆã†",
  "ã‚ã„ã†ã€€ãˆãŠã‚ã€€ã„ã†ãˆãŠ",
  "ã‚ãˆã„ã€€ã†ãˆãŠã€€ã‚ãŠ",
  "ã‚ãŠã‚ãŠã€€ã‚ãˆã„ãˆã€€ã†ãˆãŠã†",
  "ã‚ã„ã†ãˆãŠã€€ãŠãˆã†ã„ã‚"
];

// â‘¡ è¡Œåˆ¥åŸºæœ¬ï¼ˆãƒ•ãƒ«ï¼‰
const p2 = [
  "ï¼ˆã‚è¡Œï¼‰ ã‚ã€€ã„ã€€ã†ã€€ãˆã€€ãŠ",
  "ã‚ãˆã„ã€€ã†ãˆãŠã€€ã‚ãŠ",
  "ï¼ˆã‹è¡Œï¼‰ ã‹ã€€ãã€€ãã€€ã‘ã€€ã“",
  "ã‹ããã‘ã“ã€€ã‹ã‘ã“ã€€ããã‘",
  "ï¼ˆã•è¡Œï¼‰ ã•ã€€ã—ã€€ã™ã€€ã›ã€€ã",
  "ã•ã—ã™ã›ãã€€ã•ã›ãã€€ã—ã™ã›",
  "ï¼ˆãŸè¡Œï¼‰ ãŸã€€ã¡ã€€ã¤ã€€ã¦ã€€ã¨",
  "ãŸã¡ã¤ã¦ã¨ã€€ãŸã¦ã¨ã€€ã¡ã¤ã¦",
  "ï¼ˆãªè¡Œï¼‰ ãªã€€ã«ã€€ã¬ã€€ã­ã€€ã®",
  "ãªã«ã¬ã­ã®ã€€ãªã­ã®ã€€ã«ã¬ã­",
  "ï¼ˆã¯è¡Œï¼‰ ã¯ã€€ã²ã€€ãµã€€ã¸ã€€ã»",
  "ã¯ã²ãµã¸ã»ã€€ã¯ã¸ã»ã€€ã²ãµã¸",
  "ï¼ˆã¾è¡Œï¼‰ ã¾ã€€ã¿ã€€ã‚€ã€€ã‚ã€€ã‚‚",
  "ã¾ã¿ã‚€ã‚ã‚‚ã€€ã¾ã‚ã‚‚ã€€ã¿ã‚€ã‚",
  "ï¼ˆã‚„è¡Œï¼‰ ã‚„ã€€ã‚†ã€€ã‚ˆ",
  "ã‚„ã‚†ã‚ˆã€€ã‚†ã‚ˆã‚„ã€€ã‚ˆã‚„ã‚†",
  "ï¼ˆã‚‰è¡Œï¼‰ ã‚‰ã€€ã‚Šã€€ã‚‹ã€€ã‚Œã€€ã‚",
  "ã‚‰ã‚Šã‚‹ã‚Œã‚ã€€ã‚‰ã‚Œã‚ã€€ã‚Šã‚‹ã‚Œ",
  "ï¼ˆã‚è¡Œï¼‰ ã‚ã€€ã‚’ã€€ã‚“",
  "ã‚ã‚’ã‚“ã€€ã‚ã‚“ã‚’ã€€ã‚’ã‚ã‚“"
];

// â‘¢ æ¿éŸ³ãƒ»åŠæ¿éŸ³ï¼ˆãƒ•ãƒ«ï¼‰
const p3 = [
  "ãŒããã’ã”ã€€ãŒã’ã”ã€€ããã’",
  "ã–ã˜ãšãœãã€€ã–ãœãã€€ã˜ãšãœ",
  "ã ã¢ã¥ã§ã©ã€€ã ã§ã©ã€€ã¢ã¥ã§",
  "ã°ã³ã¶ã¹ã¼ã€€ã°ã¹ã¼ã€€ã³ã¶ã¹",
  "ã±ã´ã·ãºã½ã€€ã±ãºã½ã€€ã´ã·ãº"
];

// â‘£ æ‹—éŸ³ï¼ˆãƒ•ãƒ«ï¼‰
const p4 = [
  "ãã‚ƒãã‚…ãã‚‡ã€€ãã‚ƒããã‚‡ã€€ãã‚…ãã‚‡ãã‚ƒ",
  "ã—ã‚ƒã—ã‚…ã—ã‚‡ã€€ã—ã‚ƒãã—ã‚‡ã€€ã—ã‚…ã—ã‚‡ã—ã‚ƒ",
  "ã¡ã‚ƒã¡ã‚…ã¡ã‚‡ã€€ã¡ã‚ƒãã¡ã‚‡ã€€ã¡ã‚…ã¡ã‚‡ã¡ã‚ƒ",
  "ã«ã‚ƒã«ã‚…ã«ã‚‡ã€€ã«ã‚ƒãã«ã‚‡ã€€ã«ã‚…ã«ã‚‡ã«ã‚ƒ",
  "ã²ã‚ƒã²ã‚…ã²ã‚‡ã€€ã²ã‚ƒãã²ã‚‡ã€€ã²ã‚…ã²ã‚‡ã²ã‚ƒ",
  "ã¿ã‚ƒã¿ã‚…ã¿ã‚‡ã€€ã¿ã‚ƒãã¿ã‚‡ã€€ã¿ã‚…ã¿ã‚‡ã¿ã‚ƒ",
  "ã‚Šã‚ƒã‚Šã‚…ã‚Šã‚‡ã€€ã‚Šã‚ƒãã‚Šã‚‡ã€€ã‚Šã‚…ã‚Šã‚‡ã‚Šã‚ƒ"
];

// â‘¤ ãƒªã‚ºãƒ ï¼ˆãƒ•ãƒ«ï¼‰
const p5 = [
  "ãŸãŸãŸã€€ã¦ã¦ã¦ã€€ã¨ã¨ã¨",
  "ã‹ã‹ã‹ã€€ãããã€€ããã",
  "ã•ã•ã•ã€€ã—ã—ã—ã€€ã™ã™ã™",
  "ã‚‰ã‚‰ã‚‰ã€€ã‚Šã‚Šã‚Šã€€ã‚‹ã‚‹ã‚‹"
];

/* âœ… â‘¥ é›£èªï¼šå®Œå…¨rubyï¼ˆæ¼¢å­—ã ã‘ã‚’å…‰ã‚‰ã›ã‚„ã™ãã™ã‚‹ï¼‰ */
const p6 = [
  "ã‚ã‚ã‚“ã¼ã‚ã‹ã„ãªã€€ã‚ã„ã†ãˆãŠã€€ã†ãã‚‚ã«ã“ãˆã³ã‚‚ãŠã‚ˆã„ã§ã‚‹",
  "<ruby>ç”Ÿéº¦<rt>ãªã¾ã‚€ã</rt></ruby> <ruby>ç”Ÿç±³<rt>ãªã¾ã”ã‚</rt></ruby> <ruby>ç”Ÿåµ<rt>ãªã¾ãŸã¾ã”</rt></ruby>",
  "<ruby>èµ¤å·»ç´™<rt>ã‚ã‹ã¾ããŒã¿</rt></ruby> <ruby>é’å·»ç´™<rt>ã‚ãŠã¾ããŒã¿</rt></ruby> <ruby>é»„å·»ç´™<rt>ãã¾ããŒã¿</rt></ruby>",
  "<ruby>æ±äº¬<rt>ã¨ã†ãã‚‡ã†</rt></ruby><ruby>ç‰¹è¨±<rt>ã¨ã£ãã‚‡</rt></ruby><ruby>è¨±å¯å±€<rt>ãã‚‡ã‹ãã‚‡ã</rt></ruby>",
  "<ruby>éš£<rt>ã¨ãªã‚Š</rt></ruby>ã®<ruby>å®¢<rt>ãã‚ƒã</rt></ruby>ã¯ã‚ˆã<ruby>æŸ¿<rt>ã‹ã</rt></ruby><ruby>é£Ÿ<rt>ã</rt></ruby>ã†<ruby>å®¢<rt>ãã‚ƒã</rt></ruby>ã ",
  "<ruby>è€è‹¥ç”·å¥³<rt>ã‚ã†ã«ã‚ƒããªã‚“ã«ã‚‡</rt></ruby>",
  "<ruby>æ—…å®¢æ©Ÿ<rt>ã‚Šã‚‡ã‹ã£ã</rt></ruby> <ruby>æ—…å®¢èˆ¹<rt>ã‚Šã‚‡ã‹ãã›ã‚“</rt></ruby> <ruby>æ—…é¤¨<rt>ã‚Šã‚‡ã‹ã‚“</rt></ruby>",
  "<ruby>æ¥­å‹™ä¸Šéå¤±è‡´æ­»å‚·<rt>ãã‚‡ã†ã‚€ã˜ã‚‡ã†ã‹ã—ã¤ã¡ã—ã—ã‚‡ã†</rt></ruby>",
  "<ruby>æ‰“è€…èµ°è€…å‹è€…<rt>ã ã—ã‚ƒãã†ã—ã‚ƒã—ã‚‡ã†ã—ã‚ƒ</rt></ruby>",
  "<ruby>é­”è¡“å¸«æ‰‹è¡“ä¸­<rt>ã¾ã˜ã‚…ã¤ã—ã—ã‚…ã˜ã‚…ã¤ã¡ã‚…ã†</rt></ruby>",
  "<ruby>è²§ä¹äºº<rt>ã³ã‚“ã¼ã†ã«ã‚“</rt></ruby> <ruby>æ•è…•å¼è­·å£«<rt>ã³ã‚“ã‚ã‚“ã¹ã‚“ã”ã—</rt></ruby>",
  "<ruby>ãƒã‚¹ã‚¬ã‚¹çˆ†ç™º<rt>ã°ã™ãŒã™ã°ãã¯ã¤</rt></ruby>",
  "<ruby>æœ€çµ‚æ‰‹æ®µ<rt>ã•ã„ã—ã‚…ã†ã—ã‚…ã ã‚“</rt></ruby> <ruby>åé›†<rt>ã—ã‚…ã†ã—ã‚…ã†</rt></ruby> <ruby>é›†ä¸­<rt>ã—ã‚…ã†ã¡ã‚…ã†</rt></ruby>",
  "<ruby>ç‰¹æ€¥åˆ—è»Š<rt>ã¨ã£ãã‚…ã†ã‚Œã£ã—ã‚ƒ</rt></ruby> <ruby>æ™®é€šåˆ—è»Š<rt>ãµã¤ã†ã‚Œã£ã—ã‚ƒ</rt></ruby>",
  "<ruby>å–æ¨é¸æŠ<rt>ã—ã‚…ã—ã‚ƒã›ã‚“ãŸã</rt></ruby> <ruby>è©¦å†™å®¤<rt>ã—ã—ã‚ƒã—ã¤</rt></ruby> <ruby>æ”¯ç¤¾è¦–å¯Ÿ<rt>ã—ã—ã‚ƒã—ã•ã¤</rt></ruby>"
];

const sections = [
  {t:"â‘ æ¯éŸ³", d:p1, isHtml:false},
  {t:"â‘¡åŸºæœ¬", d:p2, isHtml:false},
  {t:"â‘¢æ¿éŸ³", d:p3, isHtml:false},
  {t:"â‘£æ‹—éŸ³", d:p4, isHtml:false},
  {t:"â‘¤ãƒªã‚ºãƒ ", d:p5, isHtml:false},
  {t:"â‘¥é›£èª", d:p6, isHtml:true},   // âœ… é›£èªã¯HTMLï¼ˆrubyï¼‰ã‚’å«ã‚€
];

let sec = 0;
let idx = 0;

/* ===== è¨­å®š ===== */
let auto = false;
let kara = true;
let speed = 450;
let level = "b";
let timer = null;

/* =========================
  âœ… ãƒ¦ãƒ‹ãƒƒãƒˆåŒ–
  - é›£èªï¼ˆrubyã‚ã‚Šï¼‰ï¼šrubyã¯1ãƒ¦ãƒ‹ãƒƒãƒˆã€ç©ºç™½ã¯skip
  - é€šå¸¸ï¼šæ‹—éŸ³ï¼ˆå°æ–‡å­—ï¼‰ã‚’å‰ã®æ–‡å­—ã¨åˆä½“ã€ç©ºç™½ã¯skipã€ï¼ˆ ï¼‰ã‚‚skip
========================= */
function buildUnits(text, isHtml){

  // HTMLï¼ˆrubyï¼‰ã‚’å«ã‚€å ´åˆ
  if(isHtml){
    const temp = document.createElement("div");
    temp.innerHTML = text;
    const units = [];

    function walk(node){
      if(node.nodeType === 3){
        for(const c of node.textContent){
          if(/\s/.test(c)) units.push({t:c, skip:true});
          else units.push({t:c});
        }
        return;
      }
      if(node.nodeType === 1){
        if(node.tagName === "RUBY"){
          units.push({html: node.outerHTML});
          return;
        }
        for(const ch of node.childNodes) walk(ch);
      }
    }
    walk(temp);
    return units;
  }

  // é€šå¸¸ï¼ˆæ‹—éŸ³åˆä½“ã€ï¼ˆï¼‰é™¤å¤–ï¼‰
  const small = "ã‚ƒã‚…ã‚‡ããƒã…ã‡ã‰";
  let arr = [];
  let buf = "";
  let inParen = false;

  for(const c of text){

    // ï¼ˆï¼‰å†…ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ãŸã„å ´åˆ
    if(c === "ï¼ˆ"){ inParen = true; continue; }
    if(c === "ï¼‰"){ inParen = false; continue; }
    if(inParen) continue;

    // ç©ºç™½ã¯å…‰ã‚‰ã›ãªã„ï¼ˆè¡¨ç¤ºã¯æ®‹ã™ï¼‰
    if(/\s/.test(c)){
      if(buf){ arr.push({t:buf}); buf=""; }
      arr.push({t:c, skip:true});
      continue;
    }

    // æ‹—éŸ³å°æ–‡å­—ã¯å‰ã®æ–‡å­—ã«åˆä½“
    if(small.includes(c)){
      buf += c;
      continue;
    }else{
      if(buf) arr.push({t:buf});
      buf = c;
    }
  }
  if(buf) arr.push({t:buf});
  return arr;
}

/* ===== è¡¨ç¤º ===== */
function render(){
  const s = sections[sec];
  sectionTitle.textContent = s.t;
  counter.textContent = (idx+1) + "/" + s.d.length;

  const text = s.d[idx];

  if(kara){
    renderKara(text, s.isHtml);
  }else{
    // kara OFF ã®ã¨ãï¼šHTMLãªã‚‰rubyè¡¨ç¤ºã€é€šå¸¸ãªã‚‰æ–‡å­—è¡¨ç¤º
    if(s.isHtml){
      phraseBody.innerHTML = text;
    }else{
      phraseBody.textContent = text;
    }
  }
}

function renderKara(text, isHtml){
  phraseBody.innerHTML = "";

  const units = buildUnits(text, isHtml);

  units.forEach(u=>{
    const sp = document.createElement("span");
    sp.className = "karaUnit";

    if(u.skip){
      sp.classList.add("skip");
      sp.textContent = u.t;
    }else if(u.html){
      sp.innerHTML = u.html; // rubyè¡¨ç¤º
    }else{
      sp.textContent = u.t;
    }
    phraseBody.appendChild(sp);
  });
}

/* ===== ã‚«ãƒ©ã‚ªã‚± ===== */
function stopKara(){
  if(timer){
    clearInterval(timer);
    timer = null;
  }
  document.querySelectorAll(".karaUnit").forEach(s=>{
    s.classList.remove("active","done");
  });
}

function startKara(){
  if(!kara) return;

  stopKara();

  const spans = Array.from(document.querySelectorAll(".karaUnit"))
    .filter(sp=>!sp.classList.contains("skip")); // âœ… skipã¯å…‰ã‚‰ã›ãªã„

  let i = 0;

  timer = setInterval(()=>{
    if(i>0){
      spans[i-1].classList.remove("active");
      spans[i-1].classList.add("done");
    }

    if(i >= spans.length){
      clearInterval(timer);
      timer = null;
      if(auto) setTimeout(next, 600);
      return;
    }

    spans[i].classList.add("active");
    i++;
  }, speed);
}

/* ===== æ“ä½œ ===== */
function setSection(n){
  sec = n;
  idx = 0;
  stop();
  render();
}

function next(){
  idx = (idx + 1) % sections[sec].d.length;
  stop();
  render();
  if(auto) startKara();
}

function prev(){
  idx = (idx - 1 + sections[sec].d.length) % sections[sec].d.length;
  stop();
  render();
}

function rand(){
  idx = Math.floor(Math.random() * sections[sec].d.length);
  stop();
  render();
}

function reset(){
  idx = 0;
  stop();
  render();
}

/* ===== åˆ¶å¾¡ ===== */
function stop(){
  stopKara();
}

function togglePlay(){
  stop();
  startKara();
}

function syncAutoBtn(){
  autoBtn.textContent = auto ? "è‡ªå‹•ON" : "è‡ªå‹•OFF";
}

function toggleAuto(){
  auto = !auto;
  syncAutoBtn();
}

function toggleKara(){
  kara = !kara;
  karaBtn.textContent = kara ? "ğŸŒˆON" : "ğŸŒˆOFF";
  stop();
  render();
}

/* é€Ÿåº¦ï¼šã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
function setSpeed(v){
  speed = Number(v);
  speedLabel.textContent = speed + "ms";
}

/* âœ… é€Ÿåº¦ï¼šãƒœã‚¿ãƒ³ï¼ˆÂ±50msï¼‰ */
function slow(){
  speed = Math.min(speed + 50, 900);
  speedRange.value = speed;
  speedLabel.textContent = speed + "ms";
}
function fast(){
  speed = Math.max(speed - 50, 200);
  speedRange.value = speed;
  speedLabel.textContent = speed + "ms";
}

function setLevel(l){
  level = l;

  bBtn.classList.remove("modeOn");
  aBtn.classList.remove("modeOn");

  if(l === "b"){
    bBtn.classList.add("modeOn");
    speed = Math.max(speed, 450);
    speedRange.value = speed;
  }else{
    aBtn.classList.add("modeOn");
    speed = Math.min(speed, 350);
    speedRange.value = speed;
  }
  speedLabel.textContent = speed + "ms";
}

/* ===== ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ ===== */
let daily = null;

function r(a){
  return a[Math.floor(Math.random()*a.length)];
}

function pickDaily(){
  // è¿·ã„ã«ãã„ç‹é“ãƒ«ãƒ¼ãƒˆ
  // æ¯éŸ³ â†’ æ‹—éŸ³ â†’ æ¿éŸ³ï¼ˆï¼‹ãŸã¾ã«ãƒªã‚ºãƒ ï¼‰
  const plan = [
    {sec:0, p:r(p1)},
    {sec:3, p:r(p4)},
    {sec:2, p:r(p3)}
  ];
  if(Math.random() < 0.5){
    plan.splice(1, 0, {sec:4, p:r(p5)}); // ãŸã¾ã«ãƒªã‚ºãƒ ã‚’æŒŸã‚€
  }
  return plan;
}

function showDaily(){
  if(!daily) daily = pickDaily();
  dailyText.textContent =
    daily.map((x,i)=>`(${i+1}) ${sections[x.sec].t}ï¼š${x.p}`).join("\n");
}

function shuffleDaily(){
  daily = pickDaily();
  showDaily();
}

function startDaily(){
  if(!daily) daily = pickDaily();

  auto = true;
  syncAutoBtn();

  runDaily(0);
}

function runDaily(i){
  if(!daily[i]) return;

  sec = daily[i].sec;

  // âœ… é›£èªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯HTMLæ–‡å­—åˆ—ãªã®ã§ã€ä»Šæ—¥ãƒŸãƒƒã‚·ãƒ§ãƒ³ã«ã¯å…¥ã‚Œã¦ã„ãªã„ï¼ˆå®‰å…¨ï¼‰
  idx = sections[sec].d.indexOf(daily[i].p);
  if(idx < 0) idx = 0;

  render();
  startKara();

  // âœ… ãƒ¦ãƒ‹ãƒƒãƒˆæ•°ã§æ™‚é–“è¦‹ç©ã‚‚ã‚Šï¼ˆskipé™¤å¤–ï¼‰
  const units = buildUnits(sections[sec].d[idx], sections[sec].isHtml)
    .filter(u=>!u.skip);

  setTimeout(()=>{
    runDaily(i+1);
  }, units.length * speed + 800);
}

/* ===== åˆæœŸ ===== */
render();
showDaily();
syncAutoBtn();
karaBtn.textContent = kara ? "ğŸŒˆON" : "ğŸŒˆOFF";
</script>

</body>
</html>