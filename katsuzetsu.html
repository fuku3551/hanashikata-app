<!doctype html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>æ»‘èˆŒç·´ç¿’ï¼ˆãƒ•ãƒ¬ãƒ¼ã‚ºå¼ï¼‰</title>
<link rel="stylesheet" href="style.css">

<style>
#phraseBody{
  font-size:32px;
  font-weight:800;
  text-align:center;
  line-height:1.9;
}

.karaChar{
  display:inline-block;
  padding:2px 3px;
  border-radius:6px;
}

.karaChar.active{
  background:#ffdddd;
  color:#d60000;
}

.karaChar.done{
  opacity:0.5;
}

.row{
  display:flex;
  gap:10px;
  justify-content:center;
  flex-wrap:wrap;
}

input[type=range]{
  width:220px;
}

.modeOn{
  border:2px solid #333;
}

.mini{
  font-size:14px;
  opacity:0.8;
}
</style>
</head>

<body>

<header class="top">
<h1>ğŸ‘„ æ»‘èˆŒç·´ç¿’</h1>
<p class="sub">ã‚«ãƒ©ã‚ªã‚±å¼ã§ç·´ç¿’ã§ãã¾ã™</p>
<p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸</a></p>
</header>

<main class="menu">

<!-- ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ -->
<div class="card">
<div class="title">ğŸ”° ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³</div>

<div class="desc">
<div id="dailyText" class="mini">èª­ã¿è¾¼ã¿ä¸­â€¦</div>

<div class="row" style="margin-top:10px;">
<button onclick="startDaily()">â–¶ é–‹å§‹</button>
<button onclick="shuffleDaily()">ğŸ² å¤‰æ›´</button>
</div>
</div>
</div>


<!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="card">
<div class="title">ã‚»ã‚¯ã‚·ãƒ§ãƒ³</div>

<div class="desc row">
<button onclick="setSection(0)">â‘ æ¯éŸ³</button>
<button onclick="setSection(1)">â‘¡åŸºæœ¬</button>
<button onclick="setSection(2)">â‘¢æ¿éŸ³</button>
<button onclick="setSection(3)">â‘£æ‹—éŸ³</button>
<button onclick="setSection(4)">â‘¤ãƒªã‚ºãƒ </button>
<button onclick="setSection(5)">â‘¥é›£èª</button>
</div>
</div>


<!-- æ“ä½œ -->
<div class="card">

<div class="title">æ“ä½œ</div>

<div class="desc">

<div class="row">
<button onclick="togglePlay()">ğŸ”Šå†ç”Ÿ</button>
<button id="autoBtn" onclick="toggleAuto()">è‡ªå‹•OFF</button>
<button id="karaBtn" onclick="toggleKara()">ğŸŒˆON</button>
</div>

<div class="row" style="margin-top:8px;">
é€Ÿåº¦
<input type="range" min="200" max="900" value="450" oninput="setSpeed(this.value)">
<span id="speedLabel">450ms</span>
</div>

<div class="row" style="margin-top:8px;">
<button id="bBtn" class="modeOn" onclick="setLevel('b')">åˆå¿ƒè€…</button>
<button id="aBtn" onclick="setLevel('a')">ä¸Šç´š</button>
</div>

</div>
</div>


<!-- è¡¨ç¤º -->
<div class="card">

<div class="title" id="sectionTitle"></div>

<div class="desc">

<div style="text-align:center;">
<span id="counter"></span>
</div>

<div style="border:1px solid #ccc;border-radius:12px;padding:12px;">
<div id="phraseBody"></div>
</div>

<div class="row" style="margin-top:10px;">
<button onclick="prev()">â—€</button>
<button onclick="next()">â–¶</button>
<button onclick="rand()">ğŸ²</button>
<button onclick="reset()">âŸ²</button>
</div>

</div>
</div>

</main>


<script>

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */

const p1=["ã‚ã„ã†ãˆãŠ","ã‚ãˆã„ã†ãˆãŠ"];
const p2=["ã‹ããã‘ã“","ã•ã—ã™ã›ã","ãŸã¡ã¤ã¦ã¨"];
const p3=["ãŒããã’ã”","ã°ã³ã¶ã¹ã¼"];
const p4=["ã¡ã‚ƒã¡ã‚…ã¡ã‚‡","ãã‚ƒãã‚…ãã‚‡","ã—ã‚ƒã—ã‚…ã—ã‚‡"];
const p5=["ãŸãŸãŸ","ã‹ã‹ã‹","ã•ã•ã•"];
const p6=["ãƒã‚¹ã‚¬ã‚¹çˆ†ç™º","æ±äº¬ç‰¹è¨±è¨±å¯å±€"];

const sections=[
{t:"â‘ æ¯éŸ³",d:p1},
{t:"â‘¡åŸºæœ¬",d:p2},
{t:"â‘¢æ¿éŸ³",d:p3},
{t:"â‘£æ‹—éŸ³",d:p4},
{t:"â‘¤ãƒªã‚ºãƒ ",d:p5},
{t:"â‘¥é›£èª",d:p6},
];

let sec=0;
let idx=0;

/* ===== è¨­å®š ===== */

let auto=false;
let kara=true;
let speed=450;
let level="b";

let timer=null;


/* ===== æ‹—éŸ³å‡¦ç† ===== */

function splitText(txt){

const small="ã‚ƒã‚…ã‚‡ããƒã…ã‡ã‰";

let arr=[];
let buf="";

for(let c of txt){

if(small.includes(c)){
buf+=c;
}else{
if(buf) arr.push(buf);
buf=c;
}
}

if(buf) arr.push(buf);

return arr;
}


/* ===== è¡¨ç¤º ===== */

function render(){

const s=sections[sec];

sectionTitle.textContent=s.t;
counter.textContent=(idx+1)+"/"+s.d.length;

const text=s.d[idx];

if(kara){
renderKara(text);
}else{
phraseBody.textContent=text;
}
}

function renderKara(text){

phraseBody.innerHTML="";

const units=splitText(text);

units.forEach(u=>{
const sp=document.createElement("span");
sp.className="karaChar";
sp.textContent=u;
phraseBody.appendChild(sp);
});
}


/* ===== ã‚«ãƒ©ã‚ªã‚± ===== */

function stopKara(){

if(timer){
clearInterval(timer);
timer=null;
}

document.querySelectorAll(".karaChar").forEach(s=>{
s.classList.remove("active","done");
});
}

function startKara(){

if(!kara) return;

stopKara();

const spans=document.querySelectorAll(".karaChar");

let i=0;

timer=setInterval(()=>{

if(i>0){
spans[i-1].classList.remove("active");
spans[i-1].classList.add("done");
}

if(i>=spans.length){
clearInterval(timer);
timer=null;

if(auto) setTimeout(next,600);

return;
}

spans[i].classList.add("active");
i++;

},speed);
}


/* ===== æ“ä½œ ===== */

function setSection(n){
sec=n;
idx=0;
stop();
render();
}

function next(){
idx=(idx+1)%sections[sec].d.length;
stop();
render();
if(auto) startKara();
}

function prev(){
idx=(idx-1+sections[sec].d.length)%sections[sec].d.length;
stop();
render();
}

function rand(){
idx=Math.floor(Math.random()*sections[sec].d.length);
stop();
render();
}

function reset(){
idx=0;
stop();
render();
}


/* ===== åˆ¶å¾¡ ===== */

function stop(){
stopKara();
}

function togglePlay(){
stop();
startKara();
}

function toggleAuto(){
auto=!auto;
autoBtn.textContent=auto?"è‡ªå‹•ON":"è‡ªå‹•OFF";
}

function toggleKara(){
kara=!kara;
karaBtn.textContent=kara?"ğŸŒˆON":"ğŸŒˆOFF";
stop();
render();
}

function setSpeed(v){
speed=Number(v);
speedLabel.textContent=speed+"ms";
}

function setLevel(l){

level=l;

bBtn.classList.remove("modeOn");
aBtn.classList.remove("modeOn");

if(l==="b"){
bBtn.classList.add("modeOn");
speed=Math.max(speed,450);
}else{
aBtn.classList.add("modeOn");
speed=Math.min(speed,350);
}

speedLabel.textContent=speed+"ms";
}


/* ===== ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ ===== */

let daily=null;

function pickDaily(){

return[
{sec:0,p:r(p1)},
{sec:3,p:r(p4)},
{sec:2,p:r(p3)}
];
}

function r(a){
return a[Math.floor(Math.random()*a.length)];
}

function showDaily(){

if(!daily) daily=pickDaily();

dailyText.textContent=
daily.map((x,i)=>`(${i+1}) ${sections[x.sec].t}ï¼š${x.p}`).join("\n");
}

function shuffleDaily(){
daily=pickDaily();
showDaily();
}

function startDaily(){

if(!daily) daily=pickDaily();

auto=true;
toggleAuto();

runDaily(0);
}

function runDaily(i){

if(!daily[i]) return;

sec=daily[i].sec;
idx=sections[sec].d.indexOf(daily[i].p);

render();
startKara();

const len=splitText(daily[i].p).length;

setTimeout(()=>{
runDaily(i+1);
},len*speed+800);
}


/* ===== åˆæœŸ ===== */

render();
showDaily();

</script>

</body>
</html>