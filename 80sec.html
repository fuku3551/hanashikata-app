<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>80ç§’ã‚¹ãƒ”ãƒ¼ãƒ</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

<header class="top">
  <h1>ğŸ¤ 80ç§’ã‚¹ãƒ”ãƒ¼ãƒï¼ˆãŠã™ã™ã‚ã‚·ãƒªãƒ¼ã‚ºï¼‰</h1>
  <p class="sub">ãŠã™ã™ã‚ã‚’èªã‚‹ç·´ç¿’ï¼šç†ç”±â†’å…·ä½“ä¾‹â†’ã²ã¨è¨€ã¾ã¨ã‚</p>
  <p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a></p>
</header>

<main class="menu">

  <div class="card" style="display:block;">
    <div class="title">ãŠé¡Œ</div>
    <div class="desc">
      <p id="topic" style="font-size:20px; font-weight:bold;">
        ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„
      </p>
      <p style="opacity:0.75; margin-top:8px;">
        å‹ï¼šâ‘ çµè«–ï¼ˆãŠã™ã™ã‚ã¯ã“ã‚Œï¼‰â†’â‘¡ç†ç”±ï¼ˆãªãœï¼‰â†’â‘¢å…·ä½“ä¾‹ï¼ˆã„ã¤/ã©ã“ã§/ä½•ãŒï¼‰â†’â‘£ä¸€è¨€ã¾ã¨ã‚
      </p>
    </div>
  </div>

  <div class="card" style="display:block;">
    <div class="title">ã‚¿ã‚¤ãƒãƒ¼</div>
    <div class="desc">
      <p id="timer" style="font-size:32px;">80</p>

      <div style="display:flex; gap:10px; justify-content:center;">
        <button onclick="start()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button onclick="stop()">â¹ ã‚¹ãƒˆãƒƒãƒ—</button>
      </div>

    </div>
  </div>

</main>

<script>
const topics = [
"è¦³ã¦è‰¯ã‹ã£ãŸæ˜ ç”»ï¼ˆç†ç”±ã¨ãƒ¯ãƒ³ã‚·ãƒ¼ãƒ³ï¼‰",
"æœ€è¿‘ãƒãƒã£ãŸãƒ‰ãƒ©ãƒï¼ˆãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆï¼‰",
"å¿ƒã«æ®‹ã£ãŸã‚¢ãƒ‹ãƒ¡ï¼ˆå­¦ã³/æ„Ÿå‹•ï¼‰",
"ãŠã™ã™ã‚ã®YouTubeãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆèª°ã«åˆºã•ã‚‹ï¼Ÿï¼‰",
"ãŠæ°—ã«å…¥ã‚Šã®ãƒãƒƒãƒ‰ã‚­ãƒ£ã‚¹ãƒˆï¼ˆèãã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰",

"ãŠã™ã™ã‚ã®æœ¬ï¼ˆäººç”ŸãŒå¤‰ã‚ã£ãŸ/å½¹ã«ç«‹ã£ãŸï¼‰",
"åˆå¿ƒè€…ã«ãŠã™ã™ã‚ã®å­¦ç¿’æœ¬ï¼ˆèª­ã¿ã‚„ã™ã•é‡è¦–ï¼‰",
"ä½•åº¦ã‚‚èª­ã¿è¿”ã™è¨˜äº‹/ãƒ–ãƒ­ã‚°ï¼ˆç†ç”±ï¼‰",
"ãŠã™ã™ã‚ã®ãƒãƒ³ã‚¬ï¼ˆé­…åŠ›ã‚’ä¸€è¨€ã§ï¼‰",
"ãŠã™ã™ã‚ã®è¨€è‘‰ãƒ»åè¨€ï¼ˆãªãœåˆºã•ã£ãŸï¼Ÿï¼‰",

"ãŠã™ã™ã‚ã®é£Ÿã¹ç‰©ï¼ˆå¿…ãšé ¼ã‚€ã‚„ã¤ï¼‰",
"ãŠã™ã™ã‚ã®é£²ã¿ç‰©ï¼ˆæ°—åˆ†ãŒä¸ŠãŒã‚‹ï¼‰",
"ãŠã™ã™ã‚ã®ãŠè“å­ï¼ˆä½œæ¥­ã®ãŠä¾›ï¼‰",
"ãŠã™ã™ã‚ã®æœã”ã¯ã‚“ï¼ˆç¿’æ…£åŒ–ã®ã‚³ãƒ„ï¼‰",
"ãŠã™ã™ã‚ã®å¤–é£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆæœ€å¼·ã®ä¸€å“ï¼‰",

"ãŠã™ã™ã‚ã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³/ãŠåº—ï¼ˆé›°å›²æ°—ã¨æ¨ã—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰",
"ãŠã™ã™ã‚ã®ã‚«ãƒ•ã‚§ï¼ˆä½œæ¥­ãŒæ—ã‚‹ç†ç”±ï¼‰",
"ãŠã™ã™ã‚ã®ãƒ©ãƒ¼ãƒ¡ãƒ³å±‹ï¼ˆå‘³ã®ç‰¹å¾´ï¼‰",
"ãŠã™ã™ã‚ã®å®šé£Ÿå±‹ï¼ˆæº€è¶³åº¦ãƒã‚¤ãƒ³ãƒˆï¼‰",
"ãŠã™ã™ã‚ã®ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆï¼ˆå¤±æ•—ã—ã«ãã„é¸ã³æ–¹ï¼‰",

"ãŠã™ã™ã‚ã®å ´æ‰€ï¼ˆè½ã¡ç€ãã‚¹ãƒãƒƒãƒˆï¼‰",
"ãŠã™ã™ã‚ã®æ•£æ­©ã‚³ãƒ¼ã‚¹ï¼ˆå­£ç¯€ã®æ¥½ã—ã¿ï¼‰",
"ãŠã™ã™ã‚ã®æ—…è¡Œå…ˆï¼ˆåˆå¿ƒè€…å‘ã‘ãƒ—ãƒ©ãƒ³ï¼‰",
"ãŠã™ã™ã‚ã®æ¸©æ³‰/éŠ­æ¹¯ï¼ˆå›å¾©ãƒã‚¤ãƒ³ãƒˆï¼‰",
"ãŠã™ã™ã‚ã®æ™¯è‰²ï¼ˆè¦‹ã©ã“ã‚ã‚’è¨€èªåŒ–ï¼‰",

"ãŠã™ã™ã‚ã®ã‚¢ãƒ—ãƒªï¼ˆç”Ÿæ´»ãŒãƒ©ã‚¯ã«ãªã£ãŸï¼‰",
"ãŠã™ã™ã‚ã®ç¿’æ…£ï¼ˆç¶šã‘ã‚‹ã‚³ãƒ„ä»˜ãï¼‰",
"ãŠã™ã™ã‚ã®å¥åº·æ³•ï¼ˆä½“æ„Ÿã®å¤‰åŒ–ï¼‰",
"ãŠã™ã™ã‚ã®ä»•äº‹é“å…·ï¼ˆæ™‚çŸ­ã«ãªã‚‹ãƒã‚¤ãƒ³ãƒˆï¼‰",
"ãƒ•ãƒªãƒ¼ãƒˆãƒ¼ã‚¯ï¼šæœ€è¿‘ã®ã€æ¨ã—ã€ã‚’èªã‚‹ï¼ˆä½•ã§ã‚‚OKï¼‰"
];

let time = 80;
let interval = null;

function newTopic(){
  const t = topics[Math.floor(Math.random() * topics.length)];
  document.getElementById("topic").textContent = t;
}

function start(){
  if(interval) return; // äºŒé‡èµ·å‹•é˜²æ­¢

  newTopic();

  time = 80;
  document.getElementById("timer").textContent = time;

  interval = setInterval(() => {
    time--;
    document.getElementById("timer").textContent = time;

    if(time <= 0){
      stop();
      alert("çµ‚äº†ï¼ãŠç–²ã‚Œã•ã¾ã§ã—ãŸğŸ˜Š");
    }
  }, 1000);
}

function stop(){
  if(interval){
    clearInterval(interval);
    interval = null;
  }
}
</script>

</body>
</html>

<!-- =========================
  ğŸ™ éŒ²éŸ³ï¼‹AIè©•ä¾¡ï¼ˆ1ç”»é¢å®Œçµï¼‰
  è²¼ã‚Šä»˜ã‘å ´æ‰€ï¼š</main> ã®ç›´å‰ æ¨å¥¨
========================= -->
<section class="card" style="display:block;">
  <div class="title">ğŸ™ éŒ²éŸ³ & AIè©•ä¾¡ï¼ˆ1ç”»é¢å®Œçµï¼‰</div>
  <div class="desc">

    <div style="border:1px solid #eee; border-radius:14px; padding:12px;">
      <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <button id="hxRecBtn" onclick="hxToggleRecording()"
          style="padding:12px 14px; border-radius:12px; border:none; background:#22c55e; color:#fff;">
          éŒ²éŸ³é–‹å§‹
        </button>

        <button onclick="hxResetRecording()"
          style="padding:12px 14px; border-radius:12px; border:none; background:#ef4444; color:#fff;">
          éŒ²éŸ³ãƒªã‚»ãƒƒãƒˆ
        </button>

        <span id="hxRecStatus" style="font-family: ui-monospace, SFMono-Regular, Menlo, monospace;">
          å¾…æ©Ÿä¸­
        </span>
      </div>

      <audio id="hxPlayer" controls style="display:none; width:100%; margin-top:10px;"></audio>

      <div style="margin-top:10px; font-size:14px; opacity:0.9; line-height:1.7;">
        âœ… éŒ²éŸ³â†’å†ç”Ÿã§ãã¾ã™ï¼ˆç«¯æœ«å†…ï¼‰<br>
        ğŸ’¡ éŒ²éŸ³ã‚’èããªãŒã‚‰ä¸‹ã®æ¬„ã«ãƒ¡ãƒ¢ã—ã¦ã€ŒAIè©•ä¾¡ã€ãŒãŠã™ã™ã‚
      </div>
    </div>

    <div style="margin-top:12px;">
      <div style="font-weight:700; margin-bottom:6px;">ğŸ“ ã‚¹ãƒ”ãƒ¼ãƒæœ¬æ–‡ï¼ˆè©•ä¾¡å¯¾è±¡ï¼‰</div>
      <textarea id="hxSpeechText"
        placeholder="ã“ã“ã«ã‚¹ãƒ”ãƒ¼ãƒã‚’æ›¸ã„ã¦ãã ã•ã„ï¼ˆéŒ²éŸ³ã‚’èããªãŒã‚‰ãƒ¡ãƒ¢ã§ã‚‚OKï¼‰"
        style="width:100%; min-height:160px; padding:12px; border-radius:12px; border:1px solid #ddd;"></textarea>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <button onclick="hxRunEvaluation()"
          style="padding:12px 14px; border-radius:12px; border:none; background:#0ea5e9; color:#fff;">
          AIè©•ä¾¡ã™ã‚‹
        </button>

        <button onclick="hxClearText()"
          style="padding:12px 14px; border-radius:12px; border:1px solid #ddd; background:#fff;">
          ã‚¯ãƒªã‚¢
        </button>

        <button onclick="hxInsertTemplate()"
          style="padding:12px 14px; border-radius:12px; border:1px solid #ddd; background:#fff;">
          ãƒ†ãƒ³ãƒ—ãƒ¬æŒ¿å…¥
        </button>
      </div>
    </div>

    <div style="margin-top:12px;">
      <div id="hxBadges"></div>
      <div id="hxResult"
        style="white-space:pre-wrap; line-height:1.9; margin-top:10px;">
        ã“ã“ã«è©•ä¾¡çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
      </div>
    </div>

  </div>
</section>

<script>
/* =========================
   â‘  éŒ²éŸ³ï¼ˆMediaRecorderï¼‰
   â€» iPhone Safariã§ã‚‚OK
========================= */
let hxMediaRecorder = null;
let hxRecordedChunks = [];
let hxRecordedBlobUrl = null;

async function hxToggleRecording(){
  const btn = document.getElementById("hxRecBtn");
  const status = document.getElementById("hxRecStatus");
  const player = document.getElementById("hxPlayer");

  // éŒ²éŸ³ä¸­ãªã‚‰åœæ­¢
  if(hxMediaRecorder && hxMediaRecorder.state === "recording"){
    hxMediaRecorder.stop();
    btn.textContent = "éŒ²éŸ³é–‹å§‹";
    status.textContent = "åœæ­¢ã—ã¾ã—ãŸï¼ˆéŸ³å£°ç”Ÿæˆä¸­â€¦ï¼‰";
    return;
  }

  // é–‹å§‹
  try{
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    hxRecordedChunks = [];
    hxMediaRecorder = new MediaRecorder(stream);

    hxMediaRecorder.ondataavailable = (e) => {
      if(e.data && e.data.size > 0) hxRecordedChunks.push(e.data);
    };

    hxMediaRecorder.onstop = () => {
      stream.getTracks().forEach(t => t.stop());

      const blob = new Blob(hxRecordedChunks, { type: "audio/webm" });
      if(hxRecordedBlobUrl) URL.revokeObjectURL(hxRecordedBlobUrl);
      hxRecordedBlobUrl = URL.createObjectURL(blob);

      player.src = hxRecordedBlobUrl;
      player.style.display = "block";
      status.textContent = "éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿æº–å‚™OKï¼ˆå†ç”Ÿã§ãã¾ã™ï¼‰";
    };

    hxMediaRecorder.start();
    btn.textContent = "éŒ²éŸ³åœæ­¢";
    status.textContent = "éŒ²éŸ³ä¸­â€¦";
  }catch(err){
    status.textContent = "éŒ²éŸ³ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªï¼‰";
    alert("éŒ²éŸ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚iPhoneã®è¨­å®š/ã‚µã‚¤ãƒˆè¨­å®šã§ãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
  }
}

function hxResetRecording(){
  const status = document.getElementById("hxRecStatus");
  const player = document.getElementById("hxPlayer");

  if(hxMediaRecorder && hxMediaRecorder.state === "recording"){
    hxMediaRecorder.stop();
  }
  hxRecordedChunks = [];
  if(hxRecordedBlobUrl) URL.revokeObjectURL(hxRecordedBlobUrl);
  hxRecordedBlobUrl = null;

  player.pause();
  player.removeAttribute("src");
  player.style.display = "none";
  status.textContent = "å¾…æ©Ÿä¸­";

  // ãƒœã‚¿ãƒ³æ–‡è¨€ã‚‚æˆ»ã™
  const btn = document.getElementById("hxRecBtn");
  btn.textContent = "éŒ²éŸ³é–‹å§‹";
}

/* =========================
   â‘¡ ã‚„ã•ã—ã„ç·åˆè©•ä¾¡ï¼ˆæŸ”è»Ÿç‰ˆï¼‰
   - PREPå°‚ç”¨ã§ã¯ãªããƒˆãƒ¼ã‚¿ãƒ«è©•ä¾¡
   - å˜èªã®è¨€ã„æ›ãˆã‚‚OK
========================= */
function hxGentleEvaluate(text){
  const raw = (text || "").trim();
  const t = raw.replace(/\r\n/g, "\n").replace(/\n{3,}/g, "\n\n").trim();

  if(t.length < 10){
    return {
      score: 60,
      badges: ["å…¥åŠ›ãŒçŸ­ã‚"],
      message:
`ğŸŒŸ ç·åˆè©•ä¾¡ï¼š60ç‚¹

çŸ­ã„ãªãŒã‚‰ã‚‚ã€è©±ãã†ã¨ã™ã‚‹å§¿å‹¢ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™ã€‚

ã‚‚ã†1ã€œ2æ–‡ã ã‘è¶³ã—ã¦ã€
ã€Œä¸€ç•ªè¨€ã„ãŸã„ã“ã¨ã€ã‹ã€Œå°è±¡ã«æ®‹ã£ãŸä½“é¨“ã€ã‚’å…¥ã‚Œã‚‹ã¨ã€
ãã£ã¨ä¼ã‚ã‚Šã‚„ã™ããªã‚Šã¾ã™ğŸ˜Š`
    };
  }

  let score = 60;
  const goodPoints = [];
  const badges = [];
  const advice = [];

  // æŸ”è»Ÿãƒ¯ãƒ¼ãƒ‰åˆ¤å®šï¼ˆè¨€ã„æ›ãˆè¨±å®¹ï¼‰
  const conclusion = ["çµè«–","è¦ã™ã‚‹ã«","ã¤ã¾ã‚Š","ä¸€è¨€ã§ã„ã†ã¨","ç§ã®è€ƒãˆã¯","åƒ•ã®è€ƒãˆã¯","ç§ã¯","åƒ•ã¯","å¤§äº‹ãªã®ã¯","é‡è¦ãªã®ã¯","ãƒã‚¤ãƒ³ãƒˆã¯","çµå±€","ä¸€ç•ªè¨€ã„ãŸã„ã®ã¯"];
  const reason = ["ãªãœãªã‚‰","ç†ç”±","èƒŒæ™¯","ã¨ã„ã†ã®ã‚‚","ãªãœã‹ã¨ã„ã†ã¨","ã ã‹ã‚‰ã“ã","ãªã®ã§","ã‹ã‚‰","ãŸã‚","ãŒã‚ã£ã¦"];
  const example = ["ä¾‹ãˆã°","ãŸã¨ãˆã°","å®Ÿéš›ã«","ã“ã®å‰","ä»¥å‰","å…ˆæ—¥","å…·ä½“çš„ã«","ä½“é¨“ã¨ã—ã¦","ãŸã¨ãˆã‚‹ã¨","ã“ã‚“ãªã“ã¨ãŒã‚ã£ã¦","ã®ã¨ã"];
  const summary = ["ã¾ã¨ã‚ã‚‹ã¨","çµè«–ã¨ã—ã¦","æœ€å¾Œã«","ã ã‹ã‚‰","ã¤ã¾ã‚Š","ãªã®ã§","ã¨ã„ã†ã‚ã‘ã§","è¦ã¯","ä»Šå¾Œã¯","æ¬¡ã¯","ã“ã‚Œã‹ã‚‰"];

  if(conclusion.some(w => t.includes(w))){
    score += 10; goodPoints.push("ãƒ†ãƒ¼ãƒï¼ˆä¸»å¼µï¼‰ãŒã¯ã£ãã‚Šã—ã¦ã„ã¾ã—ãŸ"); badges.push("ãƒ†ãƒ¼ãƒæ˜ç¢º");
  }
  if(reason.some(w => t.includes(w))){
    score += 10; goodPoints.push("ç†ç”±ã‚„èƒŒæ™¯ãŒä¼ã‚ã£ã¦ç´å¾—ã—ã‚„ã™ã‹ã£ãŸã§ã™"); badges.push("ç´å¾—æ„Ÿ");
  }
  if(example.some(w => t.includes(w))){
    score += 10; goodPoints.push("å…·ä½“ä¾‹ãŒã‚ã‚Šã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã‚„ã™ã‹ã£ãŸã§ã™"); badges.push("å…·ä½“æ€§");
  }
  if(summary.some(w => t.includes(w))){
    score += 10; goodPoints.push("æœ€å¾Œã®ç· ã‚ãƒ»ã¾ã¨ã‚ãŒè‰¯ãã€ä½™éŸ»ãŒæ®‹ã‚Šã¾ã—ãŸ"); badges.push("ç· ã‚ãŒè‰¯ã„");
  }

  if(t.length > 120){
    score += 5; goodPoints.push("å†…å®¹ã‚’ã—ã£ã‹ã‚Šè€ƒãˆã¦è©±ã—ã¦ã„ã‚‹ã®ãŒä¼ã‚ã‚Šã¾ã—ãŸ"); badges.push("å†…å®¹å……å®Ÿ");
  }

  const emotionWords = ["å¬‰ã—ã„","æ¥½ã—ã„","æ‚”ã—ã„","æ‚²ã—ã„","æ€–ã„","æ„Ÿå‹•","é©šã„ãŸ","ãƒ¯ã‚¯ãƒ¯ã‚¯","ãƒ¢ãƒ¤ãƒ¢ãƒ¤","è…¹ãŒç«‹ã£ãŸ","ã»ã£ã¨ã—ãŸ"];
  if(emotionWords.some(w => t.includes(w))){
    score += 5; goodPoints.push("æ„Ÿæƒ…ãŒå…¥ã£ã¦ã„ã¦ã€èãæ‰‹ã®å¿ƒã«å±Šãã‚„ã™ã„è©±ã—æ–¹ã§ã—ãŸ"); badges.push("æ„Ÿæƒ…ãŒä¼ã‚ã‚‹");
  }

  const listenerWords = ["ã‚ãªãŸ","ã¿ãªã•ã‚“","çš†ã•ã‚“","ç›¸æ‰‹","èãäºº","ä¼ãˆãŸã„","ãŠã™ã™ã‚","å…±æœ‰"];
  if(listenerWords.some(w => t.includes(w))){
    score += 5; goodPoints.push("èãæ‰‹ã‚’æ„è­˜ã—ãŸè¨€è‘‰é¸ã³ãŒã§ãã¦ã„ã¾ã—ãŸ"); badges.push("èãæ‰‹ç›®ç·š");
  }

  const hasReason = reason.some(w => t.includes(w));
  const hasExample = example.some(w => t.includes(w));
  const hasSummary = summary.some(w => t.includes(w));
  const hasConclusion = conclusion.some(w => t.includes(w));

  // æ”¹å–„ã¯1ã¤ã ã‘ï¼ˆå„ªã—ãï¼‰
  if(!hasExample){
    advice.push("å…·ä½“ä¾‹ã‚’ã€Œ1ã¤ã ã‘ã€å…¥ã‚Œã‚‹ã¨ã€ã•ã‚‰ã«ã‚°ãƒƒã¨ä¼ã‚ã‚Šã¾ã™ï¼ˆä¾‹ï¼šãã®æ™‚ã®å ´é¢ï¼å‡ºæ¥äº‹ï¼‰");
  } else if(!hasSummary){
    advice.push("æœ€å¾Œã«ä¸€è¨€ã ã‘ã€Œã¾ã¨ã‚ã€ã‚’ç½®ãã¨ã€èãæ‰‹ã®è¨˜æ†¶ã«æ®‹ã‚Šã‚„ã™ããªã‚Šã¾ã™");
  } else if(!hasReason){
    advice.push("ç†ç”±ã‚’ä¸€è¨€è¶³ã™ã¨èª¬å¾—åŠ›ãŒå¢—ã—ã¾ã™ï¼ˆä¾‹ï¼šãªãœãã†æ„Ÿã˜ãŸã‹ï¼‰");
  } else if(!hasConclusion){
    advice.push("å†’é ­ã‹æœ€å¾Œã«ã€Œä¸€ç•ªä¼ãˆãŸã„çµè«–ã€ã‚’ä¸€è¨€ç½®ãã¨ã€ã•ã‚‰ã«åˆ†ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™");
  }

  const praise = goodPoints.length
    ? goodPoints[Math.floor(Math.random() * goodPoints.length)]
    : "å‰å‘ãã«è©±ãã†ã¨ã—ã¦ã„ã‚‹å§¿å‹¢ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™";

  const improve = advice.length ? advice[0] : "ä»Šã®èª¿å­ã§ç¶šã‘ã¦ã„ãã¾ã—ã‚‡ã†";
  score = Math.min(score, 100);

  const finalBadges = badges.length ? badges : ["å‰å‘ã"];

  return {
    score,
    badges: finalBadges,
    message:
`ğŸŒŸ ç·åˆè©•ä¾¡ï¼š${score}ç‚¹

ã¨ã¦ã‚‚è‰¯ã„ã‚¹ãƒ”ãƒ¼ãƒã§ã—ãŸã€‚

ç‰¹ã«ã€Œ${praise}ã€ç‚¹ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚

ğŸ’¡ ã•ã‚‰ã«è‰¯ãã™ã‚‹ãªã‚‰ï¼š
${improve}

ã“ã‚Œã‹ã‚‰ã‚‚è‡ªä¿¡ã‚’æŒã£ã¦è©±ã—ã¦å¤§ä¸ˆå¤«ã§ã™ğŸ˜Š`
  };
}

/* =========================
   â‘¢ UIæ“ä½œ
========================= */
function hxRunEvaluation(){
  const text = document.getElementById("hxSpeechText").value;
  const res = hxGentleEvaluate(text);

  const badgesEl = document.getElementById("hxBadges");
  badgesEl.innerHTML = "";
  (res.badges || []).forEach(b => {
    const span = document.createElement("span");
    span.textContent = b;
    span.style.display = "inline-block";
    span.style.padding = "6px 10px";
    span.style.borderRadius = "999px";
    span.style.border = "1px solid #ddd";
    span.style.fontSize = "14px";
    span.style.margin = "4px 6px 0 0";
    badgesEl.appendChild(span);
  });

  document.getElementById("hxResult").textContent = res.message;
}

function hxClearText(){
  document.getElementById("hxSpeechText").value = "";
  document.getElementById("hxBadges").innerHTML = "";
  document.getElementById("hxResult").textContent = "ã“ã“ã«è©•ä¾¡çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
}

function hxInsertTemplate(){
  document.getElementById("hxSpeechText").value =
`ï¼ˆä¾‹ï¼‰ç§ãŒä¼ãˆãŸã„ã“ã¨ã¯ã€‡ã€‡ã§ã™ã€‚
ã¨ã„ã†ã®ã‚‚ã€â–³â–³ã¨ã„ã†èƒŒæ™¯ãŒã‚ã£ã¦â€¦
ä¾‹ãˆã°ã€â–¡â–¡ã¨ã„ã†å‡ºæ¥äº‹ãŒã‚ã‚Šã¾ã—ãŸã€‚
ã ã‹ã‚‰ã€ä»Šå¾Œã¯â—‡â—‡ã‚’æ„è­˜ã—ãŸã„ã§ã™ã€‚`;
  hxRunEvaluation();
}
</script>
