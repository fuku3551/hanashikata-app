<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è©±æ³•åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<header class="top">
  <h1>ğŸ§  è©±æ³•åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
  <p class="sub">AREA / PREP / ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ / äº¤æ¸‰è¡“</p>
  <p><a href="index.html">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a></p>
</header>

<main class="menu">

  <!-- âœ… ä½¿ã„æ–¹ï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰ -->
  <div class="card" style="display:block;">
    <div class="title">ğŸ§­ ä½¿ã„æ–¹ï¼ˆè¿·ã£ãŸã‚‰ã“ã“ï¼‰</div>
    <div class="desc" style="line-height:1.8;">
      <details>
        <summary style="cursor:pointer; font-weight:700;">ç·´ç¿’ã®æµã‚Œã‚’è¦‹ã‚‹</summary>
        <div style="margin-top:10px;">
          â‘  è©±æ³•ã‚’é¸ã¶ï¼ˆAREA / PREP / ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ / äº¤æ¸‰ï¼‰<br>
          â‘¡ ãŠé¡Œã‚’å‡ºã™ï¼ˆã‚¹ã‚¿ãƒ¼ãƒˆ or ãŠé¡Œã ã‘æ›´æ–°ï¼‰<br>
          â‘¢ è¿·ã£ãŸã‚‰ã€ŒğŸ“Œæ¨¡ç¯„è§£ç­”ã€â†’ã€ŒğŸ§©ç©´åŸ‹ã‚ç·´ç¿’ã€ã§è‡ªåˆ†ã®è¨€è‘‰ã«ç›´ã™<br>
          â‘£ éŒ²éŸ³ã—ã¦è‡ªåˆ†ã®å£°ã‚’èãï¼ˆã“ã‚ŒãŒä¸€ç•ªä¼¸ã³ã¾ã™ï¼‰<br>
          â‘¤ åŸç¨¿æ¬„ã«ãƒ¡ãƒ¢ã—ã¦AIè©•ä¾¡ï¼ˆã‚„ã•ã—ãæ”¹å–„ç‚¹ãŒå‡ºã¾ã™ï¼‰<br><br>
          ğŸ’¡ ã‚³ãƒ„ï¼šæœ€åˆã¯ã€Œå‹ã‚’çœŸä¼¼ã‚‹ã€â†’æ…£ã‚ŒãŸã‚‰ã€Œè‡ªåˆ†ã®ä½“é¨“ã€ã‚’å°‘ã—è¶³ã™
        </div>
      </details>
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
  <div class="card" style="display:block;">
    <div class="title">â‘  è©±æ³•ã‚’é¸ã¶</div>
    <div class="desc">
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button onclick="setMode('area')" id="btn-area">AREA</button>
        <button onclick="setMode('prep')" id="btn-prep">PREP</button>
        <button onclick="setMode('story')" id="btn-story">ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</button>
        <button onclick="setMode('nego')" id="btn-nego">äº¤æ¸‰è¡“</button>
      </div>
      <p id="modeHint" style="margin-top:10px; line-height:1.7; opacity:0.9;">
        ã¾ãšè©±æ³•ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚
      </p>
    </div>
  </div>

  <!-- ãŠé¡Œ -->
  <div class="card" style="display:block;">
    <div class="title">â‘¡ ãŠé¡Œ</div>
    <div class="desc">
      <p id="topic" style="font-size:20px; font-weight:bold;">ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
      <p id="topicHint" style="margin-top:8px; line-height:1.7; opacity:0.85;"></p>

      <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center; align-items:center;">
        <label style="font-size:14px; opacity:0.9;">
          <input type="checkbox" id="lockTopic" />
          ãŠé¡Œå›ºå®šï¼ˆåŒã˜ãŠé¡Œã§ç¹°ã‚Šè¿”ã—ç·´ç¿’ï¼‰
        </label>

        <button onclick="copyTopic()" style="padding:10px 12px; border-radius:12px; border:1px solid #ddd; background:#fff;">
          ğŸ“‹ ãŠé¡Œã‚’ã‚³ãƒ”ãƒ¼
        </button>
      </div>
    </div>
  </div>

  <!-- âœ… æ¨¡ç¯„è§£ç­”ï¼ˆè¤‡æ•°åˆ‡æ›¿ï¼‰ -->
  <div class="card" style="display:block;">
    <div class="title">âœ… æ¨¡ç¯„è§£ç­”ï¼ˆåˆ‡æ›¿OKï¼‰</div>
    <div class="desc">
      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button id="modelBtn" onclick="toggleModelAnswer()">ğŸ“Œ æ¨¡ç¯„è§£ç­”ã‚’è¡¨ç¤º</button>
        <button id="modelNextBtn" onclick="nextModelAnswer()" style="opacity:0.6;">ğŸ” åˆ¥ã®æ¨¡ç¯„è§£ç­”</button>
        <button id="modelCopyBtn" onclick="copyModelToTextarea()" style="opacity:0.6;">ğŸ“‹ åŸç¨¿æ¬„ã¸ã‚³ãƒ”ãƒ¼</button>
        <button id="modelClozeBtn" onclick="insertClozeToTextarea()" style="opacity:0.6;">ğŸ§© ç©´åŸ‹ã‚ç·´ç¿’</button>
      </div>

      <p id="modelLabel" style="margin-top:10px; font-size:14px; opacity:0.85; text-align:center;"></p>

      <div id="modelBox"
           style="display:none; margin-top:10px; padding:12px; border:1px solid #eee; border-radius:12px; line-height:1.9; white-space:pre-wrap;">
        ã“ã“ã«æ¨¡ç¯„è§£ç­”ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
      </div>

      <p style="margin-top:10px; font-size:14px; opacity:0.85; line-height:1.7;">
        ğŸ’¡ è¿·ã£ãŸã‚‰æ¨¡ç¯„è§£ç­”ã‚’è¦‹ã¦OKã€‚æœ€åˆã¯ã€Œå‹ã‚’çœŸä¼¼ã‚‹ã€ãŒæœ€é€Ÿã§ã™ã€‚<br>
        ğŸ§©ç©´åŸ‹ã‚ç·´ç¿’ï¼šã€‡ã€‡/â–³â–³/â–¡â–¡/â—‡â—‡ã‚’è‡ªåˆ†ã®è¨€è‘‰ã«ç½®ãæ›ãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚
      </p>
    </div>
  </div>

  <!-- ã‚¿ã‚¤ãƒãƒ¼ -->
  <div class="card" style="display:block;">
    <div class="title">â‘¢ ã‚¿ã‚¤ãƒãƒ¼</div>
    <div class="desc">
      <p id="timer" style="font-size:32px;">--</p>
      <div style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap;">
        <button onclick="start()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button onclick="stop()">â¹ ã‚¹ãƒˆãƒƒãƒ—</button>
        <button onclick="newTopic()">ğŸ² ãŠé¡Œã ã‘æ›´æ–°</button>
      </div>
      <p id="timeHint" style="margin-top:10px; opacity:0.85;"></p>
    </div>
  </div>

  <!-- éŒ²éŸ³ï¼‹è©•ä¾¡ -->
  <section class="card" style="display:block;" id="practiceArea">
    <div class="title">ğŸ™ éŒ²éŸ³ & AIè©•ä¾¡ï¼ˆ1ç”»é¢å®Œçµï¼‰</div>
    <div class="desc">

      <div style="border:1px solid #eee; border-radius:14px; padding:12px;">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <button id="hxRecBtn" onclick="hxToggleRecording()"
            style="padding:12px 14px; border-radius:12px; border:none; background:#22c55e; color:#fff;">
            éŒ²éŸ³é–‹å§‹
          </button>

          <button onclick="hxResetRecording()"
            style="padding:12px 14px; border-radius:12px; border:none; background:#ef4444; color:#fff;">
            éŒ²éŸ³ãƒªã‚»ãƒƒãƒˆ
          </button>

          <span id="hxRecStatus" style="font-family: ui-monospace, SFMono-Regular, Menlo, monospace;">
            å¾…æ©Ÿä¸­
          </span>
        </div>

        <audio id="hxPlayer" controls style="display:none; width:100%; margin-top:10px;"></audio>

        <div style="margin-top:10px; font-size:14px; opacity:0.9; line-height:1.7;">
          âœ… éŒ²éŸ³â†’å†ç”Ÿã§ãã¾ã™ï¼ˆç«¯æœ«å†…ï¼‰<br>
          ğŸ’¡ éŒ²éŸ³ã‚’èããªãŒã‚‰ä¸‹ã®æ¬„ã«åŸç¨¿ãƒ¡ãƒ¢ â†’ ã€ŒAIè©•ä¾¡ã€ãŒãŠã™ã™ã‚
        </div>
      </div>

      <div style="margin-top:12px;">
        <div style="font-weight:700; margin-bottom:6px;">ğŸ“ ã‚¹ãƒ”ãƒ¼ãƒæœ¬æ–‡ï¼ˆè©•ä¾¡å¯¾è±¡ï¼‰</div>
        <textarea id="hxSpeechText"
          placeholder="ã“ã“ã«ã‚¹ãƒ”ãƒ¼ãƒã‚’æ›¸ã„ã¦ãã ã•ã„ï¼ˆéŒ²éŸ³ã‚’èããªãŒã‚‰ãƒ¡ãƒ¢ã§ã‚‚OKï¼‰"
          style="width:100%; min-height:180px; padding:12px; border-radius:12px; border:1px solid #ddd;"></textarea>

        <!-- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é•·ã•è¡¨ç¤º -->
        <div id="hxLiveMeter" style="margin-top:8px; font-size:14px; opacity:0.9; line-height:1.7;">
          æ–‡å­—æ•°ï¼š0 / æ¨å®šï¼š0ç§’ / ç›®æ¨™ï¼š--ç§’
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
          <button onclick="hxRunEvaluation()"
            style="padding:12px 14px; border-radius:12px; border:none; background:#0ea5e9; color:#fff;">
            AIè©•ä¾¡ã™ã‚‹
          </button>

          <button onclick="hxClearText()"
            style="padding:12px 14px; border-radius:12px; border:1px solid #ddd; background:#fff;">
            ã‚¯ãƒªã‚¢
          </button>

          <button onclick="hxInsertTemplate()"
            style="padding:12px 14px; border-radius:12px; border:1px solid #ddd; background:#fff;">
            ãƒ†ãƒ³ãƒ—ãƒ¬æŒ¿å…¥
          </button>
        </div>

        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          <button onclick="saveDraft(true)" style="padding:10px 12px; border-radius:12px; border:1px solid #ddd; background:#fff;">
            ğŸ’¾ ã„ã¾ä¿å­˜
          </button>
          <button onclick="loadDraft(true)" style="padding:10px 12px; border-radius:12px; border:1px solid #ddd; background:#fff;">
            ğŸ“¥ ä¿å­˜ã‚’èª­è¾¼
          </button>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div id="hxBadges"></div>
        <div id="hxResult" style="white-space:pre-wrap; line-height:1.9; margin-top:10px;">
          ã“ã“ã«è©•ä¾¡çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
        </div>
      </div>

    </div>
  </section>

</main>

<script>
/* =========================
   ã„ã¾è¡¨ç¤ºä¸­ã®ãŠé¡Œï¼ˆæ¨¡ç¯„è§£ç­”ãƒ»è©•ä¾¡ã«ä½¿ã†ï¼‰
========================= */
let currentItem = null;

/* =========================
   âœ… æ¨¡ç¯„è§£ç­”ï¼ˆè¤‡æ•°ï¼‰ç®¡ç†
========================= */
let modelVariants = [];     // [{label,text}, ...]
let modelIndex = 0;

function hxNormalizeNewlines(s){
  return (s || "").replace(/\r\n/g, "\n").trim();
}

/* ãƒ™ãƒ¼ã‚¹ä¾‹ã‹ã‚‰ã€ŒçŸ­ã‚ã€ã€Œä¸å¯§ã€ã€Œã—ã£ã‹ã‚Šã€ã‚’è‡ªå‹•ç”Ÿæˆ */
function buildModelVariants(baseText, modeKey){
  const base = hxNormalizeNewlines(baseText);
  const lines = base.split("\n").map(x => x.trim()).filter(Boolean);

  const v0 = { label: "æ¨™æº–ï¼ˆåŸºæœ¬ã®å‹ï¼‰", text: base };

  const shortLines = lines.slice(0, Math.min(3, lines.length));
  const v1 = { label: "çŸ­ã‚ï¼ˆæ™‚é–“ãŒçŸ­ã„æ™‚ï¼‰", text: shortLines.join("\n") };

  const politeHead =
    (modeKey === "nego") ? "æã‚Œå…¥ã‚Šã¾ã™ãŒã€" :
    (modeKey === "area") ? "å·®ã—æ”¯ãˆãªã‘ã‚Œã°ã€" :
    "ã‚ˆã‚ã—ã‘ã‚Œã°ã€";
  const v2 = { label: "ä¸å¯§ï¼ˆã‚„ã•ã—ã‚ï¼‰", text: politeHead + "\n" + base };

  const add =
    (modeKey === "prep") ? "\nï¼ˆè£œè¶³ï¼‰ç†ç”±ã¯ä¸€è¨€ã§OKã€‚å…·ä½“ä¾‹ã¯1ã¤ã«çµã‚‹ã¨40ç§’ã§åã¾ã‚Šã¾ã™ã€‚" :
    (modeKey === "area") ? "\nï¼ˆè£œè¶³ï¼‰æœ€å¾Œã«ã€Œã¾ãšã¯ã“ã“ã‹ã‚‰ã€ã ã‘ææ¡ˆã™ã‚‹ã¨ç›¸æ‰‹ãŒå‹•ãã‚„ã™ã„ã§ã™ã€‚" :
    (modeKey === "story") ? "\nï¼ˆè£œè¶³ï¼‰æ„Ÿæƒ…ã‚’1èªã ã‘å…¥ã‚Œã‚‹ã¨ã€èãæ‰‹ã®å¿ƒã«æ®‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ã€‚" :
    "\nï¼ˆè£œè¶³ï¼‰ä»£æ¡ˆã‚’2ã¤ç”¨æ„ã—ã€ç›¸æ‰‹ã®è² æ‹…ãŒå°‘ãªã„æ–¹ã‚’é¸ã¹ã‚‹å½¢ã«ã™ã‚‹ã¨é€šã‚Šã‚„ã™ã„ã§ã™ã€‚";
  const v3 = { label: "ã—ã£ã‹ã‚Šï¼ˆåšã‚ï¼‰", text: base + add };

  const uniq = [];
  [v0, v1, v2, v3].forEach(v => {
    if(!v.text) return;
    if(uniq.some(u => u.text === v.text)) return;
    uniq.push(v);
  });

  return uniq;
}

function prepareModelVariants(){
  const nextBtn = document.getElementById("modelNextBtn");
  const copyBtn = document.getElementById("modelCopyBtn");
  const clozeBtn = document.getElementById("modelClozeBtn");

  if(!currentItem || !currentItem.model){
    modelVariants = [];
    modelIndex = 0;
    nextBtn.style.opacity = "0.6";
    copyBtn.style.opacity = "0.6";
    clozeBtn.style.opacity = "0.6";
    return;
  }

  modelVariants = buildModelVariants(currentItem.model, currentModeKey);
  modelIndex = 0;

  nextBtn.style.opacity = (modelVariants.length >= 2) ? "1" : "0.6";
  copyBtn.style.opacity = "1";
  clozeBtn.style.opacity = "1";
}

function updateModelUI(){
  const box = document.getElementById("modelBox");
  const label = document.getElementById("modelLabel");

  if(!currentItem){
    label.textContent = "";
    box.textContent = "å…ˆã«ãŠé¡Œã‚’å‡ºã—ã¦ãã ã•ã„";
    return;
  }

  if(modelVariants.length === 0){
    label.textContent = "";
    box.textContent = currentItem.model ? currentItem.model : "ï¼ˆã“ã®ãŠé¡Œã®æ¨¡ç¯„è§£ç­”ã¯æº–å‚™ä¸­ã§ã™ï¼‰";
    return;
  }

  const v = modelVariants[modelIndex] || modelVariants[0];
  label.textContent = `è¡¨ç¤ºä¸­ï¼š${v.label}ï¼ˆ${modelIndex + 1}/${modelVariants.length}ï¼‰`;
  box.textContent = v.text;
}

function hideModelAnswer(){
  const box = document.getElementById("modelBox");
  const btn = document.getElementById("modelBtn");
  const label = document.getElementById("modelLabel");
  box.style.display = "none";
  btn.textContent = "ğŸ“Œ æ¨¡ç¯„è§£ç­”ã‚’è¡¨ç¤º";
  label.textContent = "";
}

function toggleModelAnswer(){
  if(!currentItem){
    alert("å…ˆã«ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆã¾ãŸã¯ ãŠé¡Œã ã‘æ›´æ–°ï¼‰ã§ãŠé¡Œã‚’å‡ºã—ã¦ãã ã•ã„ğŸ˜Š");
    return;
  }
  const box = document.getElementById("modelBox");
  const btn = document.getElementById("modelBtn");

  if(box.style.display === "none"){
    prepareModelVariants();
    updateModelUI();
    box.style.display = "block";
    btn.textContent = "ğŸ™ˆ æ¨¡ç¯„è§£ç­”ã‚’éš ã™";
  }else{
    hideModelAnswer();
  }
}

function nextModelAnswer(){
  if(!currentItem){
    alert("å…ˆã«ãŠé¡Œã‚’å‡ºã—ã¦ãã ã•ã„ğŸ˜Š");
    return;
  }
  if(modelVariants.length <= 1) return;
  modelIndex = (modelIndex + 1) % modelVariants.length;

  const box = document.getElementById("modelBox");
  if(box.style.display !== "none") updateModelUI();
}

function copyModelToTextarea(){
  if(!currentItem){
    alert("å…ˆã«ãŠé¡Œã‚’å‡ºã—ã¦ãã ã•ã„ğŸ˜Š");
    return;
  }
  prepareModelVariants();
  const v = modelVariants[modelIndex] || { text: currentItem.model || "" };
  const ta = document.getElementById("hxSpeechText");
  ta.value = hxNormalizeNewlines(v.text);
  hxUpdateLiveMeter();
  saveDraft(false);
  hxRunEvaluation();
}

/* =========================
   ğŸ§© ç©´åŸ‹ã‚ç·´ç¿’ï¼ˆè¿½åŠ æ©Ÿèƒ½ï¼‰
========================= */
function hxMakeCloze(text, modeKey){
  const s = hxNormalizeNewlines(text);

  // è¦‹å‡ºã—è¡Œã‚’å„ªå…ˆçš„ã«ç©´åŸ‹ã‚ã«ã™ã‚‹
  const replacePairs = [
    ["ç›®çš„ï¼š", "ç›®çš„ï¼šã€‡ã€‡ï¼ˆä½•ã‚’ç›¸è«‡/ãŠé¡˜ã„ã—ãŸã„ï¼Ÿï¼‰\n"],
    ["ç†ç”±ï¼š", "ç†ç”±ï¼šâ–³â–³ï¼ˆèƒŒæ™¯/äº‹æƒ…ï¼‰\n"],
    ["æ¡ä»¶ï¼š", "æ¡ä»¶ï¼šâ–¡â–¡ï¼ˆå¸Œæœ›/æ¡ä»¶ï¼‰\n"],
    ["ä»£æ¡ˆï¼š", "ä»£æ¡ˆï¼šâ—‡â—‡ï¼ˆAæ¡ˆ/Bæ¡ˆï¼‰\n"],
    ["åˆæ„ï¼š", "åˆæ„ï¼šâ—â—ï¼ˆè½ã¨ã—æ‰€ï¼‰\n"],

    ["Aï¼š", "Aï¼šã€‡ã€‡ï¼ˆå…±æ„Ÿ/è‚¯å®šï¼‰\n"],
    ["Rï¼š", "Rï¼šâ–³â–³ï¼ˆç†ç”±/èƒŒæ™¯ï¼‰\n"],
    ["Eï¼š", "Eï¼šâ–¡â–¡ï¼ˆå…·ä½“ä¾‹/å ´é¢ï¼‰\n"],
    ["Pï¼š", "Pï¼šã€‡ã€‡ï¼ˆçµè«–ï¼‰\n"]
  ];

  let out = s;
  replacePairs.forEach(([from, to]) => {
    out = out.replace(new RegExp("^" + from, "gm"), to);
  });

  // ãƒˆãƒ¼ã‚¯ãƒ³ãŒå°‘ãªã™ãã‚‹æ™‚ã ã‘è»½ãè£œåŠ©
  const countTokens = (str) => (str.match(/ã€‡ã€‡|â–³â–³|â–¡â–¡|â—‡â—‡|â—â—/g) || []).length;
  if(countTokens(out) < 3){
    out = out
      .replace(/(çµè«–ã¯)([^ã€‚\n]{2,12})/,"$1ã€‡ã€‡")
      .replace(/(ãªãœãªã‚‰)([^ã€‚\n]{2,12})/,"$1â–³â–³")
      .replace(/(ä¾‹ãˆã°)([^ã€‚\n]{2,12})/,"$1â–¡â–¡");
  }

  const guide =
    (modeKey === "prep") ? "\n\nï¼ˆç©´åŸ‹ã‚ã‚¬ã‚¤ãƒ‰ï¼‰\nãƒ»çµè«–ã€‡ã€‡ â†’ ç†ç”±â–³â–³ â†’ å…·ä½“ä¾‹â–¡â–¡ â†’ çµè«–ã€‡ã€‡\nãƒ»å…·ä½“ä¾‹ã¯1ã¤ã§OK"
    : (modeKey === "area") ? "\n\nï¼ˆç©´åŸ‹ã‚ã‚¬ã‚¤ãƒ‰ï¼‰\nãƒ»å…±æ„Ÿã€‡ã€‡ â†’ ç†ç”±â–³â–³ â†’ å…·ä½“ä¾‹â–¡â–¡ â†’ ææ¡ˆâ—‡â—‡\nãƒ»æœ€å¾Œã¯â€œã¾ãšã¯ã“ã“ã‹ã‚‰â€ãŒå¼·ã„"
    : (modeKey === "story") ? "\n\nï¼ˆç©´åŸ‹ã‚ã‚¬ã‚¤ãƒ‰ï¼‰\nãƒ»çŠ¶æ³ã€‡ã€‡ â†’ å‡ºæ¥äº‹â–³â–³ â†’ æ„Ÿæƒ…â–¡â–¡ â†’ å­¦ã³â—‡â—‡ â†’ ä»Šå¾Œâ—â—\nãƒ»æ„Ÿæƒ…ã‚’1èªå…¥ã‚Œã‚‹"
    : "\n\nï¼ˆç©´åŸ‹ã‚ã‚¬ã‚¤ãƒ‰ï¼‰\nãƒ»ç›®çš„ã€‡ã€‡ â†’ ç†ç”±â–³â–³ â†’ æ¡ä»¶â–¡â–¡ â†’ ä»£æ¡ˆâ—‡â—‡ â†’ åˆæ„â—â—\nãƒ»ä»£æ¡ˆã¯2ã¤ã‚ã‚‹ã¨é€šã‚Šã‚„ã™ã„";

  return out + guide;
}

function insertClozeToTextarea(){
  if(!currentItem){
    alert("å…ˆã«ãŠé¡Œã‚’å‡ºã—ã¦ãã ã•ã„ğŸ˜Š");
    return;
  }
  prepareModelVariants();
  const v = modelVariants[modelIndex] || { text: currentItem.model || "" };
  const cloze = hxMakeCloze(v.text, currentModeKey);

  const ta = document.getElementById("hxSpeechText");
  ta.value = cloze;
  hxUpdateLiveMeter();
  saveDraft(false);

  // åˆå¿ƒè€…ãŒè¿·ã‚ãªã„ã‚ˆã†ã«ã€å…¥åŠ›æ¬„ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
  document.getElementById("practiceArea").scrollIntoView({ behavior:"smooth", block:"start" });
}

/* =========================
   ãŠé¡Œã‚³ãƒ”ãƒ¼
========================= */
function copyTopic(){
  const t = document.getElementById("topic").textContent || "";
  if(!t || t.includes("ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„")){
    alert("å…ˆã«ãŠé¡Œã‚’å‡ºã—ã¦ãã ã•ã„ğŸ˜Š");
    return;
  }
  navigator.clipboard?.writeText(t);
  alert("ãŠé¡Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸğŸ˜Š");
}

/* =========================
   è¨­å®šï¼šãƒ¢ãƒ¼ãƒ‰åˆ¥ï¼ˆç¦ç”°ã•ã‚“ã®ãƒ‡ãƒ¼ã‚¿ãã®ã¾ã¾ï¼‰
========================= */
const MODES = {
  area: {
    name: "AREA",
    seconds: 80,
    hint: "å…±æ„Ÿâ†’ç†ç”±â†’å…·ä½“ä¾‹â†’ææ¡ˆï¼ˆç›¸æ‰‹ã‚’å¦å®šã›ãšå°ãï¼‰",
    topicHint: "ğŸ’¡ ã¾ãšå…±æ„Ÿã€ãã®å¾Œã«ç†ç”±â†’å…·ä½“ä¾‹â†’ææ¡ˆã§ã¾ã¨ã‚ã‚‹ã¨å¼·ã„ã§ã™ã€‚",
    topics: [
      { topic:"ä»•äº‹ã§ç›¸æ‰‹ãŒä¸å®‰ãã†ãªæ™‚ã€ã©ã†å£°ã‚’ã‹ã‘ã‚‹ï¼Ÿ",
        model:`Aï¼šä¸å®‰ã«ãªã‚Šã¾ã™ã‚ˆã­ã€‚å¤§ä¸ˆå¤«ã§ã™ã€‚
Rï¼šæœ€åˆã¯çŠ¶æ³ãŒè¦‹ãˆãªã„ã¨ä¸å®‰ãŒå¼·ããªã‚Šã‚„ã™ã„ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€æ‰‹é †ã‚’1ã¤ãšã¤ç¢ºèªã™ã‚‹ã¨è½ã¡ç€ã„ã¦é€²ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚
Aï¼šã¾ãšã¯ã€Œä»Šã§ãã¦ã„ã‚‹ã“ã¨ã€ã‚’ä¸€ç·’ã«æ•´ç†ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ` },
      { topic:"æ–°äººãŒãƒŸã‚¹ã—ã¦è½ã¡è¾¼ã‚“ã§ã„ã‚‹æ™‚ã®ä¼ãˆæ–¹",
        model:`Aï¼šè½ã¡è¾¼ã¿ã¾ã™ã‚ˆã­ã€‚ã¡ã‚ƒã‚“ã¨é ‘å¼µã£ã¦ã„ãŸã®ã‚‚è¦‹ã¦ã¾ã—ãŸã€‚
Rï¼šãƒŸã‚¹ã¯ã€ŒçµŒé¨“å€¤ãŒå¢—ãˆã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€ã§ã‚‚ã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€ç§ã‚‚æœ€åˆã¯åŒã˜æ‰€ã§ã¤ã¾ãšãã¾ã—ãŸãŒã€æ‰‹é †ã‚’ãƒ¡ãƒ¢ã—ã¦æ”¹å–„ã—ã¾ã—ãŸã€‚
Aï¼šæ¬¡ã¯ã€Œã“ã“ã ã‘æ³¨æ„ã€ãƒã‚¤ãƒ³ãƒˆã‚’ä¸€ç·’ã«æ±ºã‚ã¦ã€ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚` },
      { topic:"ç›¸æ‰‹ãŒæ€’ã£ã¦ã„ã‚‹æ™‚ã«è½ã¡ç€ã‹ã›ã‚‹ä¸€è¨€",
        model:`Aï¼šå«Œãªæ°—æŒã¡ã«ã•ã›ã¦ã—ã¾ã„ã¾ã—ãŸã‚ˆã­ã€‚ã™ã¿ã¾ã›ã‚“ã€‚
Rï¼šã¾ãšæ°—æŒã¡ãŒåã¾ã‚‹ã¨ã€è©±ãŒæ•´ç†ã—ã‚„ã™ããªã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€æ€¥ã„ã§ã„ã‚‹æ™‚ã»ã©è¨€è‘‰ãŒå¼·ããªã‚Šã‚„ã™ã„ã§ã™ã‚ˆã­ã€‚
Aï¼šã‚ˆã‘ã‚Œã°ã€ä½•ãŒä¸€ç•ªå›°ã£ãŸã‹ã‚’å…ˆã«æ•™ãˆã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ` },
      { topic:"å¿™ã—ã„åŒåƒšã«å”åŠ›ã‚’ãŠé¡˜ã„ã™ã‚‹æ™‚ã®è¨€ã„æ–¹",
        model:`Aï¼šå¿™ã—ã„ä¸­ã™ã¿ã¾ã›ã‚“ã€‚
Rï¼šä»Šæ—¥ã ã‘æ‰‹ãŒè¶³ã‚Šãªãã¦ã€å°‘ã—ã ã‘åŠ©ã‘ãŒå¿…è¦ã§â€¦
Eï¼šä¾‹ãˆã°ã€5åˆ†ã ã‘ã“ã“ã‚’ãŠé¡˜ã„ã§ãã‚‹ã¨å…¨ä½“ãŒå›ã‚Šã¾ã™ã€‚
Aï¼šå¯èƒ½ãªã‚‰ã“ã®éƒ¨åˆ†ã ã‘ãŠé¡˜ã„ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿé›£ã—ã‘ã‚Œã°åˆ¥æ¡ˆã‚‚è€ƒãˆã¾ã™ã€‚` },
      { topic:"åˆ©ç”¨è€…ã•ã‚“ã«ãŠé¡˜ã„ã”ã¨ã‚’ã™ã‚‹æ™‚ã®è¨€ã„æ–¹",
        model:`Aï¼šã”ä¸ä¾¿ã§ã™ã‚ˆã­ã€‚ã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
Rï¼šå®‰å…¨ã®ãŸã‚ã«ã€ã“ã“ã ã‘ã”å”åŠ›ã„ãŸã ããŸãã¦â€¦
Eï¼šä¾‹ãˆã°ã€å…ˆã«ä½“å‹¢ã‚’æ•´ãˆã‚‹ã¨æ¯ãŒæ¥½ã«ãªã‚‹æ–¹ãŒå¤šã„ã§ã™ã€‚
Aï¼šã¾ãšã¯30ç§’ã ã‘ã“ã®å§¿å‹¢ã§è©¦ã—ã¦ã¿ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ` },
      { topic:"å®¶æ—ã«å”åŠ›ã—ã¦ã»ã—ã„æ™‚ã®ä¼ãˆæ–¹",
        model:`Aï¼šã„ã¤ã‚‚ã‚ã‚ŠãŒã¨ã†ã€‚æœ¬å½“ã«åŠ©ã‹ã£ã¦ã¾ã™ã€‚
Rï¼šæœ€è¿‘ä½™è£•ãŒãªãã¦ã€å°‘ã—è² æ‹…ãŒåã£ã¦ã„ã‚‹æ°—ãŒã—ã¦â€¦
Eï¼šä¾‹ãˆã°ã€æœã®æº–å‚™ã ã‘æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ãˆã‚‹ã¨å…¨ä½“ãŒæ¥½ã«ãªã‚Šã¾ã™ã€‚
Aï¼šã§ããã†ãªç¯„å›²ã§ã€1ã¤ã ã‘å”åŠ›ã—ã¦ã‚‚ã‚‰ãˆãªã„ã‹ãªï¼Ÿ` },
      { topic:"ç›¸æ‰‹ã®ä¸æº€ã‚’å—ã‘æ­¢ã‚ã¤ã¤ææ¡ˆã™ã‚‹",
        model:`Aï¼šãã†æ„Ÿã˜ã‚‹ã®ã€å½“ç„¶ã ã¨æ€ã„ã¾ã™ã€‚
Rï¼šèƒŒæ™¯ã¨ã—ã¦ã€‡ã€‡ãŒé‡ãªã£ã¦ã„ãŸã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
Eï¼šä¾‹ãˆã°ã€â–³â–³ã®æ™‚ã‚‚åŒã˜ä¸æº€ãŒå‡ºã‚„ã™ã‹ã£ãŸã§ã™ã‚ˆã­ã€‚
Aï¼šæ¬¡ã¯â–¡â–¡ã‚’å…ˆã«å…±æœ‰ã—ã¦ã€ã‚ºãƒ¬ã‚’æ¸›ã‚‰ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ` },
      { topic:"æ³¨æ„ã‚’ã—ãŸã„ãŒé–¢ä¿‚æ€§ã‚’å£Šã—ãŸããªã„",
        model:`Aï¼šã„ã¤ã‚‚åŠ©ã‹ã£ã¦ã„ã¾ã™ã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
Rï¼šãŸã ã€ã“ã“ã ã‘ã¯å®‰å…¨é¢ã§å¤§äº‹ã§â€¦
Eï¼šä¾‹ãˆã°ã€æ‰‹é †ã‚’1ã¤æŠœãã¨äº‹æ•…ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚
Aï¼šä»Šå¾Œã¯ã“ã®éƒ¨åˆ†ã ã‘ä¸€ç·’ã«ç¢ºèªã—ãªãŒã‚‰é€²ã‚ã¾ã—ã‚‡ã†ã€‚` },
      { topic:"æ–­ã‚ŠãŸã„ä¾é ¼ã‚’è§’ãŒç«‹ãŸãªã„ã‚ˆã†ã«æ–­ã‚‹",
        model:`Aï¼šå£°ã‚’ã‹ã‘ã¦ãã‚Œã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
Rï¼šãŸã ã€ä»Šã¯ã€‡ã€‡ã®ç†ç”±ã§é›£ã—ãã¦â€¦
Eï¼šä¾‹ãˆã°ã€ç„¡ç†ã«å¼•ãå—ã‘ã‚‹ã¨è³ªãŒä¸‹ãŒã£ã¦ã—ã¾ã†ã®ã§ã€‚
Aï¼šä»£ã‚ã‚Šã«â–¡â–¡ãªã‚‰å”åŠ›ã§ãã¾ã™ãŒã€ã„ã‹ãŒã§ã—ã‚‡ã†ï¼Ÿ` },
      { topic:"ç›¸æ‰‹ãŒè¿·ã£ã¦ã„ã‚‹æ™‚ã«èƒŒä¸­ã‚’æŠ¼ã™",
        model:`Aï¼šè¿·ã„ã¾ã™ã‚ˆã­ã€‚çœŸå‰£ã«è€ƒãˆã¦ã„ã‚‹è¨¼æ‹ ã ã¨æ€ã„ã¾ã™ã€‚
Rï¼šã©ã¡ã‚‰ã«ã‚‚ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã‹ã‚‰ã“ãè¿·ã†ã‚“ã§ã™ã‚ˆã­ã€‚
Eï¼šä¾‹ãˆã°ã€ç§ã¯ã€Œå¾Œæ‚”ãŒå°‘ãªã„æ–¹ã€ã§é¸ã¶ã¨ç´å¾—ã—ã‚„ã™ã‹ã£ãŸã§ã™ã€‚
Aï¼šã‚ˆã‘ã‚Œã°ã€å„ªå…ˆé †ä½ã‚’ä¸€ç·’ã«æ•´ç†ã—ã¦æ±ºã‚ã¾ã›ã‚“ã‹ï¼Ÿ` }
    ],
    template:
`ï¼ˆAREAä¾‹ï¼‰
Aï¼šå¤§å¤‰ã§ã™ã‚ˆã­ã€‚ãŠæ°—æŒã¡ã‚ã‹ã‚Šã¾ã™ã€‚
Rï¼šå®Ÿã¯ã€‡ã€‡ã¨ã„ã†ç†ç”±ãŒã‚ã£ã¦â€¦
Eï¼šä¾‹ãˆã°â–¡â–¡ã®æ™‚ã«ã†ã¾ãã„ãã¾ã—ãŸã€‚
Aï¼šãªã®ã§ã€ã¾ãšã¯â—‡â—‡ã‹ã‚‰ã‚„ã£ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ`
  },

  prep: {
    name: "PREP",
    seconds: 40,
    hint: "çµè«–â†’ç†ç”±â†’å…·ä½“ä¾‹â†’çµè«–ï¼ˆçŸ­æ™‚é–“ã§ä¼ãˆã‚‹ï¼‰",
    topicHint: "ğŸ’¡ æœ€åˆã«çµè«– â†’ ç†ç”± â†’ å…·ä½“ä¾‹ â†’ çµè«–ã§ç· ã‚ã‚‹ã¨40ç§’ãŒæ±ºã¾ã‚Šã¾ã™ã€‚",
    topics: [
      { topic:"æœ€è¿‘è²·ã£ã¦ã‚ˆã‹ã£ãŸã‚‚ã®",
        model:`Pï¼šçµè«–ã¯ã€Œã€‡ã€‡ã€ã‚’è²·ã£ã¦ã‚ˆã‹ã£ãŸã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€â–³â–³ãŒä¸€æ°—ã«æ¥½ã«ãªã£ãŸã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€â–¡â–¡ã®å ´é¢ã§æ™‚çŸ­ã§ãã¾ã—ãŸã€‚
Pï¼šã ã‹ã‚‰ã€åŒã˜æ‚©ã¿ã®äººã«ãŠã™ã™ã‚ã§ã™ã€‚` },
      { topic:"ãŠã™ã™ã‚ã®ç¿’æ…£",
        model:`Pï¼šçµè«–ã¯ã€Œæ¯æœ3åˆ†ã®æº–å‚™ã€ã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€1æ—¥ã®é›†ä¸­åŠ›ãŒä¸ŠãŒã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€æ·±å‘¼å¸â†’ä»Šæ—¥ã®ç›®çš„ã‚’1è¡Œæ›¸ãã ã‘ã§æ•´ã„ã¾ã™ã€‚
Pï¼šã ã‹ã‚‰ã€å¿™ã—ã„äººã»ã©è©¦ã—ã¦ã»ã—ã„ã§ã™ã€‚` },
      { topic:"ç§ã®å¼·ã¿",
        model:`Pï¼šç§ã®å¼·ã¿ã¯ã€Œç¶™ç¶šåŠ›ã€ã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€å°ã•ãã¦ã‚‚æ¯æ—¥ç©ã¿é‡ã­ã‚‰ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€ã€‡ã€‡ã‚’åŠå¹´ç¶šã‘ã¦æˆæœãŒå‡ºã¾ã—ãŸã€‚
Pï¼šã ã‹ã‚‰ã€ã“ã‚Œã‹ã‚‰ã‚‚ç¶™ç¶šã§ä¼¸ã°ã—ã¦ã„ãã¾ã™ã€‚` },
      { topic:"å¤±æ•—ã‹ã‚‰å­¦ã‚“ã ã“ã¨",
        model:`Pï¼šçµè«–ã¯ã€Œå¤±æ•—ã¯æº–å‚™ä¸è¶³ã®ã‚µã‚¤ãƒ³ã€ã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€åŸå› ã‚’åˆ†è§£ã™ã‚‹ã¨æ¬¡ãŒæ”¹å–„ã§ãã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€â–³â–³ã§å¤±æ•—ã—ã¦æ‰‹é †æ›¸ã‚’ä½œã£ãŸã‚‰å®‰å®šã—ã¾ã—ãŸã€‚
Pï¼šã ã‹ã‚‰ã€å¤±æ•—ã—ãŸã‚‰åŸå› ã‚’1å€‹ã ã‘ç›´ã—ã¾ã™ã€‚` },
      { topic:"å¥åº·ã®ãŸã‚ã«ã—ã¦ã„ã‚‹ã“ã¨",
        model:`Pï¼šçµè«–ã¯ã€Œç¡çœ ã‚’æœ€å„ªå…ˆã«ã—ã¦ã„ã¾ã™ã€ã€‚
Rï¼šãªãœãªã‚‰ã€ä½“èª¿ã‚‚æ°—åˆ†ã‚‚å®‰å®šã™ã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€å¯ã‚‹å‰ã®ã‚¹ãƒãƒ›ã‚’æ¸›ã‚‰ã™ã ã‘ã§ç¿ŒæœãŒé•ã„ã¾ã™ã€‚
Pï¼šã ã‹ã‚‰ã€ã¾ãšã¯ç¡çœ ã‹ã‚‰æ•´ãˆã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚` },
      { topic:"ä»•äº‹ã§å¤§åˆ‡ã«ã—ã¦ã„ã‚‹ã“ã¨",
        model:`Pï¼šçµè«–ã¯ã€Œç›¸æ‰‹ã®å®‰å¿ƒã€ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚
Rï¼šãªãœãªã‚‰ã€å®‰å¿ƒãŒã‚ã‚‹ã¨å”åŠ›ã—ã‚„ã™ã„ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€ä¸€è¨€å…±æ„Ÿã‚’å…¥ã‚Œã‚‹ã¨åå¿œãŒæŸ”ã‚‰ã‹ããªã‚Šã¾ã™ã€‚
Pï¼šã ã‹ã‚‰ã€å®‰å¿ƒã‹ã‚‰ä½œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚` },
      { topic:"å°Šæ•¬ã—ã¦ã„ã‚‹äºº",
        model:`Pï¼šçµè«–ã¯ã€ã€‡ã€‡ã•ã‚“ã‚’å°Šæ•¬ã—ã¦ã„ã¾ã™ã€‚
Rï¼šãªãœãªã‚‰ã€â–³â–³ã®å§¿å‹¢ãŒä¸€è²«ã—ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€â–¡â–¡ã®æ™‚ã‚‚ä¸å¯§ã«å‘ãåˆã£ã¦ã„ã¾ã—ãŸã€‚
Pï¼šã ã‹ã‚‰ã€è‡ªåˆ†ã‚‚ãã®å§¿å‹¢ã‚’çœŸä¼¼ã—ãŸã„ã§ã™ã€‚` },
      { topic:"ç·Šå¼µã—ãŸæ™‚ã®å¯¾å‡¦æ³•",
        model:`Pï¼šçµè«–ã¯ã€Œæœ€åˆã®ä¸€æ–‡ã‚’æ±ºã‚ã‚‹ã€ã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€å‡ºã ã—ãŒæ±ºã¾ã‚‹ã¨è½ã¡ç€ãã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€ã€Œçµè«–ã¯ã€œã§ã™ã€ã ã‘ã§æµã‚ŒãŒã§ãã¾ã™ã€‚
Pï¼šã ã‹ã‚‰ã€æœ€åˆã®ä¸€æ–‡ã ã‘ç”¨æ„ã—ã¾ã™ã€‚` },
      { topic:"æ™‚é–“ç®¡ç†ã®ã‚³ãƒ„",
        model:`Pï¼šçµè«–ã¯ã€Œå…ˆã«äºˆå®šã‚’å…¥ã‚Œã‚‹ã€ã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€ç©ºãæ™‚é–“ã¯æµã‚Œã‚„ã™ã„ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€å‹‰å¼·ã‚’å…ˆã«äºˆå®šåŒ–ã™ã‚‹ã¨å®Ÿè¡Œç‡ãŒä¸ŠãŒã‚Šã¾ã™ã€‚
Pï¼šã ã‹ã‚‰ã€å…ˆã«äºˆå®šã‚’æŠ¼ã•ãˆã¾ã™ã€‚` },
      { topic:"ç§ãŒå¤§äº‹ã«ã—ã¦ã„ã‚‹ä¾¡å€¤è¦³",
        model:`Pï¼šçµè«–ã¯ã€Œèª å®Ÿã•ã€ã§ã™ã€‚
Rï¼šãªãœãªã‚‰ã€ä¿¡é ¼ã¯ç©ã¿é‡ã­ã§ã—ã‹ä½œã‚Œãªã„ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°ã€ã§ããªã„ã“ã¨ã¯æ­£ç›´ã«ä¼ãˆã‚‹æ–¹ãŒé–¢ä¿‚ãŒç¶šãã¾ã™ã€‚
Pï¼šã ã‹ã‚‰ã€èª å®Ÿã«å¯¾å¿œã™ã‚‹ã“ã¨ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚` }
    ],
    template:
`ï¼ˆPREPä¾‹ï¼‰
Pï¼šçµè«–ã¯ã€‡ã€‡ã§ã™ã€‚
Rï¼šãªãœãªã‚‰â–³â–³ã ã‹ã‚‰ã§ã™ã€‚
Eï¼šä¾‹ãˆã°â–¡â–¡ã®æ™‚ã«â€¦
Pï¼šã ã‹ã‚‰ç§ã¯ã€‡ã€‡ã ã¨æ€ã„ã¾ã™ã€‚`
  },

  story: {
    name: "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼",
    seconds: 80,
    hint: "çŠ¶æ³â†’å‡ºæ¥äº‹â†’æ„Ÿæƒ…â†’å­¦ã³â†’ä»Šå¾Œï¼ˆå¿ƒã‚’å‹•ã‹ã™ï¼‰",
    topicHint: "ğŸ’¡ æƒ…æ™¯ï¼ˆã„ã¤/ã©ã“ã§ï¼‰ï¼‹æ„Ÿæƒ…ï¼ˆå¬‰ã—ã„/æ‚”ã—ã„ç­‰ï¼‰ï¼‹å­¦ã³ã‚’å…¥ã‚Œã‚‹ã¨å¼·ã„ã§ã™ã€‚",
    topics: [
      { topic:"äººç”Ÿã®è»¢æ©Ÿã«ãªã£ãŸå‡ºæ¥äº‹",
        model:`çŠ¶æ³ï¼šã‚ã®æ™‚ã€ã€‡ã€‡ã§æ‚©ã‚“ã§ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šãã‚“ãªæ™‚ã«â–³â–³ãŒèµ·ãã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šæ­£ç›´ã€æ€–ã‹ã£ãŸ/æ‚”ã—ã‹ã£ãŸ/å¬‰ã—ã‹ã£ãŸã§ã™ã€‚
å­¦ã³ï¼šã§ã‚‚ã€Œâ–¡â–¡ã€ã«æ°—ã¥ã‘ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šã ã‹ã‚‰ä»Šã¯â—‡â—‡ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚` },
      { topic:"æŒ«æŠ˜ã—ãŸã‘ã©ç«‹ã¡ç›´ã‚ŒãŸè©±",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ã§æ€ã†ã‚ˆã†ã«ã„ã‹ãšè½ã¡è¾¼ã‚“ã§ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šã‚ã‚‹æ—¥â–³â–³ãŒãã£ã‹ã‘ã§è€ƒãˆæ–¹ãŒå¤‰ã‚ã‚Šã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šæ‚”ã—ã‹ã£ãŸã‘ã©ã€å°‘ã—å¸Œæœ›ãŒæŒã¦ã¾ã—ãŸã€‚
å­¦ã³ï¼šã€Œå°ã•ãç¶šã‘ã‚‹ã€ãŒå¤§äº‹ã ã¨å­¦ã³ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šä»Šã‚‚æ¯æ—¥1ã¤ã ã‘ç¶šã‘ã¦ã„ã¾ã™ã€‚` },
      { topic:"å¿˜ã‚Œã‚‰ã‚Œãªã„æ„Ÿå‹•ä½“é¨“",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ã®æ—¥ã€ã„ã¤ã‚‚é€šã‚Šéã”ã—ã¦ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šãã“ã§â–³â–³ã‚’è¦‹ã¦å¿ƒã‚’å‹•ã‹ã•ã‚Œã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šèƒ¸ãŒç†±ããªã£ã¦ã€æ€ã‚ãšæ³£ããã†ã§ã—ãŸã€‚
å­¦ã³ï¼šäººã®â–¡â–¡ã£ã¦ã€ã™ã”ã„åŠ›ã ã¨æ€ã„ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šç§ã‚‚èª°ã‹ã‚’æ”¯ãˆã‚‰ã‚Œã‚‹äººã§ã„ãŸã„ã§ã™ã€‚` },
      { topic:"æ€–ã‹ã£ãŸçµŒé¨“ã¨ãã®å…‹æœ",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ãŒæ€–ãã¦é¿ã‘ã¦ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šã§ã‚‚â–³â–³ãŒå¿…è¦ã«ãªã‚Šå‘ãåˆã„ã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šæœ€åˆã¯ç·Šå¼µã§ã„ã£ã±ã„ã§ã—ãŸã€‚
å­¦ã³ï¼šã‚„ã£ã¦ã¿ã‚‹ã¨ã€Œâ–¡â–¡ã€ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚
ä»Šå¾Œï¼šã ã‹ã‚‰ä»Šã¯å°ã•ãæŒ‘æˆ¦ã—ã¦ã„ã¾ã™ã€‚` },
      { topic:"èª°ã‹ã«æ„Ÿè¬ã—ãŸã„å‡ºæ¥äº‹",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ã§ä½™è£•ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šãã®æ™‚â–³â–³ã•ã‚“ãŒåŠ©ã‘ã¦ãã‚Œã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šæœ¬å½“ã«æ•‘ã‚ã‚Œã¦ã€ã»ã£ã¨ã—ã¾ã—ãŸã€‚
å­¦ã³ï¼šæ”¯ãˆåˆã„ã£ã¦å¤§äº‹ã ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šæ¬¡ã¯ç§ãŒè¿”ã—ãŸã„ã§ã™ã€‚` },
      { topic:"åŠªåŠ›ãŒå ±ã‚ã‚ŒãŸç¬é–“",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ã‚’ãšã£ã¨ç¶šã‘ã¦ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šã‚ã‚‹æ—¥â–³â–³ã®æˆæœãŒå‡ºã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šå¬‰ã—ãã¦ã€å ±ã‚ã‚ŒãŸæ°—æŒã¡ã§ã—ãŸã€‚
å­¦ã³ï¼šç¶™ç¶šã¯è£åˆ‡ã‚‰ãªã„ã¨å®Ÿæ„Ÿã—ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šæ¬¡ã®ç›®æ¨™ã‚‚ç¶šã‘ã¦ã„ãã¾ã™ã€‚` },
      { topic:"å¤±æ•—ã—ã¦æ¥ãšã‹ã—ã‹ã£ãŸã‘ã©å­¦ã‚“ã è©±",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ã§ã†ã¾ãã‚„ã‚ã†ã¨ã—ã¦ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šã§ã‚‚â–³â–³ã§å¤±æ•—ã—ã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šæ¥ãšã‹ã—ãã¦è½ã¡è¾¼ã¿ã¾ã—ãŸã€‚
å­¦ã³ï¼šæº–å‚™ã¨ç¢ºèªãŒå¤§äº‹ã ã¨å­¦ã³ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šä»Šã¯æ‰‹é †ã‚’æ±ºã‚ã¦ã‹ã‚‰å‹•ã„ã¦ã„ã¾ã™ã€‚` },
      { topic:"äººé–“é–¢ä¿‚ã§æ•‘ã‚ã‚ŒãŸã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰",
        model:`çŠ¶æ³ï¼šã€‡ã€‡ã§å­¤ç‹¬ã‚’æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šã§ã‚‚â–³â–³ã¨è¨€ã£ã¦ãã‚ŒãŸäººãŒã„ã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šæ¶™ãŒå‡ºãã†ãªãã‚‰ã„å¬‰ã—ã‹ã£ãŸã§ã™ã€‚
å­¦ã³ï¼šè¨€è‘‰1ã¤ã§äººã¯æ•‘ã‚ã‚Œã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šç§ã‚‚å„ªã—ã„è¨€è‘‰ã‚’å¤§åˆ‡ã«ã—ã¾ã™ã€‚` },
      { topic:"ä»•äº‹ã§èƒ¸ãŒç†±ããªã£ãŸç¬é–“",
        model:`çŠ¶æ³ï¼šä»•äº‹ã§ã€‡ã€‡ã‚’é ‘å¼µã£ã¦ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šãã®æ™‚â–³â–³ã¨è¨€ã‚ã‚Œã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šèƒ¸ãŒç†±ããªã£ã¦ã€åŠ›ãŒæ¹§ãã¾ã—ãŸã€‚
å­¦ã³ï¼šä¿¡é ¼ã¯ç©ã¿é‡ã­ã§ä½œã‚Œã‚‹ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
ä»Šå¾Œï¼šã“ã‚Œã‹ã‚‰ã‚‚ä¸å¯§ã«ç¶šã‘ã¾ã™ã€‚` },
      { topic:"ã€Œã‚ã®æ™‚ã®è‡ªåˆ†ã€ã«ä¼ãˆãŸã„ã“ã¨",
        model:`çŠ¶æ³ï¼šå½“æ™‚ã®ç§ã¯ã€‡ã€‡ã§æ‚©ã‚“ã§ã„ã¾ã—ãŸã€‚
å‡ºæ¥äº‹ï¼šãã®å¾Œã€â–³â–³ã‚’çµŒé¨“ã—ã¾ã—ãŸã€‚
æ„Ÿæƒ…ï¼šä¸å®‰ã ã£ãŸã‘ã©ã€å°‘ã—ãšã¤å¤‰ã‚ã‚Œã¾ã—ãŸã€‚
å­¦ã³ï¼šã€Œâ–¡â–¡ã€ã‚’ä¿¡ã˜ã‚Œã°å¤§ä¸ˆå¤«ã ã¨åˆ†ã‹ã‚Šã¾ã—ãŸã€‚
ä»Šå¾Œï¼šã ã‹ã‚‰ä»Šã€åŒã˜æ‚©ã¿ã®äººã«ä¼ãˆãŸã„ã§ã™ã€‚` }
    ],
    template:
`ï¼ˆã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¾‹ï¼‰
çŠ¶æ³ï¼šã„ã¤/ã©ã“ã§/ä½•ãŒèµ·ãã¦ã„ãŸã‹
å‡ºæ¥äº‹ï¼šä½•ãŒèµ·ããŸã‹
æ„Ÿæƒ…ï¼šãã®æ™‚ã©ã†æ„Ÿã˜ãŸã‹
å­¦ã³ï¼šä½•ã«æ°—ã¥ã„ãŸã‹
ä»Šå¾Œï¼šã“ã‚Œã‹ã‚‰ã©ã†ã—ãŸã„ã‹`
  },

  nego: {
    name: "äº¤æ¸‰è¡“",
    seconds: 120,
    hint: "ç›®çš„â†’æ¡ä»¶â†’ç†ç”±â†’ä»£æ¡ˆâ†’åˆæ„ï¼ˆè½ã¨ã—æ‰€ã‚’ä½œã‚‹ï¼‰",
    topicHint: "ğŸ’¡ ç›®çš„â†’ç†ç”±â†’ä»£æ¡ˆï¼ˆAæ¡ˆ/Bæ¡ˆï¼‰â†’ç›¸æ‰‹ã®ãƒ¡ãƒªãƒƒãƒˆã€ã®é †ã§é€šã‚Šã‚„ã™ã„ã§ã™ã€‚",
    topics: [
      { topic:"ã‚·ãƒ•ãƒˆã‚„äºˆå®šã®èª¿æ•´ã‚’ãŠé¡˜ã„ã—ãŸã„ï¼ˆç›¸æ‰‹ã®äº‹æƒ…ã‚‚å°Šé‡ï¼‰",
        model:`ç›®çš„ï¼šä»Šæ—¥ã¯ã‚·ãƒ•ãƒˆã®èª¿æ•´ã‚’ç›¸è«‡ã—ãŸã„ã§ã™ã€‚
ç†ç”±ï¼šèƒŒæ™¯ã¨ã—ã¦ä»Šé€±â–³â–³ãŒé‡ãªã£ã¦ã„ã¦â€¦
æ¡ä»¶ï¼šå¸Œæœ›ã¯â–¡â–¡ã®æ™‚é–“å¸¯ã‚’å¤‰æ›´ã—ãŸã„ã§ã™ã€‚
ä»£æ¡ˆï¼šé›£ã—ã‘ã‚Œã°Aæ¡ˆï¼ˆÃ—Ã—ï¼‰ã‹Bæ¡ˆï¼ˆâ–³â–³ï¼‰ã§ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚
åˆæ„ï¼šã©ã®å½¢ãªã‚‰ãŠäº’ã„ç„¡ç†ãªãé€²ã‚ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ` },
      { topic:"è¿½åŠ æ¥­å‹™ã‚’æ–­ã‚Šã¤ã¤ä»£æ¡ˆã‚’å‡ºã™",
        model:`ç›®çš„ï¼šè¿½åŠ æ¥­å‹™ã®ä»¶ã€ç›¸è«‡ã§ã™ã€‚
ç†ç”±ï¼šä»Šã®æ‹…å½“ãŒè©°ã¾ã£ã¦ã„ã¦ã€åŒæ™‚ã«å—ã‘ã‚‹ã¨è³ªãŒè½ã¡ãã†ã§â€¦
æ¡ä»¶ï¼šä»Šå›ã¯å¼•ãå—ã‘ã‚‹ã®ãŒé›£ã—ã„ã§ã™ã€‚
ä»£æ¡ˆï¼šä»£ã‚ã‚Šã«ã€Œã“ã“ã¾ã§ã€ãªã‚‰å¯¾å¿œã§ãã¾ã™ï¼åˆ¥æ—¥ãªã‚‰å¯èƒ½ã§ã™ã€‚
åˆæ„ï¼šã©ã¡ã‚‰ãŒä¸€ç•ªåŠ©ã‹ã‚Šã¾ã™ã‹ï¼Ÿ` },
      { topic:"å€¤ä¸Šã’ï¼ˆæ–™é‡‘æ”¹å®šï¼‰ã‚’ä¸å¯§ã«ä¼ãˆã‚‹",
        model:`ç›®çš„ï¼šæ–™é‡‘æ”¹å®šã«ã¤ã„ã¦ã”ç›¸è«‡ã§ã™ã€‚
ç†ç”±ï¼šå“è³ªç¶­æŒã®ãŸã‚ã«â–³â–³ã‚³ã‚¹ãƒˆãŒå¢—ãˆã¦ã„ã¦â€¦
æ¡ä»¶ï¼šæ¥æœˆã‹ã‚‰â–¡â–¡å††ã®æ”¹å®šã‚’ãŠé¡˜ã„ã—ãŸã„ã§ã™ã€‚
ä»£æ¡ˆï¼šç¶™ç¶šã®æ–¹ã¯Aæ¡ˆï¼ˆæ®µéšæ”¹å®šï¼‰ï¼Bæ¡ˆï¼ˆå›æ•°èª¿æ•´ï¼‰ã‚‚å¯èƒ½ã§ã™ã€‚
åˆæ„ï¼šè² æ‹…ãŒå°‘ãªã„å½¢ã‚’ä¸€ç·’ã«æ±ºã‚ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ` },
      { topic:"æœŸé™å»¶é•·ã‚’ãŠé¡˜ã„ã™ã‚‹ï¼ˆèª å®Ÿã«ï¼‰",
        model:`ç›®çš„ï¼šæœŸé™å»¶é•·ã®ãŠé¡˜ã„ã§ã™ã€‚
ç†ç”±ï¼šç¾çŠ¶â–³â–³ãŒç™ºç”Ÿã—ã¦ãŠã‚Šã€ç²¾åº¦ã‚’è½ã¨ã—ãŸãã‚ã‚Šã¾ã›ã‚“ã€‚
æ¡ä»¶ï¼šæœŸé™ã‚’â–¡â–¡æ—¥å»¶é•·ã§ãã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
ä»£æ¡ˆï¼šé€”ä¸­çµŒéã‚’â—‹æ—¥ã«å…±æœ‰ã™ã‚‹æ¡ˆã‚‚ã§ãã¾ã™ã€‚
åˆæ„ï¼šã©ã®å½¢ãŒä¸€ç•ªå®‰å¿ƒã§ã—ã‚‡ã†ã‹ï¼Ÿ` },
      { topic:"å®¶æ—ã«å”åŠ›ã‚’ãŠé¡˜ã„ã™ã‚‹ï¼ˆå…·ä½“æ¡ˆã¤ãï¼‰",
        model:`ç›®çš„ï¼šå®¶ã®åˆ†æ‹…ã‚’ç›¸è«‡ã—ãŸã„ã§ã™ã€‚
ç†ç”±ï¼šæœ€è¿‘â–³â–³ã§ä½™è£•ãŒãªãã¦â€¦
æ¡ä»¶ï¼šé€±ã«â–¡â–¡ã ã‘å”åŠ›ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
ä»£æ¡ˆï¼šAæ¡ˆï¼ˆæœã ã‘ï¼‰ï¼Bæ¡ˆï¼ˆå¤œã ã‘ï¼‰ã©ã£ã¡ãŒã‚„ã‚Šã‚„ã™ã„ï¼Ÿ
åˆæ„ï¼šç„¡ç†ã®ãªã„å½¢ã§æ±ºã‚ãŸã„ã§ã™ã€‚` },
      { topic:"å–å¼•å…ˆã«æ¡ä»¶å¤‰æ›´ã‚’ç›¸è«‡ã™ã‚‹",
        model:`ç›®çš„ï¼šæ¡ä»¶å¤‰æ›´ã®ç›¸è«‡ã§ã™ã€‚
ç†ç”±ï¼šèƒŒæ™¯ã¨ã—ã¦â–³â–³ã®äº‹æƒ…ãŒã‚ã‚Šâ€¦
æ¡ä»¶ï¼šâ–¡â–¡ã®æ¡ä»¶ã«å¤‰æ›´ã§ããªã„ã§ã—ã‚‡ã†ã‹ã€‚
ä»£æ¡ˆï¼šé›£ã—ã‘ã‚Œã°Aæ¡ˆï¼ˆåˆ¥æ¡ä»¶ï¼‰ã‚„Bæ¡ˆï¼ˆæœŸé–“å»¶é•·ï¼‰ã‚‚æ¤œè¨ã§ãã¾ã™ã€‚
åˆæ„ï¼šåŒæ–¹ã«ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹å½¢ã‚’æ¢ã—ãŸã„ã§ã™ã€‚` },
      { topic:"ç›¸æ‰‹ã®è¦æœ›ã‚’ä¸€éƒ¨ã ã‘å—ã‘ã‚‹äº¤æ¸‰",
        model:`ç›®çš„ï¼šã”è¦æœ›ã¸ã®å¯¾å¿œæ–¹é‡ã‚’ç›¸è«‡ã—ãŸã„ã§ã™ã€‚
ç†ç”±ï¼šå…¨éƒ¨å¯¾å¿œã™ã‚‹ã¨â–³â–³ã®è² æ‹…ãŒå¤§ããã¦â€¦
æ¡ä»¶ï¼šâ–¡â–¡ã®ç¯„å›²ãªã‚‰å¯¾å¿œã§ãã¾ã™ã€‚
ä»£æ¡ˆï¼šæ®‹ã‚Šã¯Aæ¡ˆï¼ˆåˆ¥å¯¾å¿œï¼‰ã‹Bæ¡ˆï¼ˆåˆ¥æ—¥ï¼‰ã§ã©ã†ã§ã—ã‚‡ã†ï¼Ÿ
åˆæ„ï¼šå„ªå…ˆé †ä½ã‚’ä¸€ç·’ã«æ±ºã‚ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ` },
      { topic:"ã‚¯ãƒ¬ãƒ¼ãƒ å¯¾å¿œã§è½ã¨ã—æ‰€ã‚’ä½œã‚‹",
        model:`ç›®çš„ï¼šã”ä¸ä¾¿ã‚’ãŠã‹ã‘ã—ã¦ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚çŠ¶æ³ã‚’ç¢ºèªã—ãŸã„ã§ã™ã€‚
ç†ç”±ï¼šåŸå› ã¨ã—ã¦â–³â–³ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚
æ¡ä»¶ï¼šã“ã¡ã‚‰ã§â–¡â–¡ã®å¯¾å¿œãŒå¯èƒ½ã§ã™ã€‚
ä»£æ¡ˆï¼šã‚‚ã—ã”å¸Œæœ›ãŒã‚ã‚Œã°Aæ¡ˆ/Bæ¡ˆã‚‚ç”¨æ„ã§ãã¾ã™ã€‚
åˆæ„ï¼šã©ã®å½¢ãŒä¸€ç•ªç´å¾—ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ` },
      { topic:"ä»•äº‹ã®å½¹å‰²åˆ†æ‹…ã‚’èª¿æ•´ã™ã‚‹",
        model:`ç›®çš„ï¼šå½¹å‰²åˆ†æ‹…ã®èª¿æ•´ã‚’ç›¸è«‡ã—ãŸã„ã§ã™ã€‚
ç†ç”±ï¼šç¾åœ¨â–³â–³ãŒåã£ã¦ã„ã¦â€¦
æ¡ä»¶ï¼šâ–¡â–¡ã‚’åˆ†æ‹…ã§ãã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
ä»£æ¡ˆï¼šAæ¡ˆï¼ˆé€±â—¯å›ï¼‰ï¼Bæ¡ˆï¼ˆæ‹…å½“ã‚’å…¥ã‚Œæ›¿ãˆï¼‰ã‚‚å¯èƒ½ã§ã™ã€‚
åˆæ„ï¼šç„¡ç†ã®ãªã„å½¢ã§é€²ã‚ãŸã„ã§ã™ã€‚` },
      { topic:"è‡ªåˆ†ã®å¸Œæœ›ã‚’é€šã—ã¤ã¤é–¢ä¿‚æ€§ã‚’å®ˆã‚‹",
        model:`ç›®çš„ï¼šå¸Œæœ›ã®ç›¸è«‡ã§ã™ã€‚
ç†ç”±ï¼šèƒŒæ™¯ã¨ã—ã¦â–³â–³ãŒã‚ã‚Šã€ä»Šã®ã¾ã¾ã ã¨å³ã—ãã¦â€¦
æ¡ä»¶ï¼šâ–¡â–¡ã‚’å¸Œæœ›ã—ã¾ã™ã€‚
ä»£æ¡ˆï¼šé›£ã—ã‘ã‚Œã°Aæ¡ˆ/Bæ¡ˆã‚‚å—ã‘å…¥ã‚Œå¯èƒ½ã§ã™ã€‚
åˆæ„ï¼šãŠäº’ã„æ°—æŒã¡ã‚ˆãé€²ã‚ã‚‹è½ã¨ã—æ‰€ã‚’æ¢ã—ãŸã„ã§ã™ã€‚` }
    ],
    template:
`ï¼ˆäº¤æ¸‰ãƒ†ãƒ³ãƒ—ãƒ¬ï¼‰
ç›®çš„ï¼šä»Šæ—¥ã¯ã€‡ã€‡ã‚’ç›¸è«‡ã—ãŸã„ã§ã™ã€‚
ç†ç”±ï¼šèƒŒæ™¯ã¨ã—ã¦â–³â–³ãŒã‚ã£ã¦â€¦
æ¡ä»¶ï¼šå¸Œæœ›ã¯â–¡â–¡ã§ã™ã€‚
ä»£æ¡ˆï¼šé›£ã—ã‘ã‚Œã°Aæ¡ˆ/Bæ¡ˆã¯ã©ã†ã§ã—ã‚‡ã†ï¼Ÿ
åˆæ„ï¼šã©ã®å½¢ãªã‚‰ãŠäº’ã„ç„¡ç†ãªãé€²ã‚ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ`
  }
};

let currentModeKey = "area";
let TARGET_SECONDS = MODES[currentModeKey].seconds;

let time = TARGET_SECONDS;
let interval = null;

/* =========================
   ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
========================= */
function setMode(key){
  currentModeKey = key;
  TARGET_SECONDS = MODES[key].seconds;

  ["area","prep","story","nego"].forEach(k => {
    const b = document.getElementById("btn-" + k);
    if(!b) return;
    b.style.opacity = (k === key) ? "1" : "0.6";
    b.style.border = (k === key) ? "2px solid #333" : "";
  });

  document.getElementById("modeHint").textContent =
    `é¸æŠä¸­ï¼š${MODES[key].name}ï¼ˆ${MODES[key].hint}ï¼‰`;

  document.getElementById("topicHint").textContent = MODES[key].topicHint;

  time = TARGET_SECONDS;
  document.getElementById("timer").textContent = time;
  document.getElementById("timeHint").textContent =
    `ã“ã®ãƒ¢ãƒ¼ãƒ‰ã®ç›®å®‰ï¼š${TARGET_SECONDS}ç§’`;

  currentItem = null;
  modelVariants = [];
  modelIndex = 0;

  document.getElementById("topic").textContent = "ã‚¹ã‚¿ãƒ¼ãƒˆã‚’æŠ¼ã—ã¦ãã ã•ã„";
  hideModelAnswer();
  stop();

  document.getElementById("modelNextBtn").style.opacity = "0.6";
  document.getElementById("modelCopyBtn").style.opacity = "0.6";
  document.getElementById("modelClozeBtn").style.opacity = "0.6";

  loadDraft(false);
  hxUpdateLiveMeter();
}

/* =========================
   ãŠé¡Œè¡¨ç¤ºï¼ˆitem ã‚’ä¿æŒï¼‰
========================= */
function showTopicItem(item){
  currentItem = item;
  document.getElementById("topic").textContent = item.topic;

  modelVariants = [];
  modelIndex = 0;
  hideModelAnswer();

  document.getElementById("modelNextBtn").style.opacity = "0.6";
  document.getElementById("modelCopyBtn").style.opacity = item.model ? "1" : "0.6";
  document.getElementById("modelClozeBtn").style.opacity = item.model ? "1" : "0.6";
}

function newTopic(){
  const conf = MODES[currentModeKey];
  const item = conf.topics[Math.floor(Math.random() * conf.topics.length)];
  showTopicItem(item);
}

/* =========================
   ã‚¿ã‚¤ãƒãƒ¼
========================= */
function start(){
  if(interval) return;

  const lock = document.getElementById("lockTopic").checked;
  if(!lock || !currentItem){
    newTopic();
  }

  time = TARGET_SECONDS;
  document.getElementById("timer").textContent = time;

  interval = setInterval(() => {
    time--;
    document.getElementById("timer").textContent = time;

    if(time <= 0){
      stop();
      const msg = (TARGET_SECONDS >= 120)
        ? "çµ‚äº†ï¼2åˆ†ã‚„ã‚Šåˆ‡ã‚Šã¾ã—ãŸã€‚æœ¬å½“ã«ãŠç–²ã‚Œã•ã¾ã§ã—ãŸğŸ˜Š"
        : (TARGET_SECONDS >= 80)
          ? "çµ‚äº†ï¼80ç§’ãŠç–²ã‚Œã•ã¾ã§ã—ãŸğŸ˜Š"
          : "çµ‚äº†ï¼ãŠç–²ã‚Œã•ã¾ã§ã—ãŸğŸ˜Š";
      alert(msg);
    }
  }, 1000);
}

function stop(){
  if(interval){
    clearInterval(interval);
    interval = null;
  }
}

/* =========================
   éŒ²éŸ³ï¼ˆMediaRecorderï¼‰
========================= */
let hxMediaRecorder = null;
let hxRecordedChunks = [];
let hxRecordedBlobUrl = null;

async function hxToggleRecording(){
  const btn = document.getElementById("hxRecBtn");
  const status = document.getElementById("hxRecStatus");
  const player = document.getElementById("hxPlayer");

  if(hxMediaRecorder && hxMediaRecorder.state === "recording"){
    hxMediaRecorder.stop();
    btn.textContent = "éŒ²éŸ³é–‹å§‹";
    status.textContent = "åœæ­¢ã—ã¾ã—ãŸï¼ˆéŸ³å£°ç”Ÿæˆä¸­â€¦ï¼‰";
    return;
  }

  try{
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    hxRecordedChunks = [];
    hxMediaRecorder = new MediaRecorder(stream);

    hxMediaRecorder.ondataavailable = (e) => {
      if(e.data && e.data.size > 0) hxRecordedChunks.push(e.data);
    };

    hxMediaRecorder.onstop = () => {
      stream.getTracks().forEach(t => t.stop());
      const blob = new Blob(hxRecordedChunks, { type: "audio/webm" });
      if(hxRecordedBlobUrl) URL.revokeObjectURL(hxRecordedBlobUrl);
      hxRecordedBlobUrl = URL.createObjectURL(blob);

      player.src = hxRecordedBlobUrl;
      player.style.display = "block";
      status.textContent = "éŒ²éŸ³ãƒ‡ãƒ¼ã‚¿æº–å‚™OKï¼ˆå†ç”Ÿã§ãã¾ã™ï¼‰";
    };

    hxMediaRecorder.start();
    btn.textContent = "éŒ²éŸ³åœæ­¢";
    status.textContent = "éŒ²éŸ³ä¸­â€¦";
  }catch(err){
    status.textContent = "éŒ²éŸ³ã§ãã¾ã›ã‚“ã§ã—ãŸï¼ˆãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªï¼‰";
    alert("éŒ²éŸ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚iPhoneã®è¨­å®š/ã‚µã‚¤ãƒˆè¨­å®šã§ãƒã‚¤ã‚¯è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
  }
}

function hxResetRecording(){
  const status = document.getElementById("hxRecStatus");
  const player = document.getElementById("hxPlayer");

  if(hxMediaRecorder && hxMediaRecorder.state === "recording"){
    hxMediaRecorder.stop();
  }
  hxRecordedChunks = [];
  if(hxRecordedBlobUrl) URL.revokeObjectURL(hxRecordedBlobUrl);
  hxRecordedBlobUrl = null;

  player.pause();
  player.removeAttribute("src");
  player.style.display = "none";
  status.textContent = "å¾…æ©Ÿä¸­";

  const btn = document.getElementById("hxRecBtn");
  btn.textContent = "éŒ²éŸ³é–‹å§‹";
}

/* =========================
   é•·ã•æ¨å®š
========================= */
function hxEstimateSeconds(text){
  const t = (text || "")
    .replace(/\s/g, "")
    .replace(/[ã€ã€‚,.!?ï¼ï¼Ÿ]/g,"");
  const chars = t.length;

  const CHARS_PER_SEC = 6; // ç›®å®‰
  const sec = chars / CHARS_PER_SEC;
  return { sec, chars, charsPerSec: CHARS_PER_SEC };
}

function hxUpdateLiveMeter(){
  const ta = document.getElementById("hxSpeechText");
  const meter = document.getElementById("hxLiveMeter");
  const est = hxEstimateSeconds(ta.value);

  const target = TARGET_SECONDS || 0;
  let note = "";
  if(target){
    const low = target * 0.85;
    const high = target * 1.15;
    if(est.sec < low) note = "ï¼ˆå°‘ã—çŸ­ã‚ï¼š1ãƒ‘ãƒ¼ãƒ„è¶³ã™ã¨è‰¯ã„ï¼‰";
    else if(est.sec > high) note = "ï¼ˆå°‘ã—é•·ã‚ï¼šå…·ä½“ä¾‹ã‚’1ã¤ã«çµã‚‹ï¼‰";
    else note = "ï¼ˆã¡ã‚‡ã†ã©è‰¯ã„ âœ…ï¼‰";
  }

  meter.textContent = `æ–‡å­—æ•°ï¼š${est.chars} / æ¨å®šï¼š${est.sec.toFixed(0)}ç§’ / ç›®æ¨™ï¼š${target}ç§’ ${note}`;
}

/* =========================
   ä¸‹æ›¸ãä¿å­˜ï¼ˆç«¯æœ«å†…ï¼‰
========================= */
function draftKey(){
  return "hanashi_training_draft_" + currentModeKey;
}
function saveDraft(showAlert){
  try{
    localStorage.setItem(draftKey(), document.getElementById("hxSpeechText").value || "");
    if(showAlert) alert("ä¿å­˜ã—ã¾ã—ãŸğŸ˜Š");
  }catch(e){
    if(showAlert) alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆå®¹é‡/è¨­å®šã‚’ã”ç¢ºèªãã ã•ã„ï¼‰");
  }
}
function loadDraft(showAlert){
  try{
    const v = localStorage.getItem(draftKey());
    if(v !== null){
      document.getElementById("hxSpeechText").value = v;
      hxUpdateLiveMeter();
      if(showAlert) alert("ä¿å­˜å†…å®¹ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸğŸ˜Š");
    }else{
      if(showAlert) alert("ä¿å­˜ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ğŸ˜Š");
    }
  }catch(e){
    if(showAlert) alert("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
  }
}

/* =========================
   è©•ä¾¡ï¼ˆãƒ¢ãƒ¼ãƒ‰ï¼‹ãŠé¡Œã«æ²¿ã£ã¦ï¼‰
========================= */
function hxEvaluateByMode(text, modeKey, topicText){
  const raw = (text || "").trim();
  const t = raw.replace(/\r\n/g, "\n").replace(/\n{3,}/g, "\n\n").trim();
  const conf = MODES[modeKey];
  const target = conf.seconds;

  let score = 60;
  const badges = [];
  const good = [];
  const advice = [];

  if(t.length < 10){
    return {
      score: 60,
      badges: ["å…¥åŠ›ãŒçŸ­ã‚"],
      message:
`ğŸŒŸ ç·åˆè©•ä¾¡ï¼š60ç‚¹

ã¾ãšæŒ‘æˆ¦ã—ãŸã“ã¨ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ğŸ‘

é¸æŠä¸­ã®è©±æ³•ï¼š${conf.name}
ãŠé¡Œï¼š${topicText || "ï¼ˆæœªè¡¨ç¤ºï¼‰"}

ğŸ’¡ æ¬¡ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’å…¥ã‚Œã¦ã¿ã¾ã—ã‚‡ã†ï¼š
${conf.template}`
    };
  }

  const conclusion = ["çµè«–","è¦ã™ã‚‹ã«","ã¤ã¾ã‚Š","ä¸€è¨€ã§ã„ã†ã¨","ç§ã¯","åƒ•ã¯","å¤§äº‹ãªã®ã¯","é‡è¦ãªã®ã¯","ãƒã‚¤ãƒ³ãƒˆã¯","ä¸€ç•ªè¨€ã„ãŸã„ã®ã¯"];
  const reason = ["ãªãœãªã‚‰","ç†ç”±","èƒŒæ™¯","ã¨ã„ã†ã®ã‚‚","ãªãœã‹ã¨ã„ã†ã¨","ã ã‹ã‚‰ã“ã","ãªã®ã§","ã‹ã‚‰","ãŸã‚","ãŒã‚ã£ã¦","èƒŒæ™¯ã¨ã—ã¦"];
  const example = ["ä¾‹ãˆã°","ãŸã¨ãˆã°","å®Ÿéš›ã«","å…ˆæ—¥","ä»¥å‰","å…·ä½“çš„ã«","ä½“é¨“ã¨ã—ã¦","ãã®æ™‚","å½“æ™‚","å ´é¢","ã‚·ãƒ¼ãƒ³"];
  const summary = ["ã¾ã¨ã‚ã‚‹ã¨","çµè«–ã¨ã—ã¦","æœ€å¾Œã«","ã ã‹ã‚‰","ã¤ã¾ã‚Š","ãªã®ã§","ã¨ã„ã†ã‚ã‘ã§","è¦ã¯","ä»Šå¾Œã¯","ã“ã‚Œã‹ã‚‰","ãœã²"];

  const hasC = conclusion.some(w => t.includes(w));
  const hasR = reason.some(w => t.includes(w));
  const hasE = example.some(w => t.includes(w));
  const hasS = summary.some(w => t.includes(w));

  if(modeKey === "prep"){
    if(hasC){ score += 15; good.push("çµè«–ãŒã¯ã£ãã‚Šã—ã¦ã„ã¦40ç§’å‘ãã§ã—ãŸ"); badges.push("çµè«–"); }
    if(hasR){ score += 10; good.push("ç†ç”±ãŒã¤ã„ã¦èª¬å¾—åŠ›ãŒã‚ã‚Šã¾ã—ãŸ"); badges.push("ç†ç”±"); }
    if(hasE){ score += 10; good.push("å…·ä½“ä¾‹ãŒã‚ã£ã¦ä¼ã‚ã‚Šã‚„ã™ã„ã§ã™"); badges.push("å…·ä½“ä¾‹"); }
    if(hasS){ score += 5;  good.push("ç· ã‚ãŒã‚ã£ã¦ç¶ºéº—ã§ã—ãŸ"); badges.push("ç· ã‚"); }
  } else if(modeKey === "area"){
    const agree = ["å¤§å¤‰","ã‚ã‹ã‚Šã¾ã™","ãŠæ°—æŒã¡","ãŠç–²ã‚Œ","ã§ã™ã‚ˆã­","ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™"];
    const hasA = agree.some(w => t.includes(w));
    if(hasA){ score += 12; good.push("å…±æ„Ÿãƒ»è‚¯å®šã‹ã‚‰å…¥ã‚Œã¦ã„ã¦ä¿¡é ¼æ„ŸãŒã‚ã‚Šã¾ã—ãŸ"); badges.push("å…±æ„Ÿ"); }
    if(hasR){ score += 10; good.push("ç†ç”±ãŒã‚ã‚Šç´å¾—ã—ã‚„ã™ã„ã§ã™"); badges.push("ç†ç”±"); }
    if(hasE){ score += 10; good.push("å…·ä½“ä¾‹ãŒã‚ã‚Šã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãã¾ã™"); badges.push("å…·ä½“ä¾‹"); }
    const action = ["ã‚„ã£ã¦ã¿","ã—ã¾ã—ã‚‡ã†","ææ¡ˆ","ãŠã™ã™ã‚","æ¬¡ã¯","ä¸€åº¦","ã©ã†ã§ã—ã‚‡ã†"];
    if(action.some(w => t.includes(w))){ score += 10; good.push("ææ¡ˆã¾ã§ã§ãã¦ã„ã¦AREAãŒå®Œæˆã—ã¦ã„ã¾ã™"); badges.push("ææ¡ˆ"); }
  } else if(modeKey === "story"){
    const emo = ["å¬‰ã—ã„","æ‚”ã—ã„","æ‚²ã—ã„","æ€–ã„","æ„Ÿå‹•","é©šã„","ãƒ¯ã‚¯ãƒ¯ã‚¯","ãƒ¢ãƒ¤ãƒ¢ãƒ¤","ã»ã£ã¨","æ³£ã„"];
    const learn = ["å­¦ã‚“ã ","æ°—ã¥ã„ãŸ","åçœ","æˆé•·","ä¾¡å€¤è¦³","å¤§åˆ‡","å¤‰ã‚ã£ãŸ"];
    if(emo.some(w => t.includes(w))){ score += 12; good.push("æ„Ÿæƒ…ãŒå…¥ã£ã¦ã„ã¦å¿ƒã«å±Šãã¾ã™"); badges.push("æ„Ÿæƒ…"); }
    if(hasE){ score += 10; good.push("å‡ºæ¥äº‹ãŒå…·ä½“çš„ã§æƒ…æ™¯ãŒæµ®ã‹ã³ã¾ã—ãŸ"); badges.push("æƒ…æ™¯"); }
    if(learn.some(w => t.includes(w))){ score += 10; good.push("å­¦ã³ãŒã‚ã‚Šã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨ã—ã¦ç· ã¾ã£ã¦ã„ã¾ã™"); badges.push("å­¦ã³"); }
    if(hasS){ score += 5; good.push("æœ€å¾Œã®ã¾ã¨ã‚ãŒè‰¯ã„ã§ã™"); badges.push("ç· ã‚"); }
  } else if(modeKey === "nego"){
    const purpose = ["ç›¸è«‡","ãŠé¡˜ã„","å¸Œæœ›","ç›®çš„","ææ¡ˆ"];
    const alt = ["ä»£æ¡ˆ","Aæ¡ˆ","Bæ¡ˆ","ã‚‚ã—é›£ã—ã‘ã‚Œã°","åˆ¥æ¡ˆ"];
    const merit = ["ãŠäº’ã„","åŒæ–¹","ãƒ¡ãƒªãƒƒãƒˆ","åŠ©ã‹ã‚‹","è² æ‹…","ç„¡ç†ãªã"];
    if(purpose.some(w => t.includes(w))){ score += 10; good.push("ç›®çš„ãŒæ˜ç¢ºã§äº¤æ¸‰ãŒå§‹ã‚ã‚„ã™ã„ã§ã™"); badges.push("ç›®çš„"); }
    if(hasR){ score += 10; good.push("ç†ç”±ãŒã‚ã‚‹ã®ã§ç›¸æ‰‹ãŒç´å¾—ã—ã‚„ã™ã„ã§ã™"); badges.push("ç†ç”±"); }
    if(alt.some(w => t.includes(w))){ score += 12; good.push("ä»£æ¡ˆãŒå‡ºã¦ã„ã¦äº¤æ¸‰ãŒé€šã‚Šã‚„ã™ã„ã§ã™"); badges.push("ä»£æ¡ˆ"); }
    if(merit.some(w => t.includes(w))){ score += 10; good.push("ç›¸æ‰‹ã®ãƒ¡ãƒªãƒƒãƒˆã‚’æ„è­˜ã§ãã¦ã„ã¾ã™"); badges.push("ç›¸æ‰‹ç›®ç·š"); }
  }

  if(t.length > 150){ score += 5; badges.push("å†…å®¹"); }

  const est = hxEstimateSeconds(t);
  const low = target * 0.85;
  const high = target * 1.15;

  let lengthComment = "";
  if(est.sec < low){
    badges.push("çŸ­ã‚");
    lengthComment =
`â± é•·ã•ãƒã‚§ãƒƒã‚¯ï¼šæ¨å®š ${est.sec.toFixed(0)}ç§’ï¼ˆç›®æ¨™ ${target}ç§’ï¼‰ â†’ å°‘ã—çŸ­ã‚
ğŸ’¡ ä¼¸ã°ã™ã‚³ãƒ„ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ã®ã€Œè¶³ã‚Šãªã„1ãƒ‘ãƒ¼ãƒ„ã€ã‚’è¶³ã™ï¼ˆä¾‹ï¼šå…·ä½“ä¾‹ or å­¦ã³ï¼‰`;
    advice.push("1ãƒ‘ãƒ¼ãƒ„è¶³ã™ã ã‘ã§ã€è‡ªç„¶ã«æ™‚é–“ãŒåŸ‹ã¾ã‚Šã¾ã™");
  }else if(est.sec > high){
    badges.push("é•·ã‚");
    lengthComment =
`â± é•·ã•ãƒã‚§ãƒƒã‚¯ï¼šæ¨å®š ${est.sec.toFixed(0)}ç§’ï¼ˆç›®æ¨™ ${target}ç§’ï¼‰ â†’ å°‘ã—é•·ã‚
ğŸ’¡ çŸ­ãã™ã‚‹ã‚³ãƒ„ï¼šå…·ä½“ä¾‹ã‚’1ã¤ã«çµã‚Šã€ç· ã‚ã‚’1æ–‡ã«ã¾ã¨ã‚ã‚‹`;
    advice.push("ä¸€ç•ªå¼·ã„å…·ä½“ä¾‹ã ã‘æ®‹ã™ã¨ã€ã¾ã¨ã¾ã‚ŠãŒè‰¯ããªã‚Šã¾ã™");
  }else{
    badges.push("é•·ã•OK");
    score += 5;
    lengthComment =
`â± é•·ã•ãƒã‚§ãƒƒã‚¯ï¼šæ¨å®š ${est.sec.toFixed(0)}ç§’ï¼ˆç›®æ¨™ ${target}ç§’ï¼‰ â†’ ã¡ã‚‡ã†ã©è‰¯ã„é•·ã•ã§ã™ âœ…`;
    good.push("æ™‚é–“é…åˆ†ãŒå®‰å®šã—ã¦ã„ã¦èãã‚„ã™ã„ã§ã™");
  }

  if(topicText){
    const key = topicText
      .replace(/[ï¼ˆï¼‰()ã€Œã€ã€ã€ãƒ»ã€ã€‚,.!?ï¼ï¼Ÿ]/g," ")
      .split(/\s+/).filter(x => x && x.length >= 2);
    const hit = key.some(k => t.includes(k));
    if(hit){
      score += 3;
      badges.push("ãŠé¡Œæ²¿ã„");
    }else{
      advice.push("ãŠé¡Œã®è¨€è‘‰ã‚’1å›ã ã‘æœ¬æ–‡ã«å…¥ã‚Œã‚‹ã¨ã€ã‚ˆã‚Šâ€œãŠé¡Œæ²¿ã„â€ã«è¦‹ãˆã¾ã™");
    }
  }

  const merged = [];
  advice.forEach(a => {
    if(!a) return;
    if(merged.includes(a)) return;
    if(merged.length >= 2) return;
    merged.push(a);
  });

  const praise = good.length
    ? good[Math.floor(Math.random() * good.length)]
    : "å‰å‘ãã«è©±ãã†ã¨ã—ã¦ã„ã‚‹å§¿å‹¢ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™";

  score = Math.min(score, 100);

  const warm =
    (target >= 120) ? "2åˆ†ã¯æœ¬å½“ã«ä½“åŠ›ã‚’ä½¿ã„ã¾ã™ã€‚ã‚ˆãã‚„ã‚Šåˆ‡ã‚Šã¾ã—ãŸğŸ‘"
    : (target >= 80) ? "80ç§’ã§ã‚‚ååˆ†ã™ã”ã„ã§ã™ã€‚é›†ä¸­ã—ã¦è©±ã›ã¦ã„ã¾ã™ğŸ‘"
    : "çŸ­æ™‚é–“ã§ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¦è‰¯ã„ã§ã™ğŸ‘";

  const improveText = merged.length
    ? "ğŸ’¡ ã•ã‚‰ã«è‰¯ãã™ã‚‹ãªã‚‰ï¼š\nãƒ»" + merged.join("\nãƒ»")
    : "ğŸ’¡ ä»Šã®èª¿å­ã§ç¶šã‘ã¦ã„ãã¾ã—ã‚‡ã†";

  return {
    score,
    badges,
    message:
`ğŸŒŸ ç·åˆè©•ä¾¡ï¼š${score}ç‚¹

${warm}

é¸æŠä¸­ã®è©±æ³•ï¼š${conf.name}
ãŠé¡Œï¼š${topicText || "ï¼ˆæœªè¡¨ç¤ºï¼‰"}

ç‰¹ã«ã€Œ${praise}ã€ç‚¹ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚

${lengthComment}

${improveText}

ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆå›°ã£ãŸã‚‰ã“ã‚Œï¼‰ï¼š
${conf.template}
`
  };
}

/* =========================
   UIæ“ä½œ
========================= */
function hxRunEvaluation(){
  const text = document.getElementById("hxSpeechText").value;
  const topicText = currentItem ? currentItem.topic : document.getElementById("topic").textContent;
  const res = hxEvaluateByMode(text, currentModeKey, topicText);

  const badgesEl = document.getElementById("hxBadges");
  badgesEl.innerHTML = "";
  (res.badges || []).forEach(b => {
    const span = document.createElement("span");
    span.textContent = b;
    span.style.display = "inline-block";
    span.style.padding = "6px 10px";
    span.style.borderRadius = "999px";
    span.style.border = "1px solid #ddd";
    span.style.fontSize = "14px";
    span.style.margin = "4px 6px 0 0";
    badgesEl.appendChild(span);
  });

  document.getElementById("hxResult").textContent = res.message;
  saveDraft(false);
}

function hxClearText(){
  document.getElementById("hxSpeechText").value = "";
  document.getElementById("hxBadges").innerHTML = "";
  document.getElementById("hxResult").textContent = "ã“ã“ã«è©•ä¾¡çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚";
  hxUpdateLiveMeter();
  saveDraft(false);
}

function hxInsertTemplate(){
  document.getElementById("hxSpeechText").value = MODES[currentModeKey].template;
  hxUpdateLiveMeter();
  saveDraft(false);
  hxRunEvaluation();
}

/* textareaå…¥åŠ›ã§ãƒ¡ãƒ¼ã‚¿ãƒ¼æ›´æ–°ï¼†è‡ªå‹•ä¿å­˜ */
document.getElementById("hxSpeechText").addEventListener("input", () => {
  hxUpdateLiveMeter();
  // é‡ãã—ãªã„ã‚ˆã†ã«è»½ãä¿å­˜
  saveDraft(false);
});

/* åˆæœŸçŠ¶æ…‹ */
setMode("area");
</script>

</body>
</html>